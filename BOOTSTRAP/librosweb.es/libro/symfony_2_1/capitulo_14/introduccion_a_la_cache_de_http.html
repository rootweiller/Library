<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>14.3. Introducción a la caché de HTTP (Symfony 2.1, el libro oficial)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                            
        <link rel="canonical" href="/libro/symfony_2_x/capitulo_14/introduccion_a_la_cache_de_http.html"/>
                                    <link rel="prev" href="../capitulo_14/las_caches_de_tipo_gateway_cache.html" />
                    <link rel="next" href="../capitulo_14/caducidad_y_validacion_http.html" />
                <link rel="start" href="/libro/symfony_2_1/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="14.3. Introducción a la caché de HTTP (Symfony 2.1, el libro oficial)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_2_1"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_2_1/" itemprop="url">
                    <span itemprop="title">Symfony 2.1, el libro oficial</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_2_1/capitulo_14.html" itemprop="url">
                    <span itemprop="title">Capítulo 14. La caché de HTTP</span>
                </a>
            </li>
        
            <li class="active">
                <span>14.3. Introducción a la caché de HTTP</span>
            </li>
        </ol>
    </div>

    <h1 id="introduccion_a_la_cache_de_http" class="title">
        <span>14.3.</span> Introducción a la caché de HTTP
    </h1>

    

<p>Para aprovechar todas las capas de caché disponibles, tu aplicación debe poder comunicar qué respuestas son cacheables y las condiciones que se deben cumplir para que la respuesta cacheada siga considerándose válida. Esto se consigue añadiendo cabeceras HTTP de caché en la respuesta.</p>

<div class="admonition tip"><p><strong class="title">Truco</strong> Ten en cuenta que HTTP no es más que el lenguaje (un lenguaje simple de texto) que los clientes web (navegadores, por ejemplo) y los servidores web utilizan para comunicarse entre sí. Cuando hablamos de la caché HTTP, estamos hablando de la parte de ese lenguaje que permite a los clientes y servidores intercambiar información relacionada con la caché.</p></div>

<p>HTTP especifica las siguientes cuatro cabeceras relacionadas con la caché:</p>

<ul>
<li><code>Cache-Control</code></li>
<li><code>Expires</code></li>
<li><code>ETag</code></li>
<li><code>Last-Modified</code></li>
</ul>

<p>La cabecera más importante y versátil es la cabecera <code>Cache-Control</code>, que en realidad permite establecer muchas opciones relacionadas con la caché.</p>

<h3 id="la_cabecera_cache_control">14.3.1. La cabecera <code>Cache-Control</code></h3>

<p>La cabecera <code>Cache-Control</code> es única porque no sólo permite establecer una opción de configuración de caché sino varias. Cada opción está separada por una coma:</p>

<div class="code code">
<pre class="code">Cache-Control: private, max-age=0, must-revalidate
&nbsp;
Cache-Control: max-age=3600, must-revalidate</pre>
</div>

<p>Symfony permite establecer los valores de la cabecera <code>Cache-Control</code> mediante una interfaz sencilla orientada a objetos:</p>

<div class="code php">
<pre class="php"><span class="co1">// ...</span>
&nbsp;
<span class="kw2">use</span> Symfony\Component\HttpFoundation\Response<span class="sy0">;</span>
&nbsp;
<span class="re0">$response</span> <span class="sy0">=</span> <span class="kw2">new</span> Response<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// indica si la respuesta es pública o privada</span>
<span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">setPublic</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">setPrivate</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// establece la duración máxima de la caché privada o compartida</span>
<span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">setMaxAge</span><span class="br0">&#40;</span><span class="nu0">600</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">setSharedMaxAge</span><span class="br0">&#40;</span><span class="nu0">600</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// establece una directiva Cache-Control concreta</span>
<span class="re0">$response</span><span class="sy0">-&gt;</span><span class="me1">headers</span><span class="sy0">-&gt;</span><span class="me1">addCacheControlDirective</span><span class="br0">&#40;</span><span class="st_h">'must-revalidate'</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<h3 id="respuestas_publicas_y_privadas">14.3.2. Respuestas públicas y privadas</h3>

<p>Tanto las <em>gateway cache</em> como las <em>proxy cache</em> se considean cachés compartidas porque el contenido guardado en caché se comparte con más de un usuario. Si por error estas cachés almacenan alguna vez información privada del usuario, se servirá la misma información privada a todos los usuarios. ¡Imagina que la información de tu cuenta se guarda en caché y luego se devuelve a cualquier usuario posterior que solicite la página de su cuenta!</p>

<p>Para resolver esta situación, cada respuesta puede indicar si es pública o privada:</p>

<ul>
<li><em>public</em>: indica que la respuesta se puede guardar en cualquier caché privadas o compartidas.</li>
<li><em>private</em>: indica que toda o parte de la respuesta es exclusiva para un solo usuario y no se debe guardar en una caché compartida.</li>
</ul>

<p>Symfony por defecto considera que todas las respuestas son privadas. Para aprovechar las ventajas de las cachés compartidas (como el <em>proxy inverso</em> de Symfony2), tendrás que indicar explícitamente que la respuesta es pública.</p>

<h3 id="metodos_seguros">14.3.3. Métodos seguros</h3>

<p>La caché HTTP sólo funciona para métodos HTTP seguros (como <code>GET</code> y <code>HEAD</code>). Un método seguro es aquél que nunca cambia de estado la aplicación en el servidor al servir la petición (por supuesto sí que puedes guardar información de <em>log</em>, etc.) Esto tiene dos consecuencias que son bastante lógicas:</p>

<ul>
<li>Nunca debes cambiar el estado de tu aplicación al responder a una petición <code>GET</code> o <code>HEAD</code>. Incluso si no utilizas una <em>gateway cache</em>, la presencia del <em>proxy cache</em> significa que las peticiones <code>GET</code> o <code>HEAD</code> pueden llegar al servidor o no.</li>
<li>No esperes que haya métodos <code>PUT</code>, <code>POST</code> o <code>DELETE</code> en la caché. Estos métodos están diseñados para utilizarse cuando modificas el estado de tu aplicación (por ejemplo, al borrar una entrada del blog). Si estos métodos se cachearan, el resultado sería que algunas peticiones que modifican el estado de la aplicación nunca llegarían a la aplicación.</li>
</ul>

<h3 id="reglas_de_cache_y_valores_predeterminados">14.3.4. Reglas de caché y valores predeterminados</h3>

<p>HTTP 1.1 por defecto permite guardar en la caché cualquier recurso a menos que incluya una cabecera <code>Cache-Control</code>. En la práctica, la mayoría de las cachés no hacen nada cuando las peticiones tienen una <em>cookie</em>, una cabecera de autorización, utilizan un método no seguro (es decir, <code>PUT</code>, <code>POST</code>, <code>DELETE</code>), o cuando las respuestas tienen un código de estado de redirección.</p>

<p>Cuando la aplicación no establece ninguna cabecera <code>Cache-Control</code>, Symfony2 añade esta cabecera aplicando las siguientes reglas:</p>

<ul>
<li>Si no has definido ninguna cabecera relacionada con la caché (<code>Cache-Control</code>, <code>Expires</code>, <code>ETag</code> o <code>Last-Modified</code>), <code>Cache-Control</code> se establece a <code>no-cache</code>, lo que significa que la respuesta no se guarda en la caché.</li>
<li>Si la cabecera <code>Cache-Control</code> está vacía pero utilizas alguna de las otras cabeceras de caché, su valor se establece a <code>private, must-revalidate</code>.</li>
<li>Si al menos una directiva de <code>Cache-Control</code> está establecida, y no se han añadido directivas <code>public</code> o <code>private</code> de forma explícita, Symfony2 añade la directiva <code>private</code> automáticamente (excepto cuando utilizas <code>s-maxage</code>).</li>
</ul>



    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_14/las_caches_de_tipo_gateway_cache.html">
                        <strong>&larr; Anterior</strong>
                        <small>14.2. Las cachés de tipo <em>gateway cache</em></small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_14/caducidad_y_validacion_http.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>14.4.  Caducidad y validación HTTP</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Symfony2 y los fundamentos de HTTP</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> De PHP a Symfony2</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Instalando y configurando Symfony2</a>
            </li>
                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Creando páginas en Symfony2</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> El controlador</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El enrutamiento</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Creando y utilizando plantillas</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> La base de datos y Doctrine</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> La base de datos y Propel</a>
            </li>
                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Tests unitarios y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Validación</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Formularios</a>
            </li>
                                                                                                                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_14.html">
                    <span>Capítulo 14.</span> La caché de HTTP
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/utilizando_los_estandares_para_la_cache.html">
                    <span>14.1.</span> Utilizando los estándares para la caché
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/las_caches_de_tipo_gateway_cache.html">
                    <span>14.2.</span> Las cachés de tipo <em>gateway cache</em>
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_14/introduccion_a_la_cache_de_http.html">
                    <span>14.3.</span> Introducción a la caché de HTTP
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/caducidad_y_validacion_http.html">
                    <span>14.4.</span>  Caducidad y validación HTTP
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/utilizando_esi.html">
                    <span>14.5.</span> Utilizando ESI
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/invalidando_la_cache.html">
                    <span>14.6.</span> Invalidando la caché
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/resumen.html">
                    <span>14.7.</span> Resumen
                </a>
            </li>
                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> El contenedor de servicios</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Mejorando el rendimiento</a>
            </li>
                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> El interior de Symfony2</a>
            </li>
                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> La API estable de Symfony2</a>
            </li>
                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
