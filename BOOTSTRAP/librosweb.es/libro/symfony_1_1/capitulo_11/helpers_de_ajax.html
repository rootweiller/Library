<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>11.3. Helpers de Ajax (Symfony 1.1, la guía definitiva)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_11/prototype.html" />
                    <link rel="next" href="../capitulo_11/parametros_para_la_ejecucion_remota.html" />
                <link rel="start" href="/libro/symfony_1_1/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="11.3. Helpers de Ajax (Symfony 1.1, la guía definitiva)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_1_1"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_1/" itemprop="url">
                    <span itemprop="title">Symfony 1.1, la guía definitiva</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_1/capitulo_11.html" itemprop="url">
                    <span itemprop="title">Capítulo 11. Integración con Ajax</span>
                </a>
            </li>
        
            <li class="active">
                <span>11.3. Helpers de Ajax</span>
            </li>
        </ol>
    </div>

    <h1 id="helpers_de_ajax" class="title">
        <span>11.3.</span> Helpers de Ajax
    </h1>

    

<p>¿Qué sucede si se quiere actualizar un elemento de la página no con JavaScript como en el listado 11-5, sino mediante un script de PHP que se encuentra en el servidor? De esta forma, sería posible modificar parte de la página en función de una respuesta del servidor. El <em>helper</em> <code>remote_function()</code> realiza exactamente esa tarea, como se demuestra en el listado 11-8.</p>

<p><strong>Listado 11-8 - Uso del <em>helper</em> <code>remote_function()</code></strong></p>

<div class="code php">
<pre class="php">&lt;div id=&quot;mizona&quot;&gt;&lt;/div&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> javascript_tag<span class="br0">&#40;</span>
  remote_function<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'update'</span>  <span class="sy0">=&gt;</span> <span class="st_h">'mizona'</span><span class="sy0">,</span>
    <span class="st_h">'url'</span>     <span class="sy0">=&gt;</span> <span class="st_h">'mimodulo/miaccion'</span><span class="sy0">,</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> El parámetro <code>url</code> puede contener una URI interna (<code>modulo/accion?clave1=valor1&amp;...</code>) o el nombre de una regla del sistema de enrutamiento, al igual que sucede con el <em>helper</em> <code>url_for()</code>.</p></div>

<p>Cuando se ejecuta, el script anterior actualiza el contenido del elemento cuyo <code>id</code> es igual a <code>mizona</code> con la respuesta de la acción <code>mimodulo/miaccion</code>. Este tipo de interacción se llama Ajax, y es el núcleo de las aplicaciones web más interactivas. La versión en inglés de la Wikipedia (http://en.wikipedia.org/wiki/AJAX) lo describe de la siguiente manera:</p>

<p>Ajax permite que las páginas web respondan de forma más rápida mediante el intercambio en segundo plano de pequeñas cantidades de datos con el servidor, por lo que no es necesario recargar la página entera cada vez que el usuario realiza un cambio. El objetivo es aumentar la interactividad, la rapidez y la usabilidad de la página.</p>

<p>Ajax depende de <code>XMLHttpRequest</code>, un objeto JavaScript cuyo comportamiento es similar a un <em>frame</em> oculto, cuyo contenido se puede actualizar realizando una petición al servidor y se puede utilizar para manipular el resto de la página web. Se trata de un objeto a muy bajo nivel, por lo que los navegadores lo tratan de forma diferente y el resultado es que se necesitan muchas líneas de código para realizar peticiones Ajax a mano. Afortunadamente, Prototype encapsula todo el código necesario para trabajar con Ajax y proporciona un objeto <code>Ajax</code> mucho más simple y que también utiliza Symfony. Este es el motivo por el que la librería Prototype se carga automáticamente cuando se utiliza un <em>helper</em> de Ajax en la plantilla.</p>

<div class="admonition tip"><p><strong class="title">Truco</strong> Los <em>helpers</em> de Ajax no funcionan si la URL de la acción remota no pertenece al mismo dominio que la página web que la llama. Se trata de una restricción por motivos de seguridad que imponen los navegadores y que no puede saltarse.</p></div>

<p>Las interacciones de Ajax están formadas por tres partes: el elemento que la invoca (un enlace, un formulario, un botón, un contador de tiempo o cualquier otro elemento que el usuario manipula e invoca la acción), la acción del servidor y una zona de la página en la que mostrar la respuesta de la acción. Se pueden crear interacciones más complejas si por ejemplo la acción remota devuelve datos que se procesan en una función JavaScript en el navegador del cliente. Symfony incluye numerosos <em>helpers</em> para insertar interacciones Ajax en las plantillas y todos contienen la palabra <code>remote</code> en su nombre. Además, todos comparten la misma sintaxis, un array asociativo con todos los parámetros de Ajax. Debe tenerse en cuenta que los <em>helpers</em> de Ajax generan código HTML, no código JavaScript.</p>

<div class="admonition sidebar"><p><strong class="title"> ¿Qué sucede con las acciones para Ajax?</strong> Las acciones que se invocan de forma remota no dejan de ser acciones normales y corrientes. Se les aplica el sistema de enrutamiento, determinan la vista que deben generar en función del valor que devuelven, pasan variables a sus plantillas y pueden modificar el modelo como cualquier otra acción.</p>

<p>Sin embargo, cuando se invocan mediante Ajax, las acciones devuelven el valor <code>true</code> a la siguiente función:</p>

<div class="code php">
<pre class="php"><span class="re0">$esAjax</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getRequest</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">isXmlHttpRequest</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Symfony es capaz de darse cuenta de que una acción se está ejecutando en un contexto Ajax y puede adaptar la respuesta de forma adecuada. Por tanto, y por defecto, las acciones Ajax no incluyen la barra de depuración de aplicaciones ni siquiera en el entorno de desarrollo. Además, no aplican el proceso de decoración (es decir, sus plantillas no se insertan por defecto en el layout correspondiente). Si se necesita decorar la vista de una acción Ajax, se debe indicar explícitamente la opción <code>has_layout: true</code> para su vista en el archivo <code>view.yml</code>.</p>

<p>Como el tiempo de respuesta es crucial en las interacciones Ajax, si la respuesta es sencilla, es una buena idea no crear la vista completa y devolver la respuesta directamente en forma de texto. Se puede utilizar por tanto el método <code>renderText()</code> en la acción para no utilizar la plantilla y mejorar el tiempo de respuesta de las peticiones Ajax.</p>

<p>La mayoría de acciones Ajax finalizan con una plantilla que simplemente incluye un elemento parcial, porque el código de la respuesta Ajax ya se ha utilizado para mostrar la página inicial. Para evitar tener que crear una plantilla sólo para una línea de código, a partir de Symfony 1.1 la acción puede utilizar el método <code>renderPartial()</code>. Este método se aprovecha de las ventajas de la reutilización de los elementos parciales, sus posibilidades de cache y la velocidad de ejecución del método <code>renderText()</code>.</p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> executeMiAccion<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="co1">// Código PHP de la acción</span>
  <span class="kw1">return</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">renderPartial</span><span class="br0">&#40;</span><span class="st_h">'mimodulo/miparcial'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p></p></div>

<h3 id="enlaces_ajax">11.3.1. Enlaces Ajax</h3>

<p>Los enlaces Ajax constituyen una de las partes más importantes de las interacciones Ajax realizadas en las aplicaciones de la Web 2.0. El <em>helper</em> <code>link_to_remote()</code> muestra un enlace que llama a una función remota. La sintaxis es muy similar a <code>link_to()</code>, excepto que el segundo parámetro es el array asociativo con las opciones Ajax, como muestra el listado 11-9.</p>

<p><strong>Listado 11-9 - Enlace Ajax realizado con el <em>helper</em> <code>link_to_remote()</code></strong></p>

<div class="code php">
<pre class="php">&lt;div id=&quot;respuesta&quot;&gt;&lt;/div&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> link_to_remote<span class="br0">&#40;</span><span class="st_h">'Borrar este post'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'update'</span> <span class="sy0">=&gt;</span> <span class="st_h">'respuesta'</span><span class="sy0">,</span>
    <span class="st_h">'url'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'post/borrar?id='</span><span class="sy0">.</span><span class="re0">$post</span><span class="sy0">-&gt;</span><span class="me1">getId</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<p>En el ejemplo anterior, al pulsar sobre el enlace <code>"Borrar este post"</code> se realiza una llamada en segundo plano a la acción <code>post/borrar</code>. La respuesta devuelta por el servidor se muestra automáticamente en el elemento de la página cuyo atributo <code>id</code> sea igual a <code>respuesta</code>. La figura 11-1 ilustra el proceso completo.</p>

<div class="figure" id="figure_11_1">
    <img src="/img/symfony_1_1/f1101.png" alt="Ejecutando una actualización remota mediante un enlace" />

    <p class="caption"><strong>Figura 11.1</strong> Ejecutando una actualización remota mediante un enlace</p>
</div>


<p>También es posible utilizar una imagen en vez de texto para mostrar el enlace, utilizar el nombre de una regla de enrutamiento en vez de <code>modulo/accion</code> y añadir opciones a la etiqueta <code>&lt;a&gt;</code> como tercer argumento, tal y como muestra el listado 11-10.</p>

<p><strong>Listado 11-10 - Opciones del <em>helper</em> <code>link_to_remote()</code></strong></p>

<div class="code php">
<pre class="php">&lt;div id=&quot;emails&quot;&gt;&lt;/div&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> link_to_remote<span class="br0">&#40;</span>image_tag<span class="br0">&#40;</span><span class="st_h">'refresh'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'update'</span> <span class="sy0">=&gt;</span> <span class="st_h">'emails'</span><span class="sy0">,</span>
    <span class="st_h">'url'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'@listado_emails'</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'class'</span>  <span class="sy0">=&gt;</span> <span class="st_h">'enlace_ajax'</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<h3 id="formularios_ajax">11.3.2. Formularios Ajax</h3>

<p>Los formularios web normalmente realizan una llamada a una acción que provoca que se deba recargar la página completa. El <em>helper</em> equivalente a <code>link_to_function()</code> para un formulario sería un <em>helper</em> que enviara los datos del formulario al servidor y que actualizara un elemento de la página con la respuesta del servidor. Eso es precisamente lo que hace el <em>helper</em> <code>form_remote_tag()</code>, y su sintaxis se muestra en el listado 11-11.</p>

<p><strong>Listado 11-11 - Formulario Ajax con el <em>helper</em> <code>form_remote_tag()</code></strong></p>

<div class="code php">
<pre class="php">&lt;div id=&quot;lista_elementos&quot;&gt;&lt;/div&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> form_remote_tag<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'update'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'lista_elementos'</span><span class="sy0">,</span>
    <span class="st_h">'url'</span>      <span class="sy0">=&gt;</span> <span class="st_h">'elemento/anadir'</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  &lt;label for=&quot;elemento&quot;&gt;Elemento:&lt;/label&gt;
  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> input_tag<span class="br0">&#40;</span><span class="st_h">'elemento'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> submit_tag<span class="br0">&#40;</span><span class="st_h">'Añadir'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
&lt;/form&gt;</pre>
</div>

<p>El <em>helper</em> <code>form_remote_tag()</code> crea una etiqueta <code>&lt;form&gt;</code> de apertura, como sucede con el <em>helper</em> <code>form_tag()</code>. El envío del formulario consiste en el envío en segundo plano de una petición de tipo <code>POST</code> a la acción <code>elemento/anadir</code> y con la variable <code>elemento</code> como parámetro de la petición. La respuesta del servidor reemplaza los contenidos del elemento cuyo atributo <code>id</code> sea igual a <code>lista_elementos</code>, como se muestra en la figura 11-2. Los formularios Ajax se cierran con una etiqueta <code>&lt;/form&gt;</code> de cierre de formularios.</p>

<div class="figure" id="figure_11_2">
    <img src="/img/symfony_1_1/f1102.png" alt="Ejecutando una actualización remota mediante un formulario" />

    <p class="caption"><strong>Figura 11.2</strong> Ejecutando una actualización remota mediante un formulario</p>
</div>


<div class="admonition caution"><p><strong class="title">Advertencia</strong> Los formularios Ajax no pueden ser <code>multipart</code>, debido a una limitación del objeto <code>XMLHttpRequest</code>. En otras palabras, no es posible enviar archivos mediante formularios Ajax. Existen algunas técnicas para saltarse esta limitación, como por ejemplo utilizar un <code>iframe</code> oculto en vez del objeto <code>XMLHttpRequest</code>.</p></div>

<p>Si es necesario incluir un formulario que sea <em>normal</em> y Ajax a la vez, lo mejor es definirlo como formulario <em>normal</em> y añadir, además del botón de envío tradicional, un segundo botón (<code>&lt;input type="button" /&gt;</code>) para enviar el formulario mediante Ajax. Symfony define este botón mediante el <em>helper</em> <code>submit_to_remote()</code>. De esta forma, es posible definir interacciones Ajax que se degradan correctamente en los navegadores que no las soportan. El listado 11-12 muestra un ejemplo.</p>

<p><strong>Listado 11-12 - Formulario con envío de datos tradicional y Ajax</strong></p>

<div class="code php">
<pre class="php">&lt;div id=&quot;lista_elementos&quot;&gt;&lt;/div&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> form_tag<span class="br0">&#40;</span><span class="st_h">'@elemento_anadir_normal'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  &lt;label for=&quot;elemento&quot;&gt;Elemento:&lt;/label&gt;
  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> input_tag<span class="br0">&#40;</span><span class="st_h">'elemento'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  <span class="kw2">&lt;?php</span> if_javascript<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="sy1">?&gt;</span>
    <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> submit_to_remote<span class="br0">&#40;</span><span class="st_h">'envio_ajax'</span><span class="sy0">,</span> <span class="st_h">'Anadir con Ajax'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'update'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'lista_elementos'</span><span class="sy0">,</span>
        <span class="st_h">'url'</span>      <span class="sy0">=&gt;</span> <span class="st_h">'@elemento_anadir'</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  <span class="kw2">&lt;?php</span> end_if_javascript<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="sy1">?&gt;</span>
  &lt;noscript&gt;
    <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> submit_tag<span class="br0">&#40;</span><span class="st_h">'Anadir'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  &lt;/noscript&gt;
&lt;/form&gt;</pre>
</div>

<p>Otro ejemplo en el que se podría utilizar la combinación de botones normales y botones Ajax es el de un formulario que edita un artículo o noticia. Podría incluir un botón realizado con Ajax para previsualizar los contenidos y un botón normal para publicar los contenidos directamente.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Si el usuario envía el formulario pulsando la tecla <code>Enter</code>, el formulario se envía utilizando la acción definida en la etiqueta <code>&lt;form&gt;</code> principal, es decir, la acción <em>normal</em> y no la acción Ajax.</p></div>

<p>Los formularios más modernos no solo se encargan de enviar sus datos cuando el usuario pulsa sobre el botón de envío, sino que también pueden reaccionar a los cambios producidos por el usuario sobre alguno de sus campos. Symfony proporciona el <em>helper</em> <code>observe_field()</code> para realizar esa tarea. El listado 11-13 muestra un ejemplo de uso de este <em>helper</em> para crear un sistema que sugiere valores a medida que el usuario escribe sobre un campo: cada carácter escrito en el campo <code>elemento</code> lanza una petición Ajax que actualiza el valor del elemento <code>sugerencias_elemento</code> de la página.</p>

<p><strong>Listado 11-13 - Ejecutando una función remota cada vez que cambia el valor de un campo de formulario mediante <code>observe_field()</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span> <span class="kw1">echo</span> form_tag<span class="br0">&#40;</span><span class="st_h">'@elemento_anadir_normal'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  &lt;label for=&quot;elemento&quot;&gt;Elemento:&lt;/label&gt;
  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> input_tag<span class="br0">&#40;</span><span class="st_h">'elemento'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  &lt;div id=&quot;sugerencias_elemento&quot;&gt;&lt;/div&gt;
  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> observe_field<span class="br0">&#40;</span><span class="st_h">'elemento'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'update'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'sugerencias_elemento'</span><span class="sy0">,</span>
      <span class="st_h">'url'</span>      <span class="sy0">=&gt;</span> <span class="st_h">'@elemento_escrito'</span><span class="sy0">,</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> submit_tag<span class="br0">&#40;</span><span class="st_h">'Anadir'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
&lt;/form&gt;</pre>
</div>

<p>El par modulo/accion correspondiente a la regla <code>@elemento_escrito</code> se ejecuta cada vez que el usuario modifica el valor del campo de formulario que se está observando (en este caso, <code>elemento</code>) sin necesidad de enviar el formulario. La acción puede acceder a los caracteres escritos en cada momento por el usuario mediante el parámetro <code>elemento</code> de la petición. Si se necesita enviar otro valor en vez del contenido del campo de formulario que se está observando, se puede especificar en forma de expresión JavaScript en el parámetro <code>with</code>. Si por ejemplo es necesario que la acción disponga de un parámetro llamado <code>param</code>, se puede utilizar el <em>helper</em> <code>observe_field()</code> como muestra el listado 11-14.</p>

<p><strong>Listado 11-14 - Pasando parámetros personalizados a la acción remota con la opción <code>with</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span> <span class="kw1">echo</span> observe_field<span class="br0">&#40;</span><span class="st_h">'elemento'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'update'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'sugerencias_elemento'</span><span class="sy0">,</span>
    <span class="st_h">'url'</span>      <span class="sy0">=&gt;</span> <span class="st_h">'@elemento_escrito'</span><span class="sy0">,</span>
    <span class="st_h">'with'</span>     <span class="sy0">=&gt;</span> <span class="st0">&quot;'param=' + value&quot;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<p>Este <em>helper</em> no genera un elemento HTML, sino que añade un <em>comportamiento</em> (del inglés, <em>"behavior"</em>) al elemento que se pasa como parámetro. Más adelante en este capítulo se describen más ejemplos de <em>helpers</em> de JavaScript que añaden comportamientos.</p>

<p>Si se quieren observar todos los campos de un formulario, se puede utilizar el <em>helper</em> <code>observe_form()</code>, que llama a una función remota cada vez que se modifica uno de los campos del formulario.</p>

<h3 id="ejecucion_periodica_de_funciones_remotas">11.3.3. Ejecución periódica de funciones remotas</h3>

<p>Por último, el <em>helper</em> <code>periodically_call_remote()</code> permite crear una interacción de Ajax que se repite cada pocos segundos. No está asociado con ningún elemento HTML de la página, sino que se ejecuta de forma transparente en segundo plano como una especie de comportamiento de la página entera. Se puede utilizar para seguir la posición del puntero del ratón, autoguardar el contenido de un área de texto grande, etc. El listado 11-15 muestra un ejemplo de uso de este <em>helper</em>.</p>

<p><strong>Listado 11-15 - Ejecutando periódicamente una función remota mediante <code>periodically_call_remote()</code></strong></p>

<div class="code php">
<pre class="php">&lt;div id=&quot;notificacion&quot;&gt;&lt;/div&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> periodically_call_remote<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'frequency'</span> <span class="sy0">=&gt;</span> <span class="nu0">60</span><span class="sy0">,</span>
    <span class="st_h">'update'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'notificacion'</span><span class="sy0">,</span>
    <span class="st_h">'url'</span>       <span class="sy0">=&gt;</span> <span class="st_h">'@observa'</span><span class="sy0">,</span>
    <span class="st_h">'with'</span>      <span class="sy0">=&gt;</span> <span class="st0">&quot;'param=' + <span class="es1">\$</span>F('micontenido')&quot;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<p>Si no se especifica el número de segundos (mediante el parámetro <code>frequency</code>) que se esperan después de cada repetición, se tiene en cuenta el valor por defecto que son 10 segundos. El parámetro <code>with</code> se evalúa con JavaScript, así que se puede utilizar cualquier función de Prototype, como por ejemplo la función <code>$F()</code>.</p>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_11/prototype.html">
                        <strong>&larr; Anterior</strong>
                        <small>11.2. Prototype</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_11/parametros_para_la_ejecucion_remota.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>11.4. Parámetros para la ejecución remota</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Symfony</a>
            </li>
                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Explorando el interior de Symfony</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Ejecutar aplicaciones Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Introducción a la creación de páginas</a>
            </li>
                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Configurar Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El Controlador</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> La Vista</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> El modelo</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Enlaces y sistema de enrutamiento</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Formularios</a>
            </li>
                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_11.html">
                    <span>Capítulo 11.</span> Integración con Ajax
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/helpers_basicos_de_javascript.html">
                    <span>11.1.</span> Helpers básicos de JavaScript
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/prototype.html">
                    <span>11.2.</span> Prototype
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_11/helpers_de_ajax.html">
                    <span>11.3.</span> Helpers de Ajax
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/parametros_para_la_ejecucion_remota.html">
                    <span>11.4.</span> Parámetros para la ejecución remota
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/creando_efectos_visuales.html">
                    <span>11.5.</span> Creando efectos visuales
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/json.html">
                    <span>11.6.</span> JSON
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/interacciones_complejas_con_ajax.html">
                    <span>11.7.</span> Interacciones complejas con Ajax
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/resumen.html">
                    <span>11.8.</span> Resumen
                </a>
            </li>
                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Uso de la cache</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Internacionalización y localización</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Generador de la parte de administración</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Pruebas unitarias y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Herramientas para la administración de aplicaciones</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Personalizar Symfony</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Rendimiento</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Configuración avanzada</a>
            </li>
                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
