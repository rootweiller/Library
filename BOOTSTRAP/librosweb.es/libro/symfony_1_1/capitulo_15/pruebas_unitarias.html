<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>15.2. Pruebas unitarias (Symfony 1.1, la guía definitiva)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_15/automatizacion_de_pruebas.html" />
                    <link rel="next" href="../capitulo_15/pruebas_funcionales.html" />
                <link rel="start" href="/libro/symfony_1_1/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="15.2. Pruebas unitarias (Symfony 1.1, la guía definitiva)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_1_1"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_1/" itemprop="url">
                    <span itemprop="title">Symfony 1.1, la guía definitiva</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_1/capitulo_15.html" itemprop="url">
                    <span itemprop="title">Capítulo 15. Pruebas unitarias y funcionales</span>
                </a>
            </li>
        
            <li class="active">
                <span>15.2. Pruebas unitarias</span>
            </li>
        </ol>
    </div>

    <h1 id="pruebas_unitarias" class="title">
        <span>15.2.</span> Pruebas unitarias
    </h1>

    

<p>Las pruebas unitarias de Symfony son archivos PHP normales cuyo nombre termina en <code>Test.php</code> y que se encuentran en el directorio <code>test/unit/</code> de la aplicación. Su sintaxis es sencilla y fácil de leer.</p>

<h3 id="que_aspecto_tienen_las_pruebas_unitarias">15.2.1. ¿Qué aspecto tienen las pruebas unitarias?</h3>

<p>El listado 15-1 muestra un conjunto típico de pruebas unitarias para la función <code>strtolower()</code>. En primer lugar, se instancia el objeto <code>lime_test</code> (todavía no hace falta que te preocupes de sus parámetros). Cada prueba unitaria consiste en una llamada a un método de la instancia de <code>lime_test</code>. El último parámetro de estos métodos siempre es una cadena de texto opcional que se utiliza como resultado del método.</p>

<p><strong>Listado 15-1 - Archivo de ejemplo de prueba unitaria, en <code>test/unit/strtolowerTest.php</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw1">include</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../bootstrap/unit.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">require_once</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../../lib/strtolower.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="nu0">7</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// strtolower()</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">diag</span><span class="br0">&#40;</span><span class="st_h">'strtolower()'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">isa_ok</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">'Foo'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'string'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() returns a string'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">'FOO'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'foo'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() transforms the input to lowercase'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">'foo'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'foo'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() leaves lowercase characters unchanged'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">'12#?@~'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'12#?@~'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() leaves non alphabetical characters unchanged'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">'FOO BAR'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'foo bar'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() leaves blanks alone'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">'FoO bAr'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'foo bar'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() deals with mixed case input'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="kw3">strtolower</span><span class="br0">&#40;</span><span class="st_h">''</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'foo'</span><span class="sy0">,</span>
    <span class="st_h">'strtolower() transforms empty strings into foo'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Para ejecutar el conjunto de pruebas, se utiliza la tarea <code>test:unit</code> desde la línea de comandos. El resultado de esta tarea en la línea de comandos es muy explícito, lo que permite localizar fácilmente las pruebas que han fallado y las que se han ejecutado correctamente. El listado 15-2 muestra el resultado del ejemplo anterior.</p>

<p><strong>Listado 15-2 - Ejecutando una prueba unitaria desde la línea de comandos</strong></p>

<div class="code cli">
<pre class="cli">&gt; php symfony test:unit strtolower
&nbsp;
1..7
# strtolower()
ok 1 - strtolower() returns a string
ok 2 - strtolower() transforms the input to lowercase
ok 3 - strtolower() leaves lowercase characters unchanged
ok 4 - strtolower() leaves non alphabetical characters unchanged
ok 5 - strtolower() leaves blanks alone
ok 6 - strtolower() deals with mixed case input
not ok 7 - strtolower() transforms empty strings into foo
#     Failed test (.\batch\test.php at line 21)
#            got: ''
#       expected: 'foo'
# Looks like you failed 1 tests of 7.</pre>
</div>

<div class="admonition tip"><p><strong class="title">Truco</strong> La instrucción <code>include</code> al principio del listado 15-1 es opcional, pero hace que el archivo de la prueba sea un script de PHP independiente, es decir, que se puede ejecutar sin utilizar la línea de comandos de Symfony, mediante <code>php test/unit/strtolowerTest.php</code>.</p></div>

<h3 id="metodos_para_las_pruebas_unitarias">15.2.2. Métodos para las pruebas unitarias</h3>

<p>El objeto <code>lime_test</code> dispone de un gran número de métodos para las pruebas, como se muestra en la figura 15-2.</p>

<p><strong>Tabla 15-2 - Métodos del objeto <code>lime_test</code> para las pruebas unitarias</strong></p>

<div class="table" id="table_15_2">

    <table>
<thead>
<tr>
  <th>Método</th>
  <th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>diag($mensaje)</code></td>
  <td>Muestra un comentario, pero no ejecuta ninguna prueba</td>
</tr>
<tr>
  <td><code>ok($prueba, $mensaje)</code></td>
  <td>Si la condición que se indica es <code>true</code>, la prueba tiene éxito</td>
</tr>
<tr>
  <td><code>is($valor1, $valor2, $mensaje)</code></td>
  <td>Compara 2 valores y la prueba pasa si los 2 son iguales (<code>==</code>)</td>
</tr>
<tr>
  <td><code>isnt($valor1, $valor2, $mensaje)</code></td>
  <td>Compara 2 valores y la prueba pasa si no son iguales</td>
</tr>
<tr>
  <td><code>like($cadena, $expresionRegular, $mensaje)</code></td>
  <td>Prueba que una cadena cumpla con el patrón de una expresión regular</td>
</tr>
<tr>
  <td><code>unlike($cadena, $expresionRegular, $mensaje)</code></td>
  <td>Prueba que una cadena no cumpla con el patrón de una expresión regular</td>
</tr>
<tr>
  <td><code>cmp_ok($valor1, $operador, $valor2, $mensaje)</code></td>
  <td>Compara 2 valores mediante el operador que se indica</td>
</tr>
<tr>
  <td><code>isa_ok($variable, $tipo, $mensaje)</code></td>
  <td>Comprueba si la variable que se le pasa es del tipo que se indica</td>
</tr>
<tr>
  <td><code>isa_ok($objeto, $clase, $mensaje)</code></td>
  <td>Comprueba si el objeto que se le pasa es de la clase que se indica</td>
</tr>
<tr>
  <td><code>can_ok($objeto, $metodo, $mensaje)</code></td>
  <td>Comprueba si el objeto que se le pasa dispone del método que se indica</td>
</tr>
<tr>
  <td><code>is_deeply($array1, $array2, $mensaje)</code></td>
  <td>Comprueba que 2 arrays tengan los mismos valores</td>
</tr>
<tr>
  <td><code>include_ok($archivo, $mensaje)</code></td>
  <td>Valida que un archivo existe y que ha sido incluido correctamente</td>
</tr>
<tr>
  <td><code>fail()</code></td>
  <td>Provoca que la prueba siempre falle (es útil para las excepciones)</td>
</tr>
<tr>
  <td><code>pass()</code></td>
  <td>Provoca que la prueba siempre se pase (es útil para las excepciones)</td>
</tr>
<tr>
  <td><code>skip($mensaje, $numeroPruebas)</code></td>
  <td>Cuenta como si fueran <code>$numeroPruebas</code> pruebas (es útil para las pruebas condicionales)</td>
</tr>
<tr>
  <td><code>todo()</code></td>
  <td>Cuenta como si fuera 1 prueba (es útil para las pruebas que todavía no se han escrito)</td>
</tr>
</tbody>
</table>
</div>


<p>La sintaxis es tan clara que prácticamente se explica por sí sola. Casi todos los métodos permiten indicar un mensaje como último parámetro. Este mensaje es el que se muestra como resultado de la prueba cuando esta tiene éxito. La mejor manera de aprender a utilizar estos métodos es utilizarlos, así que es importante el código del listado 15-3, que utiliza todos los métodos.</p>

<p><strong>Listado 15-3 - Probando los métodos del objeto <code>lime_test</code>, en <code>test/unit/ejemploTest.php</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw1">include</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../bootstrap/unit.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Funciones y objetos vacíos para las pruenas</span>
<span class="kw2">class</span> miObjeto
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> miMetodo<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">function</span> lanza_una_excepcion<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw1">throw</span> <span class="kw2">new</span> Exception<span class="br0">&#40;</span><span class="st_h">'excepción lanzada'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co1">// Inicializar el objeto de pruebas</span>
<span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="nu0">16</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">diag</span><span class="br0">&#40;</span><span class="st_h">'hola mundo'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">ok</span><span class="br0">&#40;</span><span class="nu0">1</span> <span class="sy0">==</span> <span class="st_h">'1'</span><span class="sy0">,</span> <span class="st_h">'el operador de igualdad ignora el tipo de la variable'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="st_h">'1'</span><span class="sy0">,</span> <span class="st_h">'las cadenas se convierten en números para realizar la comparación'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">isnt</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="st_h">'0 y 1 no son lo mismo'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">like</span><span class="br0">&#40;</span><span class="st_h">'prueba01'</span><span class="sy0">,</span> <span class="st_h">'/prueba\d+/'</span><span class="sy0">,</span> <span class="st_h">'prueba01 sigue el patrón para numerar las pruebas'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">unlike</span><span class="br0">&#40;</span><span class="st_h">'pruebas01'</span><span class="sy0">,</span> <span class="st_h">'/prueba\d+/'</span><span class="sy0">,</span> <span class="st_h">'pruebas01 no sigue el patrón'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">cmp_ok</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="st_h">'&lt;'</span><span class="sy0">,</span> <span class="nu0">2</span><span class="sy0">,</span> <span class="st_h">'1 es inferior a 2'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">cmp_ok</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="st_h">'!=='</span><span class="sy0">,</span> <span class="kw4">true</span><span class="sy0">,</span> <span class="st_h">'1 y true no son exactamente lo mismo'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">isa_ok</span><span class="br0">&#40;</span><span class="st_h">'valor'</span><span class="sy0">,</span> <span class="st_h">'string'</span><span class="sy0">,</span> <span class="st_h">'\'valor\' es una cadena de texto'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">isa_ok</span><span class="br0">&#40;</span><span class="kw2">new</span> miObjeto<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'miObjeto'</span><span class="sy0">,</span> <span class="st_h">'new crea un objeto de la clase correcta'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">can_ok</span><span class="br0">&#40;</span><span class="kw2">new</span> miObjeto<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'miMetodo'</span><span class="sy0">,</span> <span class="st_h">'los objetos de la clase miObjeto tienen un método llamado miMetodo'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$array1</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">2</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="nu0">1</span> <span class="sy0">=&gt;</span> <span class="st_h">'valor'</span><span class="sy0">,</span> <span class="st_h">'a'</span> <span class="sy0">=&gt;</span> <span class="st_h">'4'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is_deeply</span><span class="br0">&#40;</span><span class="re0">$array1</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">2</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="nu0">1</span> <span class="sy0">=&gt;</span> <span class="st_h">'valor'</span><span class="sy0">,</span> <span class="st_h">'a'</span> <span class="sy0">=&gt;</span> <span class="st_h">'4'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'el primer array y el segundo array son iguales'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">include_ok</span><span class="br0">&#40;</span><span class="st_h">'./nombreArchivo.php'</span><span class="sy0">,</span> <span class="st_h">'el archivo nombreArchivo.php ha sido incluido correctamente'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
try
<span class="br0">&#123;</span>
  lanza_una_excepcion<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">fail</span><span class="br0">&#40;</span><span class="st_h">'no debería ejecutarse ningún código después de lanzarse la excepción'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
catch <span class="br0">&#40;</span>Exception <span class="re0">$e</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">pass</span><span class="br0">&#40;</span><span class="st_h">'la excepción ha sido capturada correctamente'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span><span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$variable</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">skip</span><span class="br0">&#40;</span><span class="st_h">'saltamos una prueba para mantener el contador de pruebas correcto para la condición'</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="kw1">else</span>
<span class="br0">&#123;</span>
  <span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">ok</span><span class="br0">&#40;</span><span class="re0">$variable</span><span class="sy0">,</span> <span class="st_h">'valor'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">todo</span><span class="br0">&#40;</span><span class="st_h">'la última prueba que falta'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Las pruebas unitarias de Symfony incluyen muchos más ejemplos de uso de todos estos métodos.</p>

<div class="admonition tip"><p><strong class="title">Truco</strong> Puede que sea confuso el uso de <code>is()</code> en vez de <code>ok()</code> en el ejemplo anterior. La razón es que el mensaje de error que muestra <code>is()</code> es mucho más explícito, ya que muestra los 2 argumentos de la prueba, mientras que <code>ok()</code> simplemente dice que la prueba ha fallado.</p></div>

<h3 id="parametros_para_las_pruebas">15.2.3. Parámetros para las pruebas</h3>

<p>En la inicialización del objeto <code>lime_test</code> se indica como primer parámetro el número de pruebas que se van a ejecutar. Si el número de pruebas realmente realizadas no coincide con este valor, la salida producida por Lime muestra un aviso. El conjunto de pruebas del listado 15-3 producen la salida del listado 15-4. Como en la inicialización se indica que se deben ejecutar 16 pruebas y realmente solo se han realizado 15, en la salida se muestra un mensaje de aviso.</p>

<p><strong>Listado 15-4 - El contador de pruebas realizadas permite planificar las pruebas</strong></p>

<div class="code cli">
<pre class="cli">&gt; php symfony test:unit ejemplo
&nbsp;
1..16
# hola mundo
ok 1 - el operador de igualdad ignora el tipo de la variable
ok 2 - las cadenas se convierten en números para realizar la comparación
ok 3 - 0 y 1 no son lo mismo
ok 4 - prueba01 sigue el patrón para numerar las pruebas
ok 5 - pruebas01 no sigue el patrón
ok 6 - 1 es inferior a 2
ok 7 - 1 y true no son exactamente lo mismo
ok 8 - 'valor' es una cadena de texto
ok 9 - new crea un objeto de la clase correcta
ok 10 - los objetos de la clase miObjeto tienen un método llamado miMetodo
ok 11 - el primer array y el segundo array son iguales
not ok 12 - el archivo nombreArchivo.php ha sido incluido correctamente
#     Failed test (.\test\unit\ejemploTest.php at line 35)
#       Tried to include './nombreArchivo.php'
ok 13 - la excepción ha sido capturada correctamente
ok 14 # SKIP saltamos una prueba para mantener el contador de pruebas correcto para la condición
ok 15 # TODO la última prueba que falta
# Looks like you planned 16 tests but only ran 15.
# Looks like you failed 1 tests of 16.</pre>
</div>

<p>El método <code>diag()</code> no cuenta como una prueba. Se utiliza para mostrar mensajes, de forma que la salida por pantalla esté más organizada y sea más fácil de leer. Por otra parte, los métodos <code>todo()</code> y <code>skip()</code> cuentan como si fueran pruebas reales. La combinación <code>pass()</code>/<code>fail()</code> dentro de un bloque <code>try</code>/<code>catch</code> cuenta como una sola prueba.</p>

<p>Una estrategia de pruebas bien planificada requiere que se indique el número esperado de pruebas. Indicar este número es una buena forma de validar los propios archivos de pruebas, sobre todo en los casos más complicados en los que algunas pruebas se ejecutan dentro de condiciones y/o excepciones. Además, si la prueba falla en cualquier punto, es muy fácil de verlo porque el número de pruebas realizadas no coincide con el número de pruebas esperadas.</p>

<p>El segundo parámetro del constructor del objeto <code>lime_test</code> indica el objeto que se utiliza para mostrar los resultado. Se trata de un objeto que extiende la clase <code>lime_output</code>. La mayoría de las veces, como las pruebas se realizan en una interfaz de comandos, la salida se construye mediante el objeto <code>lime_output_color</code>, que muestra la salida coloreada en los sistemas que lo permiten.</p>

<h3 id="la_tarea_testunit">15.2.4. La tarea test:unit</h3>

<p>La tarea <code>test:unit</code>, que se utiliza para ejecutar las pruebas unitarias desde la línea de comandos, admite como argumento una serie de nombres de pruebas o un patrón de nombre de archivos. El listado 15-5 muestra los detalles.</p>

<p><strong>Listado 15-5 - Ejecutando las pruebas unitarias</strong></p>

<div class="code code">
<pre class="code">// Estructura del directorio de pruebas
    test/
      unit/
        miFuncionalTest.php
        miSegundoFuncionalTest.php
        otro/
          nombreTest.php</pre>
</div>

<div class="code cli">
<pre class="cli">&gt; php symfony test:unit miFuncional                    ## Ejecutar miFuncionalTest.php
&gt; php symfony test:unit miFuncional miSegundoFuncional ## Ejecuta las 2 pruebas
&gt; php symfony test:unit 'otro/*'                       ## Ejecuta nombreTest.php
&gt; php symfony test:unit '*'                            ## Ejecuta todas las pruebas (de forma recursiva)</pre>
</div>

<h3 id="stubs_fixtures_y_carga_automatica_de_clases">15.2.5. Stubs, Fixtures y carga automática de clases</h3>

<p>La carga automática de clases no funciona por defecto en las pruebas unitarias. Por tanto, todas las clases que se utilizan en una prueba se deben definir en el propio archivo de la prueba o se deben incluir como una dependencia externa. Este es el motivo por el que muchos archivos de pruebas empiezan con un grupo de instrucciones <code>include</code>, como se muestra en el listado 15-6.</p>

<p><strong>Listado 15-6 - Incluyendo las clases de forma explícita en las pruebas unitarias</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw1">include</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../bootstrap/unit.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">require_once</span><span class="br0">&#40;</span><span class="re0">$sf_symfony_lib_dir</span><span class="sy0">.</span><span class="st_h">'/util/sfToolkit.class.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="nu0">7</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// isPathAbsolute()</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">diag</span><span class="br0">&#40;</span><span class="st_h">'isPathAbsolute()'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'/test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">true</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns true if path is absolute'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'\\test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">true</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns true if path is absolute'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'C:\\test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">true</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns true if path is absolute'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'d:/test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">true</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns true if path is absolute'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns false if path is relative'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'../test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns false if path is relative'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="st_h">'..\\test'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw4">false</span><span class="sy0">,</span>
    <span class="st_h">'isPathAbsolute() returns false if path is relative'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>En las pruebas unitarias, no solo se debe instanciar el objeto que se está probando, sino también el objeto del que depende. Como las pruebas unitarias deben ser autosuficientes, depender de otras clases puede provocar que más de una prueba falle si alguna clase no funciona correctamente. Además, crear objetos reales es una tarea costosa, tanto en número de líneas de código necesarias como en tiempo de ejecución. Debe tenerse en cuenta que la velocidad de ejecución es esencial para las pruebas unitarias, ya que los programadores en seguida se cansan de los procesos que son muy lentos.</p>

<p>Si se incluyen muchos scripts en una prueba unitaria, lo más útil es utilizar un sistema sencillo de carga automática de clases. Para ello, la clase <code>sfSimpleAutoload</code> (que se debe incluir manualmente) dispone del método <code>addDirectory()</code>, que admite como argumento la ruta absoluta hasta un directorio y que se puede llamar tantas veces como sean necesarias para incluir todos los directorios deseados. Todas las clases que se encuentren bajo esa ruta, se cargarán automáticamente. Si por ejemplo se quieren cargar automáticamente todas las clases del directorio <code>$sf_symfony_lib_dir/util/</code>, se utilizan las siguientes instrucciones al principio del script de la prueba unitaria:</p>

<div class="code php">
<pre class="php"><span class="kw1">require_once</span><span class="br0">&#40;</span><span class="re0">$sf_symfony_lib_dir</span><span class="sy0">.</span><span class="st_h">'/autoload/sfSimpleAutoload.class.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$autoload</span> <span class="sy0">=</span> sfSimpleAutoload<span class="sy0">::</span><span class="me2">getInstance</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$autoload</span><span class="sy0">-&gt;</span><span class="me1">addDirectory</span><span class="br0">&#40;</span><span class="re0">$sf_symfony_lib_dir</span><span class="sy0">.</span><span class="st_h">'/util'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$autoload</span><span class="sy0">-&gt;</span><span class="me1">register</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Otra técnica muy utilizada para evitar los problemas de la carga automática de clases es el uso de <em>stubs</em> o clases falsas. Un <em>stub</em> es una implementación alternativa de una clase en la que los métodos reales se sustituyen por datos simples especialmente preparados. De esta forma, se emula el comportamiento de la clase real y se reduce su tiempo de ejecución. Los casos típicos para utilizar <em>stubs</em> son las conexiones con bases de datos y las interfaces de los servicios web. En el listado 15-7, las pruebas unitarias para una API de un servicio de mapas utilizan la clase <code>WebService</code>. En vez de ejecutar el método <code>fetch()</code> real de la clase del servicio web, la prueba utiliza un <em>stub</em> que devuelve datos de prueba.</p>

<p><strong>Listado 15-7 - Utilizando stubs en las pruebas unitarias</strong></p>

<div class="code php">
<pre class="php"><span class="kw1">require_once</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../../lib/WebService.class.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">require_once</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../../lib/MapAPI.class.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> testWebService <span class="kw2">extends</span> WebService
<span class="br0">&#123;</span>
  <span class="kw2">public</span> static <span class="kw2">function</span> fetch<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw3">file_get_contents</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/fixtures/data/servicio_web_falso.xml'</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="re0">$miMapa</span> <span class="sy0">=</span> <span class="kw2">new</span> MapAPI<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="re0">$miMapa</span><span class="sy0">-&gt;</span><span class="me1">getMapSize</span><span class="br0">&#40;</span>testWebService<span class="sy0">::</span><span class="me2">fetch</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="nu0">100</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Los datos de prueba pueden ser más complejos que una cadena de texto o la llamada a un método. Los datos de prueba complejos se suelen denominar <em>"fixtures"</em>. Para mejorar el código de las pruebas unitarias, es recomendable mantener los <em>fixtures</em> en archivos independientes, sobre todo si se utilizan en más de una prueba. Además, Symfony es capaz de transformar un archivo YAML en un array mediante el método <code>sfYAML::load()</code>. De esta forma, en vez de escribir arrays PHP muy grandes, los datos para las pruebas se pueden guardar en archivos YAML, como en el listado 15-8.</p>

<p><strong>Listado 15-8 - Usando archivos para los "fixtures" de las pruebas unitarias</strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">// En fixtures.yml</span><span class="sy2">:
</span>-<span class="co3">
  input</span><span class="sy2">: </span>  '/test'<span class="co3">
  output</span><span class="sy2">: </span> true<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns true if path is absolute
-<span class="co3">
  input</span><span class="sy2">: </span>  '\\test'<span class="co3">
  output</span><span class="sy2">: </span> true<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns true if path is absolute
-<span class="co3">
  input</span><span class="sy2">: </span>  'C:\\test'<span class="co3">
  output</span><span class="sy2">: </span> true<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns true if path is absolute
-<span class="co3">
  input</span><span class="sy2">: </span>  'd:/test'<span class="co3">
  output</span><span class="sy2">: </span> true<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns true if path is absolute
-<span class="co3">
  input</span><span class="sy2">: </span>  'test'<span class="co3">
  output</span><span class="sy2">: </span> false<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns false if path is relative
-<span class="co3">
  input</span><span class="sy2">: </span>  '../test'<span class="co3">
  output</span><span class="sy2">: </span> false<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns false if path is relative
-<span class="co3">
  input</span><span class="sy2">: </span>  '..\\test'<span class="co3">
  output</span><span class="sy2">: </span> false<span class="co3">
  comment</span><span class="sy2">: </span>isPathAbsolute<span class="br0">&#40;</span><span class="br0">&#41;</span> returns false if path is relative</pre>
</div>

<div class="code php">
<pre class="php">// En testTest.php
<span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw1">include</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../bootstrap/unit.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">require_once</span><span class="br0">&#40;</span><span class="re0">$sf_symfony_lib_dir</span><span class="sy0">.</span><span class="st_h">'/util/sfToolkit.class.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">require_once</span><span class="br0">&#40;</span><span class="re0">$sf_symfony_lib_dir</span><span class="sy0">.</span><span class="st_h">'/yaml/sfYaml.class.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$testCases</span> <span class="sy0">=</span> sfYaml<span class="sy0">::</span><span class="me2">load</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/fixtures.yml'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="kw3">count</span><span class="br0">&#40;</span><span class="re0">$testCases</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// isPathAbsolute()</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">diag</span><span class="br0">&#40;</span><span class="st_h">'isPathAbsolute()'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">foreach</span> <span class="br0">&#40;</span><span class="re0">$testCases</span> <span class="kw1">as</span> <span class="re0">$case</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span>sfToolkit<span class="sy0">::</span><span class="me2">isPathAbsolute</span><span class="br0">&#40;</span><span class="re0">$case</span><span class="br0">&#91;</span><span class="st_h">'input'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$case</span><span class="br0">&#91;</span><span class="st_h">'output'</span><span class="br0">&#93;</span><span class="sy0">,</span><span class="re0">$case</span><span class="br0">&#91;</span><span class="st_h">'comment'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<h3 id="pruebas_unitarias_de_las_clases_de_propel">15.2.6. Pruebas unitarias de las clases de Propel</h3>

<p>Crear pruebas unitarias para las clases de Propel es un poco más complicado, ya que los objetos Propel generados dependen de muchísimas clases, por lo que es necesario utilizar la carga automática de clases. Además, para probar Propel debes proporcionar una conexión válida con la base de datos y debes incluir algunos datos de prueba en la base de datos.</p>

<p>Afortunadamente, el proceso no es tan complicado como parece porque Symfony ya incluye todo lo que necesitas:</p>

<ul>
<li>Para obtener la carga automática de clases, inicializa un objeto de la configuración</li>
<li>Para obtener la conexión con la base de datos, inicializa la clase <code>sfDatabaseManager</code></li>
<li>Para cargar algunos datos de prueba, utiliza la clase <code>sfPropelData</code></li>
</ul>

<p>El listado 15-9 muestra un típico archivo de pruebas de Propel.</p>

<p><strong>Listado 15-9 - Probando las clases de Propel</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
&nbsp;
<span class="kw1">include</span><span class="br0">&#40;</span><span class="kw3">dirname</span><span class="br0">&#40;</span><span class="kw4">__FILE__</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/../bootstrap/unit.php'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">new</span> sfDatabaseManager<span class="br0">&#40;</span>ProjectConfiguration<span class="sy0">::</span><span class="me2">getApplicationConfiguration</span><span class="br0">&#40;</span><span class="st_h">'frontend'</span><span class="sy0">,</span> <span class="st_h">'test'</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$loader</span> <span class="sy0">=</span> <span class="kw2">new</span> sfPropelData<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$loader</span><span class="sy0">-&gt;</span><span class="me1">loadData</span><span class="br0">&#40;</span>sfConfig<span class="sy0">::</span><span class="me2">get</span><span class="br0">&#40;</span><span class="st_h">'sf_data_dir'</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="st_h">'/fixtures'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="nu0">1</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// begin testing your model class</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">diag</span><span class="br0">&#40;</span><span class="st_h">'-&gt;retrieveByUsername()'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$user</span> <span class="sy0">=</span> UserPeer<span class="sy0">::</span><span class="me2">retrieveByUsername</span><span class="br0">&#40;</span><span class="st_h">'fabien'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">is</span><span class="br0">&#40;</span><span class="re0">$user</span><span class="sy0">-&gt;</span><span class="me1">getLastName</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'Potencier'</span><span class="sy0">,</span> <span class="st_h">'-&gt;retrieveByUsername() returns the User for the given username'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_15/automatizacion_de_pruebas.html">
                        <strong>&larr; Anterior</strong>
                        <small>15.1. Automatización de pruebas</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_15/pruebas_funcionales.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>15.3. Pruebas funcionales</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Symfony</a>
            </li>
                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Explorando el interior de Symfony</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Ejecutar aplicaciones Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Introducción a la creación de páginas</a>
            </li>
                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Configurar Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El Controlador</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> La Vista</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> El modelo</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Enlaces y sistema de enrutamiento</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Formularios</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Integración con Ajax</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Uso de la cache</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Internacionalización y localización</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Generador de la parte de administración</a>
            </li>
                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_15.html">
                    <span>Capítulo 15.</span> Pruebas unitarias y funcionales
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/automatizacion_de_pruebas.html">
                    <span>15.1.</span> Automatización de pruebas
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_15/pruebas_unitarias.html">
                    <span>15.2.</span> Pruebas unitarias
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/pruebas_funcionales.html">
                    <span>15.3.</span> Pruebas funcionales
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/recomendaciones_sobre_el_nombre_de_las_pruebas.html">
                    <span>15.4.</span> Recomendaciones sobre el nombre de las pruebas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/otras_utilidades_para_pruebas.html">
                    <span>15.5.</span> Otras utilidades para pruebas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/resumen.html">
                    <span>15.6.</span> Resumen
                </a>
            </li>
                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Herramientas para la administración de aplicaciones</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Personalizar Symfony</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Rendimiento</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Configuración avanzada</a>
            </li>
                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
