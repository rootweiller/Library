<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>15.3. Métodos de un Middleware (El libro de Django 1.0)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_15/instalacion_de_middleware.html" />
                    <link rel="next" href="../capitulo_15/middleware_incluido.html" />
                <link rel="start" href="/libro/django_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="15.3. Métodos de un Middleware (El libro de Django 1.0)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page django_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/" itemprop="url">
                    <span itemprop="title">El libro de Django 1.0</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/capitulo_15.html" itemprop="url">
                    <span itemprop="title">Capítulo 15. Middleware</span>
                </a>
            </li>
        
            <li class="active">
                <span>15.3. Métodos de un Middleware</span>
            </li>
        </ol>
    </div>

    <h1 id="metodos_de_un_middleware" class="title">
        <span>15.3.</span> Métodos de un Middleware
    </h1>

    

<p>Ahora que sabes qué es un middleware y cómo instalarlo, echemos un vistazo a
todos los métodos disponibles que las clases middleware pueden definir.</p>

<h3 id="inicializar_initself">15.3.1. Inicializar: <strong>init</strong>(self)</h3>

<p>Utiliza <code>__init__()</code> para realizar una configuración a nivel de sistema de una
determinada clase middleware.</p>

<p>Por razones de rendimiento, cada clase middleware activada es instanciada sólo
<em>una vez</em> por proceso servidor. Esto significa que <code>__init__()</code> es llamada
sólo una vez — al iniciar el servidor — no para peticiones individuales.</p>

<p>Una razón común para implementar un método <code>__init__()</code> es para verificar si
el middleware es en realidad necesario. Si <code>__init__()</code> emite
<code>django.core.exceptions.MiddlewareNotUsed</code>, entonces Django elimina el
middleware de la pila de middleware. Esta característica se puede usar para
verificar si existe una pieza de software que la clase middleware requiere, o
verificar si el servidor esta ejecutándose en modo <em>debug</em>, o cualquier otra
situación similar.</p>

<p>Si una clase middleware define un método <code>__init__()</code>, éste no debe tomar
argumentos más allá del estándar <code>self</code>.</p>

<h3 id="pre_procesador_de_peticion_process_requestself_request">15.3.2. Pre-procesador de petición: process_request(self, request)</h3>

<p>Éste método es llamado tan pronto como la petición ha sido recibida — antes de
que Django haya analizado sintácticamente la URL para determinar cuál vista
ejecutar. Se le pasa el objeto <code>HttpRequest</code>, el cual puedes modificar a tu
voluntad.</p>

<p><code>process_request()</code> debe retornar ya sea <code>None</code> o un objeto <code>HttpResponse</code>.</p>

<ul>
<li>Si devuelve <code>None</code>, Django continuará procesando esta petición,
ejecutando cualquier otro middleware y la vista apropiada.</li>
<li>Si devuelve un objeto <code>HttpResponse</code>, Django no se encargará de llamar a
<em>cualquier</em> otro middleware (de ningún tipo) o a la vista apropiada.
Django inmediatamente devolverá ése objeto <code>HttpResponse</code>.</li>
</ul>

<h3 id="pre_procesador_de_vista_process_viewself_request_view_args_kwargs">15.3.3. Pre-procesador de vista: process_view(self, request, view, args, kwargs)</h3>

<p>Éste método es llamado después de la llamada al pre-procesador de petición y
después de que Django haya determinado qué vista ejecutar, pero antes de que 
ésa vista sea realmente ejecutada.</p>

<p>La siguiente tabla muestra los argumentos que se pasan a esta vista:</p>

<div class="table" id="table_15_1">

    <table>
<thead>
<tr>
  <th>Argumento</th>
  <th>Explicación</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>request</code></td>
  <td>El objeto <code>HttpRequest</code></td>
</tr>
<tr>
  <td><code>view</code></td>
  <td>La función Python que Django llamará para manejar esta petición. Este es en realidad el objeto función en sí, no el nombre de la función como string</td>
</tr>
<tr>
  <td><code>args</code></td>
  <td>La lista de argumentos posicionales que serán pasados a la vista, no incluye el argumento <code>request</code> (el cual es siempre el primer argumento de una vista)</td>
</tr>
<tr>
  <td><code>kwargs</code></td>
  <td>El diccionario de palabras clave argumento que será pasado a la vista</td>
</tr>
</tbody>
</table>
</div>


<p>Así como el método <code>process_request()</code>, <code>process_view()</code> debe retornar ya sea
<code>None</code> o un objeto <code>HttpResponse</code>.</p>

<ul>
<li>Si devuelve <code>None</code>, Django continuará procesando esta petición,
ejecutando cualquier otro middleware y la vista apropiada.</li>
<li>Si devuelve un objeto <code>HttpResponse</code>, Django no se encargará de llamar a
<em>cualquier</em> otro middleware (de ningún tipo) o a la vista apropiada.
Django inmediatamente devolverá ése objeto <code>HttpResponse</code>.</li>
</ul>

<h3 id="pos_procesador_de_respuesta_process_responseself_request_response">15.3.4. Pos-procesador de respuesta: process_response(self, request, response)</h3>

<p>Éste método es llamado después de que la función de vista es llamada y la
respuesta generada. Aquí, el procesador puede modificar el contenido de una
respuesta; un caso de uso obvio es la compresión de contenido, como por ejemplo
la compresión con gzip del HTML de la respuesta.</p>

<p>Los parámetros deben ser bastante auto-explicativos: <code>request</code> es el objeto
petición, y <code>response</code> es el objeto respuesta retornados por la vista.</p>

<p>A diferencia de los pre-procesadores de petición y vista, los cuales pueden
retornar <code>None</code>, <code>process_response()</code> <em>debe</em> retornar un objeto
<code>HttpResponse</code>. Esa respuesta puede ser la respuesta original pasada a la
función (posiblemente modificada) o una totalmente nueva.</p>

<h3 id="pos_procesador_de_excepcion_process_exceptionself_request_exception">15.3.5. Pos-procesador de excepción: process_exception(self, request, exception)</h3>

<p>Éste método es llamado sólo si ocurre algún error y la vista emite una 
excepción sin capturar. Puedes usar este método para enviar notificaciones de 
error, volcar información <em>postmórtem</em> a un registro, o incluso tratar de 
recuperarse del error automáticamente.</p>

<p>Los parámetros para esta función son el mismo objeto <code>request</code> con el que
hemos venido tratando hasta aquí, y <code>exception</code>, el cual es el objeto
<code>Exception</code> real emitido por la función de vista.</p>

<p><code>process_exception()</code> debe retornar ya sea <code>None</code> o un objeto <code>HttpResponse</code>.</p>

<ul>
<li>Si devuelve <code>None</code>, Django continuará procesando esta petición con el
manejador de excepción incorporado en el framework.</li>
<li>Si devuelve un objeto <code>HttpResponse</code>, Django usará esa respuesta en vez
del manejador de excepción incorporado en el framework.</li>
</ul>

<div class="admonition note"><p><strong class="title">Nota</strong> Django trae incorporado una serie de clases middleware (que se discuten en
la sección siguiente) que hacen de buenos ejemplos. La lectura de su código
debería darte una buena idea de la potencia del middleware.</p>

<p>También puedes encontrar una serie de ejemplos contribuidos por la comunidad
en <a href="http://code.djangoproject.com/wiki/ContributedMiddleware">el wiki de Django</a>.</p></div>



    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_15/instalacion_de_middleware.html">
                        <strong>&larr; Anterior</strong>
                        <small>15.2. Instalación de Middleware</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_15/middleware_incluido.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>15.4. Middleware incluido</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Empezando</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Los principios de las páginas Web dinámicas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> El sistema de plantillas de Django</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Interactuar con una base de datos: Modelos</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El sitio de Administración Django</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Procesamiento de formularios</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Vistas avanzadas y URLconfs</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Vistas genéricas</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Extender el sistema de plantillas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Generación de contenido no HTML</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Sesiones, usuario e inscripciones</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Cache</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Otros sub-frameworks contribuidos</a>
            </li>
                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_15.html">
                    <span>Capítulo 15.</span> Middleware
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/que_es_middleware.html">
                    <span>15.1.</span> Qué es middleware
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/instalacion_de_middleware.html">
                    <span>15.2.</span> Instalación de Middleware
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_15/metodos_de_un_middleware.html">
                    <span>15.3.</span> Métodos de un Middleware
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/middleware_incluido.html">
                    <span>15.4.</span> Middleware incluido
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_15/que_sigue.html">
                    <span>15.5.</span> ¿Qué sigue?
                </a>
            </li>
                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Integración con Base de datos y Aplicaciones existentes</a>
            </li>
                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Extender la Interfaz de Administración de Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>20.</span> <a href="../capitulo_20.html"> Puesta en marcha de Django en un servidor</a>
            </li>
                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
