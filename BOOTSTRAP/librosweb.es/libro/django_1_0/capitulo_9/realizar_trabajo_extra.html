<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>9.6. Realizar trabajo extra (El libro de Django 1.0)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_9/filtrado_complejo_con_funciones_adaptadoras.html" />
                    <link rel="next" href="../capitulo_9/que_sigue.html" />
                <link rel="start" href="/libro/django_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="9.6. Realizar trabajo extra (El libro de Django 1.0)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page django_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
            <div class="module module-ad module-ad-responsive module-ad-top">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/" itemprop="url">
                    <span itemprop="title">El libro de Django 1.0</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/capitulo_9.html" itemprop="url">
                    <span itemprop="title">Capítulo 9. Vistas genéricas</span>
                </a>
            </li>
        
            <li class="active">
                <span>9.6. Realizar trabajo extra</span>
            </li>
        </ol>
    </div>

    <h1 id="realizar_trabajo_extra" class="title">
        <span>9.6.</span> Realizar trabajo extra
    </h1>

    

<p>El último patrón común que veremos involucra realizar algún trabajo extra antes
o después de llamar a la vista genérica.</p>

<p>Imagina que tenemos un campo <code>last_accessed</code> en nuestro objeto <code>Author</code> que
estuvimos usando para tener un registro de la última vez que alguien vio ese
author. La vista genérica <code>object_detail</code>, por supuesto, no sabría nada sobre
este campo, pero una vez más fácilmente podríamos escribir una vista
personalizada para mantener ese campo actualizado.</p>

<p>Primero, necesitamos agregar una pequeña parte de detalle sobre el author en la
URLconf para que apunte a una vista personalizada:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> mysite.<span class="me1">books</span>.<span class="me1">views</span> <span class="kw1">import</span> author_detail
&nbsp;
urlpatterns <span class="sy0">=</span> patterns<span class="br0">&#40;</span><span class="st0">''</span><span class="sy0">,</span>
    <span class="co1">#...</span>
    <span class="br0">&#40;</span>r<span class="st0">'^authors/(?P&lt;author_id&gt;<span class="es0">\d</span>+)/$'</span><span class="sy0">,</span> author_detail<span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span></pre>
</div>

<p>Luego escribiremos nuestra función wrapper:</p>

<div class="code python">
<pre class="python"><span class="kw1">import</span> <span class="kw3">datetime</span>
<span class="kw1">from</span> mysite.<span class="me1">books</span>.<span class="me1">models</span> <span class="kw1">import</span> Author
<span class="kw1">from</span> django.<span class="me1">views</span>.<span class="me1">generic</span> <span class="kw1">import</span> list_detail
<span class="kw1">from</span> django.<span class="me1">shortcuts</span> <span class="kw1">import</span> get_object_or_404
&nbsp;
<span class="kw1">def</span> author_detail<span class="br0">&#40;</span>request<span class="sy0">,</span> author_id<span class="br0">&#41;</span>:
    <span class="co1"># Look up the Author (and raise a 404 if she's not found)</span>
    author <span class="sy0">=</span> get_object_or_404<span class="br0">&#40;</span>Author<span class="sy0">,</span> pk<span class="sy0">=</span>author_id<span class="br0">&#41;</span>
&nbsp;
    <span class="co1"># Record the last accessed date</span>
    author.<span class="me1">last_accessed</span> <span class="sy0">=</span> <span class="kw3">datetime</span>.<span class="kw3">datetime</span>.<span class="me1">now</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    author.<span class="me1">save</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
    <span class="co1"># Show the detail page</span>
    <span class="kw1">return</span> list_detail.<span class="me1">object_detail</span><span class="br0">&#40;</span>
        request<span class="sy0">,</span>
        queryset <span class="sy0">=</span> Author.<span class="me1">objects</span>.<span class="kw2">all</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
        object_id <span class="sy0">=</span> author_id<span class="sy0">,</span>
    <span class="br0">&#41;</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> Este código en realidad no funcionará a menos que agregues un campo
<code>last_accessed</code> a tu modelo <code>Author</code> y agregues una plantilla
<code>books/author_detail.html</code>.</p></div>

<p>Podemos usar un método similar para alterar la respuesta devuelta por la vista
genérica. Si quisiéramos proporcionar una versión en texto plano que se pueda
descargar desde la lista de autores, podríamos usar una vista como esta:</p>

<div class="code python">
<pre class="python"><span class="kw1">def</span> author_list_plaintext<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    response <span class="sy0">=</span> list_detail.<span class="me1">object_list</span><span class="br0">&#40;</span>
        request<span class="sy0">,</span>
        queryset <span class="sy0">=</span> Author.<span class="me1">objects</span>.<span class="kw2">all</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
        mimetype <span class="sy0">=</span> <span class="st0">&quot;text/plain&quot;</span><span class="sy0">,</span>
        template_name <span class="sy0">=</span> <span class="st0">&quot;books/author_list.txt&quot;</span>
    <span class="br0">&#41;</span>
    response<span class="br0">&#91;</span><span class="st0">&quot;Content-Disposition&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;attachment; filename=authors.txt&quot;</span>
    <span class="kw1">return</span> response</pre>
</div>

<p>Esto funciona porque la vista genérica devuelve simplemente objetos
<code>HttpResponse</code> que pueden ser tratados como diccionarios para establecer las
cabeceras HTTP. Este arreglo de <code>Content-Disposition</code>, por otro lado,
instruye al navegador a descargar y guardar la página en vez de mostrarla en
pantalla.</p>



    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_9/filtrado_complejo_con_funciones_adaptadoras.html">
                        <strong>&larr; Anterior</strong>
                        <small>9.5. Filtrado complejo con funciones adaptadoras</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_9/que_sigue.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>9.7. ¿Qué sigue?</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Empezando</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Los principios de las páginas Web dinámicas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> El sistema de plantillas de Django</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Interactuar con una base de datos: Modelos</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El sitio de Administración Django</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Procesamiento de formularios</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Vistas avanzadas y URLconfs</a>
            </li>
                                                                                            <li class="level-1 ">
                <a href="../capitulo_9.html">
                    <span>Capítulo 9.</span> Vistas genéricas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/usar_vistas_genericas.html">
                    <span>9.1.</span> Usar vistas genéricas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/vistas_genericas_de_objetos.html">
                    <span>9.2.</span> Vistas genéricas de objetos
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/extender_las_vistas_genericas.html">
                    <span>9.3.</span> Extender las vistas genéricas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/mostrar_subconjuntos_de_objetos.html">
                    <span>9.4.</span> Mostrar subconjuntos de objetos
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/filtrado_complejo_con_funciones_adaptadoras.html">
                    <span>9.5.</span> Filtrado complejo con funciones adaptadoras
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_9/realizar_trabajo_extra.html">
                    <span>9.6.</span> Realizar trabajo extra
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/que_sigue.html">
                    <span>9.7.</span> ¿Qué sigue?
                </a>
            </li>
                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Extender el sistema de plantillas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Generación de contenido no HTML</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Sesiones, usuario e inscripciones</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Cache</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Otros sub-frameworks contribuidos</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Middleware</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Integración con Base de datos y Aplicaciones existentes</a>
            </li>
                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Extender la Interfaz de Administración de Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>20.</span> <a href="../capitulo_20.html"> Puesta en marcha de Django en un servidor</a>
            </li>
                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
