<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>11.6. Los sitemaps de XML (El libro de Django 1.0)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_11/el_framework_de_feeds_de_sindicacion.html" />
                    <link rel="next" href="../capitulo_11/que_sigue.html" />
                <link rel="start" href="/libro/django_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="11.6. Los sitemaps de XML (El libro de Django 1.0)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page django_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/" itemprop="url">
                    <span itemprop="title">El libro de Django 1.0</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/capitulo_11.html" itemprop="url">
                    <span itemprop="title">Capítulo 11. Generación de contenido no HTML</span>
                </a>
            </li>
        
            <li class="active">
                <span>11.6. Los sitemaps de XML</span>
            </li>
        </ol>
    </div>

    <h1 id="los_sitemaps_de_xml" class="title">
        <span>11.6.</span> Los sitemaps de XML
    </h1>

    

<p>Un <em>sitemap</em> es un fichero XML en tu sitio web que le indica a los indexadores
de los motores de búsqueda cuan frecuentemente cambian tus páginas así como la
"importancia" relativa de ciertas páginas en relación con otras (siempre
hablando de páginas de tu sitio). Esta información ayuda a los motores de
búsqueda a indexar tu sitio.</p>

<p>Por ejemplo, esta es una parte del sitemap del sitio web de Django
que se encuentra en <code>http://djangoproject.com/sitemap.xml</code>:</p>

<div class="code xml">
<pre class="xml"><span class="sc3"><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">&quot;1.0&quot;</span> <span class="re0">encoding</span>=<span class="st0">&quot;UTF-8&quot;</span><span class="re2">?&gt;</span></span>
<span class="sc3"><span class="re1">&lt;urlset</span> <span class="re0">xmlns</span>=<span class="st0">&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;</span><span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;url<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;loc<span class="re2">&gt;</span></span></span>http://www.djangoproject.com/documentation/<span class="sc3"><span class="re1">&lt;/loc<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;changefreq<span class="re2">&gt;</span></span></span>weekly<span class="sc3"><span class="re1">&lt;/changefreq<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;priority<span class="re2">&gt;</span></span></span>0.5<span class="sc3"><span class="re1">&lt;/priority<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/url<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;url<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;loc<span class="re2">&gt;</span></span></span>http://www.djangoproject.com/documentation/0_90/<span class="sc3"><span class="re1">&lt;/loc<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;changefreq<span class="re2">&gt;</span></span></span>never<span class="sc3"><span class="re1">&lt;/changefreq<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;priority<span class="re2">&gt;</span></span></span>0.1<span class="sc3"><span class="re1">&lt;/priority<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/url<span class="re2">&gt;</span></span></span>
  ...
<span class="sc3"><span class="re1">&lt;/urlset<span class="re2">&gt;</span></span></span></pre>
</div>

<p>Para más información sobre sitemaps, vea http://www.sitemaps.org/.</p>

<p>El framework sitemap de Django automatiza la creación de este fichero XML si
lo indicas expresamente en el código Python. Para crear un sitemap, debes
simplemente escribir una clase <code>Sitemap</code> y hacer referencia a la misma en tu
URLconf.</p>

<h3 id="instalacion">11.6.1. Instalación</h3>

<p>Para instalar la aplicación sitemap, sigue los siguientes pasos:</p>

<ol>
<li>Agrega <code>'django.contrib.sitemaps'</code> a tu variable de configuración
<code>INSTALLED_APPS</code>.</li>
<li>Asegúrate de que
<code>'django.template.loaders.app_directories.load_template_source'</code> está en
tu variable de configuración <code>TEMPLATE_LOADERS</code>. Por omisión se encuentra
activado, por lo que los cambios son necesarios solamente si modificaste
dicha variable de configuración.</li>
<li>Asegúrate de que tienes instalado el framework sites (ver Capítulo 14).</li>
</ol>

<div class="admonition note"><p><strong class="title">Nota</strong> La aplicación sitemap no instala tablas en la base de datos. La única razón
de que esté en <code>INSTALLED_APPS</code> es que el cargador de plantillas
<code>load_template_source</code> pueda encontrar las plantillas incluídas.</p></div>

<h3 id="inicializacion_2">11.6.2. Inicialización</h3>

<p>Para activar la generación del sitemap en tu sitio Django, agrega la siguiente
línea a tu URLconf:</p>

<div class="code python">
<pre class="python"><span class="br0">&#40;</span>r<span class="st0">'^sitemap.xml$'</span><span class="sy0">,</span> <span class="st0">'django.contrib.sitemaps.views.sitemap'</span><span class="sy0">,</span> <span class="br0">&#123;</span><span class="st0">'sitemaps'</span>: sitemaps<span class="br0">&#125;</span><span class="br0">&#41;</span></pre>
</div>

<p>Esta línea le dice a Django que construya un sitemap cuando un cliente accede
a <code>/sitemap.xml</code>.</p>

<p>El nombre del fichero sitemap no es importante, pero la ubicación sí lo es. Los
motores de búsqueda solamente indexan los enlaces en tu sitemap para el nivel 
de URL actual y anterior. Por ejemplo, si <code>sitemap.xml</code> reside en tu directorio
principal, el mismo puede hacer referencia a cualquier URL en tu sitio. Pero si
tu sitemap reside en <code>/content/sitemap.xml</code>, solamente podrá hacer referencia
a URLs que comiencen con <code>/content/</code>.</p>

<p>La vista sitemap toma un argumento extra: <code>{'sitemaps': sitemaps}</code>.
<code>sitemaps</code> debe ser un diccionario que mapee una etiqueta corta de sección (p.
ej. <code>blog</code> o <code>news</code>) a tu clase <code>Sitemap</code> (p.e., <code>BlogSitemap</code> o
<code>NewsSitemap</code>).  También mapea hacia una <em>instancia</em> de una clase <code>Sitemap</code>
(p. ej. <code>BlogSitemap(some_var)</code>).</p>

<h3 id="clases_sitemap">11.6.3. Clases Sitemap</h3>

<p>Una clase <code>Sitemap</code> es simplemente una clase Python que representa una
"sección" de entradas en tu sitemap. Por ejemplo, una clase <code>Sitemap</code> puede
representar todas las entradas de tu weblog, y otra puede representar todos los
eventos de tu calendario.</p>

<p>En el caso más simple, todas estas secciones se unen en un único <code>sitemap.xml</code>,
pero también es posible usar el framework para generar un índice sitemap que
haga a referencia ficheros sitemap individuales, uno por sección (
describiéndolo sintéticamente).</p>

<p>Las clases <code>Sitemap</code> debe ser una subclase de
<code>django.contrib.sitemaps.Sitemap</code>. Estas pueden residir en cualquier parte del 
árbol de código.</p>

<p>Por ejemplo, asumamos que posees un sistema de blog, con un modelo <code>Entry</code>, y
quieres que tu sitemap incluya todos los enlaces a las entradas individuales
de tu Blog. Tu clase <code>Sitemap</code> debería verse así:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sitemaps</span> <span class="kw1">import</span> Sitemap
<span class="kw1">from</span> mysite.<span class="me1">blog</span>.<span class="me1">models</span> <span class="kw1">import</span> Entry
&nbsp;
<span class="kw1">class</span> BlogSitemap<span class="br0">&#40;</span>Sitemap<span class="br0">&#41;</span>:
    changefreq <span class="sy0">=</span> <span class="st0">&quot;never&quot;</span>
    priority <span class="sy0">=</span> <span class="nu0">0.5</span>
&nbsp;
    <span class="kw1">def</span> items<span class="br0">&#40;</span><span class="kw2">self</span><span class="br0">&#41;</span>:
        <span class="kw1">return</span> Entry.<span class="me1">objects</span>.<span class="kw2">filter</span><span class="br0">&#40;</span>is_draft<span class="sy0">=</span><span class="kw2">False</span><span class="br0">&#41;</span>
&nbsp;
    <span class="kw1">def</span> lastmod<span class="br0">&#40;</span><span class="kw2">self</span><span class="sy0">,</span> obj<span class="br0">&#41;</span>:
        <span class="kw1">return</span> obj.<span class="me1">pub_date</span></pre>
</div>

<p>Declarar un <code>Sitemap</code> debería verse muy similar a declarar un <code>Feed</code>; esto
es justamente un objetivo del diseño.</p>

<p>En manera similar a las clases <code>Feed</code>, los miembros de <code>Sitemap</code> pueden ser
métodos o atributos. Ver los pasos en la sección <em>"Un feed más complejo"</em> para
más información sobre cómo funciona esto.</p>

<p>Una clase <code>Sitemap</code> puede definir los siguientes métodos/atributos:</p>

<ul>
<li><code>items</code> (<strong>requerido</strong>): Provee una lista de objetos. Al framework no le
importa que <em>tipo</em> de objeto es; todo lo que importa es que los objetos
sean pasados a los métodos <code>location()</code>, <code>lastmod()</code>,
<code>changefreq()</code>, y <code>priority()</code>.</li>
<li><code>location</code> (opcional): Provee la URL absoluta para el objeto dado. Aquí
"URL absoluta" significa una URL que no incluye el protocolo o el dominio.
Estos son algunos ejemplos:

<ul>
<li>Bien: <code>'/foo/bar/'</code></li>
<li>Mal: <code>'example.com/foo/bar/'</code></li>
<li>Mal: <code>'http://example.com/foo/bar/'</code>
Si <code>location</code> no es provisto, el framework llamará al método
<code>get_absolute_url()</code> en cada uno de los objetos retornados por <code>items()</code>.</li>
</ul></li>
<li><code>lastmod</code> (opcional): La fecha de "última modificación" del objeto, como
un objeto <code>datetime</code> de Python.</li>
<li><code>changefreq</code> (opcional): Cuán a menudo el objeto cambia. Los valores
posibles (según indican las especificaciones de Sitemaps) son:

<ul>
<li><code>'always'</code></li>
<li><code>'hourly'</code></li>
<li><code>'daily'</code></li>
<li><code>'weekly'</code></li>
<li><code>'monthly'</code></li>
<li><code>'yearly'</code></li>
<li><code>'never'</code></li>
</ul></li>
<li><code>priority</code> (opcional): Prioridad sugerida de indexado entre <code>0.0</code>
y <code>1.0</code>. La prioridad por omisión de una página es <code>0.5</code>; ver la
documentación de http://sitemaps.org para más información de cómo
funciona <code>priority</code>.</li>
</ul>

<h3 id="accesos_directos">11.6.4. Accesos directos</h3>

<p>El framework sitemap provee un conjunto de clases para los casos más comunes.
Describiremos estos casos en las secciones a continuación.</p>

<h4 id="flatpagesitemap">11.6.4.1. FlatPageSitemap</h4>

<p>La clase <code>django.contrib.sitemaps.FlatPageSitemap</code> apunta a todas las páginas
planas definidas para el sitio actual y crea una entrada en el sitemap. Estas
entradas incluyen solamente el atributo <code>location</code> — no <code>lastmod</code>,
<code>changefreq</code>, o <code>priority</code>.</p>

<p>Para más información sobre Páginas Planas ver el Capítulo 14.</p>

<h4 id="sitemap_generico">11.6.4.2. Sitemap Genérico</h4>

<p>La clase <code>GenericSitemap</code> trabaja con cualquier vista genérica (ver Capítulo 9)
que hayas definido con anterioridad.</p>

<p>Para usarla, crea una instancia, pasándola en el mismo <code>info_dict</code> que se pasa
a la vista genérica. El único requerimiento es que el diccionario tenga una
entrada <code>queryset</code>. También debe poseer una entrada <code>date_field</code> que
especifica un campo fecha para los objetos obtenidos del <code>queryset</code>. Esto será
usado por el atributo <code>lastmod</code> en el sitemap generado. También puedes pasar
los argumentos palabra clave (<em>keyword</em>) <code>priority</code> y <code>changefreq</code> al
constructor <code>GenericSitemap</code> para especificar dichos atributos para todas las
URLs.</p>

<p>Este es un ejemplo de URLconf usando tanto, <code>FlatPageSitemap</code> como
<code>GenericSiteMap</code> (con el anterior objeto hipotético <code>Entry</code>):</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">conf</span>.<span class="me1">urls</span>.<span class="me1">defaults</span> <span class="kw1">import</span> *
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sitemaps</span> <span class="kw1">import</span> FlatPageSitemap<span class="sy0">,</span> GenericSitemap
<span class="kw1">from</span> mysite.<span class="me1">blog</span>.<span class="me1">models</span> <span class="kw1">import</span> Entry
&nbsp;
info_dict <span class="sy0">=</span> <span class="br0">&#123;</span>
    <span class="st0">'queryset'</span>: Entry.<span class="me1">objects</span>.<span class="kw2">all</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st0">'date_field'</span>: <span class="st0">'pub_date'</span><span class="sy0">,</span>
<span class="br0">&#125;</span>
&nbsp;
sitemaps <span class="sy0">=</span> <span class="br0">&#123;</span>
    <span class="st0">'flatpages'</span>: FlatPageSitemap<span class="sy0">,</span>
    <span class="st0">'blog'</span>: GenericSitemap<span class="br0">&#40;</span>info_dict<span class="sy0">,</span> priority<span class="sy0">=</span><span class="nu0">0.6</span><span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#125;</span>
&nbsp;
urlpatterns <span class="sy0">=</span> patterns<span class="br0">&#40;</span><span class="st0">''</span><span class="sy0">,</span>
    <span class="co1"># some generic view using info_dict</span>
    <span class="co1"># ...</span>
&nbsp;
    <span class="co1"># the sitemap</span>
    <span class="br0">&#40;</span>r<span class="st0">'^sitemap.xml$'</span><span class="sy0">,</span>
     <span class="st0">'django.contrib.sitemaps.views.sitemap'</span><span class="sy0">,</span>
     <span class="br0">&#123;</span><span class="st0">'sitemaps'</span>: sitemaps<span class="br0">&#125;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span></pre>
</div>

<h3 id="crear_un_indice_sitemap">11.6.5.  Crear un índice Sitemap</h3>

<p>El framework sitemap también tiene la habilidad de crear índices sitemap que
hagan referencia a ficheros sitemap individuales, uno por cada sección definida
en tu diccionario <code>sitemaps</code>. Las única diferencias de uso son:</p>

<ul>
<li>Usas dos vistas en tu URLconf:
<code>django.contrib.sitemaps.views.index</code> y
<code>django.contrib.sitemaps.views.sitemap</code>.</li>
<li>La vista <code>django.contrib.sitemaps.views.sitemap</code> debe tomar un parámetro
que corresponde a una palabra clave, llamado <code>section</code>.</li>
</ul>

<p>Así deberían verse las líneas relevantes en tu URLconf para el ejemplo anterior:</p>

<div class="code python">
<pre class="python"><span class="br0">&#40;</span>r<span class="st0">'^sitemap.xml$'</span><span class="sy0">,</span>
 <span class="st0">'django.contrib.sitemaps.views.index'</span><span class="sy0">,</span>
 <span class="br0">&#123;</span><span class="st0">'sitemaps'</span>: sitemaps<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">,</span>
&nbsp;
<span class="br0">&#40;</span>r<span class="st0">'^sitemap-(?P&lt;section&gt;.+).xml$'</span><span class="sy0">,</span>
 <span class="st0">'django.contrib.sitemaps.views.sitemap'</span><span class="sy0">,</span>
 <span class="br0">&#123;</span><span class="st0">'sitemaps'</span>: sitemaps<span class="br0">&#125;</span><span class="br0">&#41;</span></pre>
</div>

<p>Esto genera automáticamente un fichero <code>sitemap.xml</code> que hace referencia a
ambos ficheros <code>sitemap-flatpages.xml</code> y <code>sitemap-blog.xml</code>. La clase
<code>Sitemap</code> y el diccionario <code>sitemaps</code> no cambian en absoluto.</p>

<h3 id="hacer_ping_a_google">11.6.6. Hacer ping a Google</h3>

<p>Puedes desear hacer un "ping" a Google cuando tu sitemap cambia, para hacerle
saber que debe reindexar tu sitio. El framework provee una función para hacer
justamente eso: <code>django.contrib.sitemaps.ping_google()</code>.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Hasta el momento en que este libro se escribió, únicamente Google responde a
los pings de sitemap. Pero es muy probable que pronto Yahoo y/o MSN también
admitan estos pings.</p>

<p>Cuando eso suceda, cambiaremos el nombre de <code>ping_google()</code> a algo como
<code>ping_search_engines()</code>, así que asegúrate de verificar la ultima
documentación sobre sitemap.</p></div>

<p><code>ping_google()</code> toma un argumento opcional, <code>sitemap_url</code>, que debe ser la
URL absoluta de tu sitemap (por ej., <code>'/sitemap.xml'</code>). Si este argumento no es
provisto, <code>ping_google()</code> tratará de generar un sitemap realizando una
búsqueda reversa en tu URLconf.</p>

<p><code>ping_google()</code> lanza la excepción
<code>django.contrib.sitemaps.SitemapNotFound</code> si no puede determinar la URL de tu
sitemap.</p>

<p>Una forma útil de llamar a <code>ping_google()</code> es desde el método <code>save()</code>:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sitemaps</span> <span class="kw1">import</span> ping_google
&nbsp;
<span class="kw1">class</span> Entry<span class="br0">&#40;</span>models.<span class="me1">Model</span><span class="br0">&#41;</span>:
    <span class="co1"># ...</span>
    <span class="kw1">def</span> save<span class="br0">&#40;</span><span class="kw2">self</span><span class="br0">&#41;</span>:
        <span class="kw2">super</span><span class="br0">&#40;</span>Entry<span class="sy0">,</span> <span class="kw2">self</span><span class="br0">&#41;</span>.<span class="me1">save</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
        <span class="kw1">try</span>:
            ping_google<span class="br0">&#40;</span><span class="br0">&#41;</span>
        <span class="kw1">except</span> <span class="kw2">Exception</span>:
            <span class="co1"># Bare 'except' because we could get a variety</span>
            <span class="co1"># of HTTP-related exceptions.</span>
            <span class="kw1">pass</span></pre>
</div>

<p>Una solución más eficiente, sin embargo, sería llamar a <code>ping_google()</code> desde
un script <code>cron</code> o un manejador de tareas. La función hace un pedido HTTP a
los servidores de Google, por lo que no querrás introducir esa demora asociada 
a la actividad de red cada vez que se llame al método <code>save()</code>.</p>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_11/el_framework_de_feeds_de_sindicacion.html">
                        <strong>&larr; Anterior</strong>
                        <small>11.5. El Framework de Feeds de Sindicación</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_11/que_sigue.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>11.7. ¿Qué sigue?</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Empezando</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Los principios de las páginas Web dinámicas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> El sistema de plantillas de Django</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Interactuar con una base de datos: Modelos</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El sitio de Administración Django</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Procesamiento de formularios</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Vistas avanzadas y URLconfs</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Vistas genéricas</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Extender el sistema de plantillas</a>
            </li>
                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_11.html">
                    <span>Capítulo 11.</span> Generación de contenido no HTML
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/lo_basico_vistas_y_tipos_mime.html">
                    <span>11.1.</span> Lo básico: Vistas y tipos MIME
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/produccion_de_csv.html">
                    <span>11.2.</span> Producción de CSV
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/generar_pdfs.html">
                    <span>11.3.</span> Generar PDFs
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/otras_posibilidades.html">
                    <span>11.4.</span> Otras posibilidades
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/el_framework_de_feeds_de_sindicacion.html">
                    <span>11.5.</span> El Framework de Feeds de Sindicación
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_11/los_sitemaps_de_xml.html">
                    <span>11.6.</span> Los sitemaps de XML
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_11/que_sigue.html">
                    <span>11.7.</span> ¿Qué sigue?
                </a>
            </li>
                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Sesiones, usuario e inscripciones</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Cache</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Otros sub-frameworks contribuidos</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Middleware</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Integración con Base de datos y Aplicaciones existentes</a>
            </li>
                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Extender la Interfaz de Administración de Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>20.</span> <a href="../capitulo_20.html"> Puesta en marcha de Django en un servidor</a>
            </li>
                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
