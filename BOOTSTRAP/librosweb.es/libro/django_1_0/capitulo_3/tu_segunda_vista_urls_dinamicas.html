<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>3.6. Tu segunda Vista: URLs dinámicas (El libro de Django 1.0)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_3/errores_404.html" />
                    <link rel="next" href="../capitulo_3/paginas_de_error_bonitas_con_django.html" />
                <link rel="start" href="/libro/django_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="3.6. Tu segunda Vista: URLs dinámicas (El libro de Django 1.0)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page django_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/" itemprop="url">
                    <span itemprop="title">El libro de Django 1.0</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/capitulo_3.html" itemprop="url">
                    <span itemprop="title">Capítulo 3. Los principios de las páginas Web dinámicas</span>
                </a>
            </li>
        
            <li class="active">
                <span>3.6. Tu segunda Vista: URLs dinámicas</span>
            </li>
        </ol>
    </div>

    <h1 id="tu_segunda_vista_urls_dinamicas" class="title">
        <span>3.6.</span> Tu segunda Vista: URLs dinámicas
    </h1>

    

<p>En la primer vista de ejemplo, el contenido de la página
— la fecha/hora actual — eran dinámicas, pero la URL (<code>/time</code>) era
estática. En la mayoría de las aplicaciones Web, sin embargo, la URL contiene
parámetros que influyen en la salida de la página.</p>

<p>Vamos a crear una segunda vista que nos muestre la fecha y hora actual con un
adelanto de ciertas horas. El objetivo es montar un sitio en la que la página
<code>/time/plus/1/</code> muestre la fecha/hora una hora más adelantada, la página
<code>/time/plus/2/</code> muestre la fecha/hora dos horas más adelantada, la página
<code>/time/plus/3/</code> muestre la fecha/hora tres horas más adelantada, y así.</p>

<p>A un novato se le ocurriría escribir una función de vista distinta para cada
adelanto de horas, lo que resultaría una URLconf como esta:</p>

<div class="code python">
<pre class="python">urlpatterns <span class="sy0">=</span> patterns<span class="br0">&#40;</span><span class="st0">''</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/$'</span><span class="sy0">,</span> current_datetime<span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/plus/1/$'</span><span class="sy0">,</span> one_hour_ahead<span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/plus/2/$'</span><span class="sy0">,</span> two_hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/plus/3/$'</span><span class="sy0">,</span> three_hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/plus/4/$'</span><span class="sy0">,</span> four_hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span></pre>
</div>

<p>Claramente, esta línea de pensamiento es incorrecta. No sólo porque producirá
redundancia entre las funciones de vista, sino también la aplicación estará
limitada a admitir sólo el rango horario definido — uno, dos, tres o
cuatro horas. Si, de repente, quisiéramos crear una página que mostrara la hora
cinco horas adelantada, tendríamos que crear una vista distinta y una línea
URLconf, perpetuando la duplicación y la demencia. Aquí necesitamos algo de
abstracción.</p>

<h3 id="algunas_palabras_acerca_de_las_urls_bonitas">3.6.1. Algunas palabras acerca de las URLs bonitas</h3>

<p>Si tienes experiencia en otra plataforma de diseño Web, como PHP o Java, es
posible que estés pensado, "¡Oye, usemos un parámetro cadena de consulta!", 
algo como <code>/time/plus?hours=3</code>, en la cual la hora será designada por el 
parámetro <code>hours</code> de la cadena de consulta de la URL (la parte a continuación 
de <code>?</code>).</p>

<p>Con Django <em>puedes</em> hacer eso (pero te diremos cómo más adelante, si es que
realmente quieres saberlo), pero una de las filosofías del núcleo de Django es 
que las URLs deben ser bonitas. La URL <code>/time/plus/3</code> es mucho más limpia, más
simple, más legible, más fácil de dictarse a alguien y ... justamente más
bonita que su homóloga forma de cadena de consulta. Las URLs bonitas son un
signo de calidad en las aplicaciones Web.</p>

<p>El sistema de URLconf que usa Django estimula a generar URLs bonitas, haciendo
más fácil el usarlas que el no usarlas.</p>

<h3 id="comodines_en_los_patrones_url">3.6.2. Comodines en los patrones URL</h3>

<p>Continuando con nuestro ejemplo <code>hours_ahead</code>, pongámosle un comodín al
patrón URL. Como ya se mencionó antes, un patrón URL es una expresión regular;
de aquí, es que usamos el patrón de expresión regular <code>\d+</code> para que
coincida con uno o más dígitos:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">conf</span>.<span class="me1">urls</span>.<span class="me1">defaults</span> <span class="kw1">import</span> *
<span class="kw1">from</span> mysite.<span class="me1">views</span> <span class="kw1">import</span> current_datetime<span class="sy0">,</span> hours_ahead
&nbsp;
urlpatterns <span class="sy0">=</span> patterns<span class="br0">&#40;</span><span class="st0">''</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/$'</span><span class="sy0">,</span> current_datetime<span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/plus/<span class="es0">\d</span>+/$'</span><span class="sy0">,</span> hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span></pre>
</div>

<p>Este patrón coincidirá con cualquier URL que sea como <code>/time/plus/2/</code>,
<code>/time/plus/25/</code>, o también <code>/time/plus/100000000000/</code>. Ahora que lo
pienso, podemos limitar el lapso máximo de horas en 99. Eso significa que
queremos tener números de uno o dos dígitos en la sintaxis de las expresiones
regulares, con lo que nos quedaría así <code>\d{1,2}</code>:</p>

<div class="code python">
<pre class="python"><span class="br0">&#40;</span>r<span class="st0">'^time/plus/<span class="es0">\d</span>{1,2}/$'</span><span class="sy0">,</span> hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> Cuando construimos aplicaciones Web, siempre es importante considerar el
caso más descabellado posible de entrada, y decidir si la aplicación
admitirá o no esa entrada. Aquí hemos limitado a los exagerados
reconociendo lapsos de hasta 99 horas. Y, por cierto, <em>Los Limitadores
exagerados</em>, aunque largo, sería un nombre fantástico para una banda
musical.</p></div>

<p>Ahora designaremos el comodín para la URL, necesitamos una forma de pasar esa
información a la función de vista, así podremos usar una sola función de vista
para cualquier adelanto de hora. Lo haremos colocando paréntesis alrededor de
los datos en el patrón URL que querramos guardar. En el caso del ejemplo,
queremos guardar cualquier número que se anotará en la URL, entonces pongamos
paréntesis alrededor de <code>\d{1,2}</code>:</p>

<div class="code python">
<pre class="python"><span class="br0">&#40;</span>r<span class="st0">'^time/plus/(<span class="es0">\d</span>{1,2})/$'</span><span class="sy0">,</span> hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span></pre>
</div>

<p>Si estás familiarizado con las expresiones regulares, te sentirás como en casa
aquí; estamos usando paréntesis para <em>capturar</em> los datos del texto que
coincide.</p>

<p>La URLconf final, incluyendo la vista anterior <code>current_datetime</code>, nos
quedará algo así:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">conf</span>.<span class="me1">urls</span>.<span class="me1">defaults</span> <span class="kw1">import</span> *
<span class="kw1">from</span> mysite.<span class="me1">views</span> <span class="kw1">import</span> current_datetime<span class="sy0">,</span> hours_ahead
&nbsp;
urlpatterns <span class="sy0">=</span> patterns<span class="br0">&#40;</span><span class="st0">''</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/$'</span><span class="sy0">,</span> current_datetime<span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#40;</span>r<span class="st0">'^time/plus/(<span class="es0">\d</span>{1,2})/$'</span><span class="sy0">,</span> hours_ahead<span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span></pre>
</div>

<p>Con cuidado, vamos a escribir la vista <code>hours_ahead</code>.</p>

<div class="admonition sidebar"><p><strong class="title"> Orden para programar</strong> En este ejemplo, primero escribimos el patrón URL y en segundo lugar la
vista, pero en el ejemplo anterior, escribimos la vista primero y luego el
patrón de URL. ¿Qué técnica es mejor? Bien, cada programador es diferente.</p>

<p>Si eres del tipo de programadores que piensan globalmente, puede que tenga
más sentido que escribas todos los patrones de URL para la aplicación al
mismo tiempo, al inicio del proyecto, y después el código de las funciones
de vista. Esto tiene la ventaja de darnos una lista de objetivos clara, y es
esencial definir los parámetros requeridos por las funciones de vista que
necesitaremos desarrollar.</p>

<p>Si eres del tipo de programadores que les gusta ir de abajo hacia arriba,
tal vez prefieras escribir las funciones de vista primero, y luego
asociarlas a URLs. Esto también está bien.</p>

<p>Al final, todo se reduce a elegir qué técnica se amolda más a tu cerebro.
Ambos enfoques son válidos.</p></div>

<p><code>hours_ahead</code> es muy similar a <code>current_datetime</code>, vista que escribimos
antes, sólo que con una diferencia: tomará un argumento extra, el número de
horas que debemos adelantar. Agrega al archivo <code>views.py</code> lo siguiente:</p>

<div class="code python">
<pre class="python"><span class="kw1">import</span> django.<span class="me1">http</span>.<span class="me1">HttpResponse</span>
<span class="kw1">import</span> <span class="kw3">datetime</span>
&nbsp;
<span class="kw1">def</span> hours_ahead<span class="br0">&#40;</span>request<span class="sy0">,</span> offset<span class="br0">&#41;</span>:
    offset <span class="sy0">=</span> <span class="kw2">int</span><span class="br0">&#40;</span>offset<span class="br0">&#41;</span>
    dt <span class="sy0">=</span> <span class="kw3">datetime</span>.<span class="kw3">datetime</span>.<span class="me1">now</span><span class="br0">&#40;</span><span class="br0">&#41;</span> + <span class="kw3">datetime</span>.<span class="me1">timedelta</span><span class="br0">&#40;</span>hours<span class="sy0">=</span>offset<span class="br0">&#41;</span>
    html <span class="sy0">=</span> <span class="st0">&quot;&lt;html&gt;&lt;body&gt;In %s hour(s), it will be %s.&lt;/body&gt;&lt;/html&gt;&quot;</span> % <span class="br0">&#40;</span>offset<span class="sy0">,</span> dt<span class="br0">&#41;</span>
    <span class="kw1">return</span> HttpResponse<span class="br0">&#40;</span>html<span class="br0">&#41;</span></pre>
</div>

<p>Repasemos el código anterior línea a línea:</p>

<ul>
<li>Tal como hicimos en la vista <code>current_datetime</code>, importamos la clase
<code>django.http.HttpResponse</code> y el módulo <code>datetime</code>.</li>
<li>La función de vista <code>hours_ahead</code>, toma <em>dos</em> parámetros: <code>request</code> y
<code>offset</code>.</li>
<li><code>request</code> es un objeto <code>HttpRequest</code>, al igual que en
<code>current_datetime</code>. Lo diremos nuevamente: cada vista <em>siempre</em>
toma un objeto <code>HttpRequest</code> como primer parámetro.</li>
<li><p><code>offset</code> es la cadena de caracteres capturada por los paréntesis en
el patrón URL. Por ejemplo, si la petición URL fuera
<code>/time/plus/3/</code>, entonces el <code>offset</code> debería ser la cadena de
caracteres <code>'3'</code>. Si la petición URL fuera <code>/time/plus/21/</code>,
entonces el <code>offset</code> debería ser la cadena de caracteres <code>'21'</code>.
Notar que la cadena de caracteres capturada siempre es una cadena de
caracteres, no un entero, incluso si se compone sólo de dígitos, como
en el caso <code>'21'</code>.</p>

<p>Decidimos llamar a la variable <code>offset</code>, pero puedes asignarle el
nombre que quieras, siempre que sea un identificador válido para
Python. El nombre de la variable no importa; todo lo que importa es lo
que contiene el segundo parámetro de la función (luego de <code>request</code>).
Es posible también usar untienes que hacer esto. No es una buena idea 
poner cualquier código Python en la carpeta  raíz del servia palabra 
clave, en lugar de posición, como argumentos en la URLconf. Eso lo veremos 
en detalle en el Capítulo 8.</p></li>
<li>Lo primero que hacemos en la función es llamar a <code>int()</code> sobre
<code>offset</code>. Esto convierte el valor de la cadena de caracteres a entero.
Tener en cuenta que Python lanzará una excepción <code>ValueError</code> si se
llama a la función <code>int()</code> con un valor que no puede convertirse a un
entero, como lo sería la cadena de caracteres <code>'foo'</code>. Sin embargo, en
este ejemplo no debemos preocuparnos de atrapar la excepción, porque
tenemos la certeza que la variable <code>offset</code> será una cadena de
caracteres conformada sólo por dígitos. Sabemos esto, por el patrón URL
de la expresión regular en el URLconf — <code>(\d{1,2})</code>— captura sólo
dígitos. Esto ilustra otra ventaja de tener un URLconf: nos provee un
primer nivel de validación de entrada.</li>
<li>La siguiente línea de la función muestra la razón por la que se llamó a
la función <code>int()</code> con <code>offset</code>. En esta línea, calculamos la hora
actual más las hora que tiene <code>offset</code>, almacenando el resultado en la
variable <code>dt</code>. La función <code>datetime.timedelta</code> requiere que el
parámetro <code>hours</code> sea un entero.</li>
<li>A continuación, construimos la salida HTML de esta función de vista, tal
como lo hicimos en la vista <code>current_datetime</code>. Una pequeña diferencia
en esta línea, es que usamos el formato de cadenas de Python con <em>dos</em>
valores, no sólo uno. Por lo tanto, hay dos símbolos <code>%s</code> en la cadena
de caracteres y la tupla de valores a insertar sería: <code>(offset, dt)</code>.</li>
<li>Finalmente, retornamos el <code>HttpResponse</code> del HTML — de nuevo, tal como
hicimos en la vista <code>current_datetime</code>.</li>
</ul>

<p>Con esta función de vista y la URLconf escrita, ejecuta el servidor de
desarrollo de Django (si no está corriendo), y visita
<code>http://127.0.0.1:8000/time/plus/3/</code> para verificar que lo que hicimos
funciona. Luego prueba <code>http://127.0.0.1:8000/time/plus/5/</code>.  Para terminar
visita <code>http://127.0.0.1:8000/time/plus/100/</code> para verificar que el patrón en
la URLconf sólo acepta número de uno o dos dígitos, Django debería mostrar un
error en este caso como "Page not found", tal como vimos anteriorment en la 
sección <em>"Errores 404"</em>. La URL <code>http://127.0.0.1:8000/time/plus/</code> (<em>sin</em> horas
designadas) debería también mostrar un error 404.</p>

<p>Si estás siguiendo el libro y programando al mismo tiempo, notarás que el
archivo <code>views.py</code> ahora contiene dos vistas. (Omitimos la vista
<code>current_datetime</code> del ejemplo anterior sólo por claridad). Poniéndolas 
juntas, veríamos algo similar a esto:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">http</span> <span class="kw1">import</span> HttpResponse
<span class="kw1">import</span> <span class="kw3">datetime</span>
&nbsp;
<span class="kw1">def</span> current_datetime<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    now <span class="sy0">=</span> <span class="kw3">datetime</span>.<span class="kw3">datetime</span>.<span class="me1">now</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    html <span class="sy0">=</span> <span class="st0">&quot;&lt;html&gt;&lt;body&gt;It is now %s.&lt;/body&gt;&lt;/html&gt;&quot;</span> % now
    <span class="kw1">return</span> HttpResponse<span class="br0">&#40;</span>html<span class="br0">&#41;</span>
&nbsp;
<span class="kw1">def</span> hours_ahead<span class="br0">&#40;</span>request<span class="sy0">,</span> offset<span class="br0">&#41;</span>:
    offset <span class="sy0">=</span> <span class="kw2">int</span><span class="br0">&#40;</span>offset<span class="br0">&#41;</span>
    dt <span class="sy0">=</span> <span class="kw3">datetime</span>.<span class="kw3">datetime</span>.<span class="me1">now</span><span class="br0">&#40;</span><span class="br0">&#41;</span> + <span class="kw3">datetime</span>.<span class="me1">timedelta</span><span class="br0">&#40;</span>hours<span class="sy0">=</span>offset<span class="br0">&#41;</span>
    html <span class="sy0">=</span> <span class="st0">&quot;&lt;html&gt;&lt;body&gt;In %s hour(s), it will be %s.&lt;/body&gt;&lt;/html&gt;&quot;</span> % <span class="br0">&#40;</span>offset<span class="sy0">,</span> dt<span class="br0">&#41;</span>
    <span class="kw1">return</span> HttpResponse<span class="br0">&#40;</span>html<span class="br0">&#41;</span></pre>
</div>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_3/errores_404.html">
                        <strong>&larr; Anterior</strong>
                        <small>3.5. Errores 404</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_3/paginas_de_error_bonitas_con_django.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>3.7. Páginas de error bonitas con Django</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Empezando</a>
            </li>
                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_3.html">
                    <span>Capítulo 3.</span> Los principios de las páginas Web dinámicas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/tu_primera_vista_contenido_dinamico.html">
                    <span>3.1.</span> Tu primera Vista: Contenido dinámico
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/mapeando_urls_a_vistas.html">
                    <span>3.2.</span> Mapeando URLs a Vistas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/como_procesa_una_peticion_django.html">
                    <span>3.3.</span> Cómo procesa una petición Django
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/urlconfs_y_el_acoplamiento_debil.html">
                    <span>3.4.</span> URLconfs y el acoplamiento débil
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/errores_404.html">
                    <span>3.5.</span> Errores 404
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_3/tu_segunda_vista_urls_dinamicas.html">
                    <span>3.6.</span> Tu segunda Vista: URLs dinámicas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/paginas_de_error_bonitas_con_django.html">
                    <span>3.7.</span> Páginas de error bonitas con Django
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_3/que_sigue.html">
                    <span>3.8.</span> ¿Qué sigue?
                </a>
            </li>
                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> El sistema de plantillas de Django</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Interactuar con una base de datos: Modelos</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El sitio de Administración Django</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Procesamiento de formularios</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Vistas avanzadas y URLconfs</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Vistas genéricas</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Extender el sistema de plantillas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Generación de contenido no HTML</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Sesiones, usuario e inscripciones</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Cache</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Otros sub-frameworks contribuidos</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Middleware</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Integración con Base de datos y Aplicaciones existentes</a>
            </li>
                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Extender la Interfaz de Administración de Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>20.</span> <a href="../capitulo_20.html"> Puesta en marcha de Django en un servidor</a>
            </li>
                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
