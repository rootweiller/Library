<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>16.1. Integración con una base de datos existente (El libro de Django 1.0)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_16.html" />
                    <link rel="next" href="../capitulo_16/integracion_con_un_sistema_de_autentificacion.html" />
                <link rel="start" href="/libro/django_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="16.1. Integración con una base de datos existente (El libro de Django 1.0)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page django_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/" itemprop="url">
                    <span itemprop="title">El libro de Django 1.0</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/capitulo_16.html" itemprop="url">
                    <span itemprop="title">Capítulo 16. Integración con Base de datos y Aplicaciones existentes</span>
                </a>
            </li>
        
            <li class="active">
                <span>16.1. Integración con una base de datos existente</span>
            </li>
        </ol>
    </div>

    <h1 id="integracion_con_una_base_de_datos_existente" class="title">
        <span>16.1.</span> Integración con una base de datos existente
    </h1>

    

<p>La capa de base de datos de Django genera esquemas SQL desde código Python —
pero con una base de datos existente, tú ya tienes los esquemas SQL. En tal
caso, necesitas crear modelos para tus tablas de la base de datos existente.
Para este propósito, Django incluye una herramienta que puede generar el código
del modelo leyendo el diseño de las tablas de la base de datos. Esta 
herramienta se llama <code>inspectdb</code>, y puedes llamarla ejecutando el comando
<code>manage.py inspectdb</code>.</p>

<h3 id="empleo_de_inspectdb">16.1.1. Empleo de <code>inspectdb</code></h3>

<p>La utilidad <code>inspectdb</code> realiza una introspección de la base de datos a la que
apunta tu archivo de configuración, determina una representación del modelo que
usará Django para cada una de tus tablas, e imprime el código Python del modelo
a la salida estándar.</p>

<p>Esta es una guía de un proceso típico de integración con una base de datos
existente desde cero. Las únicas suposiciones son que Django esta instalado y
tienes una base de datos existente.</p>

<p><strong>1.</strong> Crea un proyecto Django ejecutando <code>django-admin.py startproject
mysite</code> (donde <code>mysite</code> es el nombre de tu proyecto). Usaremos
<code>mysite</code> como nombre de proyecto en este ejemplo.</p>

<p><strong>2.</strong> Edita el archivo de configuración en ese proyecto,
<code>mysite/settings.py</code>, para decirle a Django cuáles son los parámetros
de conexión a tu base de datos y cuál es su nombre. Específicamente,
provee las configuraciones de <code>DATABASE_NAME</code>, <code>DATABASE_ENGINE</code>,
<code>DATABASE_USER</code>, <code>DATABASE_PASSWORD</code>, <code>DATABASE_HOST</code>, y
<code>DATABASE_PORT</code>.  (Ten en cuenta que algunas de estas configuraciones
son opcionales. Mira el Capítulo 5 para más información).</p>

<p><strong>3.</strong> Crea una aplicación dentro de tu proyecto ejecutando <code>python
mysite/manage.py startapp myapp</code> (donde <code>myapp</code> es el nombre de tu
aplicación). Usaremos <code>myapp</code> como el nombre de aplicación aquí.</p>

<p><strong>4.</strong> Ejecuta el comando <code>python mysite/manage.py inspectdb</code>. Esto examinará
las tablas en la base de datos <code>DATABASE_NAME</code> e imprimirá para cada
tabla el modelo de clase generado. Hecha una mirada a la salida para
tener una idea de lo que puede hacer <code>inspectdb</code>.</p>

<p><strong>5.</strong> Guarda la salida en el archivo <code>models.py</code> dentro de tu aplicación
usando la redirección de salida estándar de la shell:</p>

<div class="code python">
<pre class="python">$ python mysite/manage.<span class="me1">py</span> inspectdb <span class="sy0">&gt;</span> mysite/myapp/models.<span class="me1">py</span></pre>
</div>

<p><strong>6.</strong> Edita el archivo <code>mysite/myapp/models.py</code> para limpiar los modelos
generados y realiza cualquier personalización necesaria. Te daremos
algunas sugerencias para esto en la siguiente sección.</p>

<h3 id="limpiar_los_modelos_generados">16.1.2. Limpiar los modelos generados</h3>

<p>Como podrías esperar, la introspección de la base de datos no es perfecta, y
necesitarás hacer una pequeña limpieza al código del modelo resultante. Aquí 
hay algunos apuntes para lidiar con los modelos generados:</p>

<p><strong>1.</strong> Cada tabla de la base de datos es convertida en una clase del modelo (es
decir, hay un mapeo de uno-a-uno entre las tablas de la base de datos y
las clases del modelo). Esto significa que tendrás que refactorizar los
modelos para tablas con relaciones muchos-a-muchos en objetos
<code>ManyToManyField</code>.</p>

<p><strong>2.</strong> Cada modelo generado tiene un atributo para cada campo, incluyendo 
campos de clave primaria <code>id</code>. Sin embargo, recuerda que Django agrega
automáticamente un campo de clave primaria <code>id</code> si un modelo no tiene
una clave primaria. Por lo tanto, querrás remover cualquier línea que se
parezca a ésta:</p>

<div class="code python">
<pre class="python"><span class="kw2">id</span> <span class="sy0">=</span> models.<span class="me1">IntegerField</span><span class="br0">&#40;</span>primary_key<span class="sy0">=</span><span class="kw2">True</span><span class="br0">&#41;</span></pre>
</div>

<p>No solo estas líneas son redundantes, sino que pueden causar problemas si
tu aplicación agregara <em>nuevos</em> registros a estas tablas. El comando
<code>inspectdb</code> no puede detectar si un campo es autoincrementado, así que
está en tí cambiar esto a <code>AutoField</code>, si es necesario.</p>

<p><strong>3.</strong> Cada tipo de campo (ej., <code>CharField</code>, <code>DateField</code>) es determinado
mirando el tipo de la columna de la base de datos (ej., <code>VARCHAR</code>,
<code>DATE</code>). Si <code>inspectdb</code> no puede mapear un tipo de columna a un tipo
de campo del modelo, usará <code>TextField</code> e insertará el comentario Python
<code>'This field type is a guess.'</code> a continuación del campo en el modelo
generado. Mantén un ojo en eso, y cambia el tipo de campo adecuadamente
si es necesario.</p>

<p>Si un campo en tu base de datos no tiene un buen equivalente en Django,
con seguridad puedes dejarlo fuera. La capa de modelo de Django no
requiere que incluyas todos los campos de tu(s) tabla(s).</p>

<p><strong>4.</strong> Si un nombre de columna de tu base de datos es una palabra reservada de
Python (como <code>pass</code>, <code>class</code> o <code>for</code>), <code>inspectdb</code> agregará
<code>'_field'</code> al nombre del atributo y establecerá el atributo
<code>db_column</code> al nombre real del campo (ej., <code>pass</code>, <code>class</code>, o
<code>for</code>).</p>

<p>Por ejemplo, si una tabla tiene una columna <code>INT</code> llamada <code>for</code>, el
modelo generado tendrá un campo como este:</p>

<div class="code python">
<pre class="python">for_field <span class="sy0">=</span> models.<span class="me1">IntegerField</span><span class="br0">&#40;</span>db_column<span class="sy0">=</span><span class="st0">'for'</span><span class="br0">&#41;</span></pre>
</div>

<p><code>inspectdb</code> insertará el comentario Python <code>'Field renamed because it
was a Python reserved word.'</code> a continuación del campo.</p>

<p><strong>5.</strong> Si tu base de datos contiene tablas que hacen referencia a otras tablas
(como la mayoría de las bases de datos lo hacen), tal vez tengas que
re-acomodar el orden de los modelos generados, de manera que los modelos
que hacen referencia a otros modelos estén ordenados apropiadamente. Por
ejemplo, si un modelo <code>Book</code> tiene una <code>ForeignKey</code> al modelo
<code>Author</code>, el modelo <code>Author</code> debe ser definido antes del modelo
<code>Book</code>. Si necesitas crear una relación en un modelo que todavía no
esta definido, puedes usar el nombre del modelo, en vez del objeto modelo
en sí.</p>

<p><strong>6.</strong> <code>inspectdb</code> detecta claves primarias para PostgreSQL, MySQL y SQLite.
Es decir, inserta <code>primary_key=True</code> donde sea necesario. Para otras
bases de datos, necesitarás insertar <code>primary_key=True</code> para al menos
un campo en cada modelo, ya que los modelos Django requieren tener un
campo <code>primary_key=True</code>.</p>

<p><strong>7.</strong> La detección de claves foráneas sólo funciona con PostgreSQL y con
ciertos tipos de tablas MySQL. En otros casos, los campos de clave
foránea serán generados como campos <code>IntegerField</code>, asumiendo que la
columna de clave foránea fue una columna <code>INT</code>.</p>



    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_16.html">
                        <strong>&larr; Anterior</strong>
                        <small>Capítulo 16. Integración con Base de datos y Aplicaciones existentes</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_16/integracion_con_un_sistema_de_autentificacion.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>16.2. Integración con un sistema de autentificación</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Empezando</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Los principios de las páginas Web dinámicas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> El sistema de plantillas de Django</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Interactuar con una base de datos: Modelos</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El sitio de Administración Django</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Procesamiento de formularios</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Vistas avanzadas y URLconfs</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Vistas genéricas</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Extender el sistema de plantillas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Generación de contenido no HTML</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Sesiones, usuario e inscripciones</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Cache</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Otros sub-frameworks contribuidos</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Middleware</a>
            </li>
                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_16.html">
                    <span>Capítulo 16.</span> Integración con Base de datos y Aplicaciones existentes
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_16/integracion_con_una_base_de_datos_existente.html">
                    <span>16.1.</span> Integración con una base de datos existente
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/integracion_con_un_sistema_de_autentificacion.html">
                    <span>16.2.</span> Integración con un sistema de autentificación
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/integracion_con_aplicaciones_web_existentes.html">
                    <span>16.3.</span> Integración con aplicaciones web existentes
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/que_sigue.html">
                    <span>16.4.</span> ¿Qué sigue?
                </a>
            </li>
                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Extender la Interfaz de Administración de Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>20.</span> <a href="../capitulo_20.html"> Puesta en marcha de Django en un servidor</a>
            </li>
                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
