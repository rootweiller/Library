<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>14.2. Sites (El libro de Django 1.0)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_14/la_libreria_estandar_de_django.html" />
                    <link rel="next" href="../capitulo_14/flatpages.html" />
                <link rel="start" href="/libro/django_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="14.2. Sites (El libro de Django 1.0)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page django_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/" itemprop="url">
                    <span itemprop="title">El libro de Django 1.0</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/django_1_0/capitulo_14.html" itemprop="url">
                    <span itemprop="title">Capítulo 14. Otros sub-frameworks contribuidos</span>
                </a>
            </li>
        
            <li class="active">
                <span>14.2. Sites</span>
            </li>
        </ol>
    </div>

    <h1 id="sites" class="title">
        <span>14.2.</span> Sites
    </h1>

    

<p>El sistema <em>sites</em> de Django es un <em>framework</em> genérico que te permite
operar múltiples sitios web desde la misma base de datos, y desde el
mismo proyecto de Django. Éste es un concepto abstracto, y puede ser
difícil de entender, así que comenzaremos mostrando algunos escenarios
en donde sería útil usarlo.</p>

<h3 id="escenario_1_reuso_de_los_datos_en_multiples_sitios">14.2.1. Escenario 1: reuso de los datos en múltiples sitios</h3>

<p>Como explicamos en el Capítulo 1, los sitios LJWorld.com y
Lawrence.com, que funcionan gracias a Django, son operados por la
misma organización de prensa, el diario <em>Lawrence Journal-World</em> de
Lawrence, Kansas. LJWorld.com se enfoca en noticias, mientras que
Lawrence.com se enfoca en el entretenimiento local. Pero a veces los
editores quieren publicar un artículo en <em>ambos</em> sitios.</p>

<p>La forma cabeza dura de resolver el problema sería usar una base de
datos para cada sitio, y pedirle a los productores que publiquen la
misma nota dos veces: una para LJWorld.com y nuevamente para
Lawrence.com. Pero esto es ineficiente para los productores del sitio,
y es redundante conservar múltiples copias de la misma nota en las
bases de datos.</p>

<p>¿Una solución mejor? Que ambos sitios usen la misma base de datos de
artículos, y que un artículo esté asociado con uno o más sitios por
una relación de muchos-a-muchos. El <em>framework</em> <em>sites</em> de Django,
proporciona la tabla de base de datos que hace que los artículos se
puedan relacionar de esta forma. Sirve para asociar datos con uno o
más "sitios".</p>

<h3 id="escenario_2_alojamiento_del_nombre_dominio_de_tu_sitio_en_un_solo_lugar">14.2.2. Escenario 2: alojamiento del nombre/dominio de tu sitio en un solo lugar</h3>

<p>Los dos sitios LJWorld.com y Lawrence.com, tienen la funcionalidad de
alertas por correo electrónico, que les permite a los lectores
registrarse para obtener notificaciones. Es bastante básico: un lector
se registra en un formulario web, e inmediatamente obtiene un correo
electrónico que dice "Gracias por su suscripción".</p>

<p>Sería ineficiente y redundante implementar el código del procesamiento
de registros dos veces, así que los sitios usan el mismo código detrás
de escena. Pero la noticia "Gracias por su suscripción" debe ser
distinta para cada sitio. Empleando objetos <code>Site</code>, podemos abstraer
el agradecimiento para usar los valores del nombre y dominio del
sitio, variables <code>name</code> (ej. <code>LJWorld.com</code>) y <code>domain</code> (ej.
<code>www.ljworld.com</code>).</p>

<p>El <em>framework</em> <em>sites</em> te proporciona un lugar para que puedas almacenar
el nombre (<code>name</code>) y el dominio (<code>domain</code>) de cada sitio de tu
proyecto, lo que significa que puedes reutilizar estos valores de
manera genérica.</p>

<h3 id="modo_de_uso_del_framework_sites">14.2.3. Modo de uso del <em>framework</em> <em>sites</em></h3>

<p>Sites más que un <em>framework</em>, es una serie de convenciones. Toda la
cosa se basa en dos conceptos simples:</p>

<ul>
<li>el modelo <code>Site</code>, que se halla en <code>django.contrib.sites</code>,
tiene los campos <code>domain</code> y <code>name</code>.</li>
<li>la opción de configuración <code>SITE_ID</code> especifica el ID de la
base de datos del objeto <code>Site</code> asociado con este archivo de
configuración en particular.</li>
</ul>

<p>La manera en que uses estos dos conceptos queda a tu criterio, pero
Django los usa de varios modos de manera automática, siguiendo
convenciones simples.</p>

<p>Para instalar la aplicación <em>sites</em>, sigue estos pasos:</p>

<ol>
<li>Agrega <code>'django.contrib.sites'</code> a tu <code>INSTALLED_APPS</code>.</li>
<li>Ejecuta el comando <code>manage.py syncdb</code> para instalar la tabla
 <code>django_site</code> en tu base de datos.</li>
<li>Agrega uno o más objetos <code>Site</code>, por medio del sitio de
 administración de Django, o por medio de la API de Python. Crea
 un objeto <code>Site</code> para cada sitio/dominio que esté respaldado
 por este proyecto Django.</li>
<li>Define la opción de configuración <code>SITE_ID</code> en cada uno de
 tus archivos de configuración (<em>settings</em>). Este valor debería
 ser el ID de base de datos del objeto <code>Site</code> para el sitio
 respaldado por el archivo de configuración.</li>
</ol>

<h3 id="las_capacidades_del_framework_sites">14.2.4. Las capacidades del framework Sites</h3>

<p>Las siguientes secciones describen las cosas que puedes hacer con este
<em>framework</em>.</p>

<h4 id="reuso_de_los_datos_en_multiples_sitios">14.2.4.1.  Reuso de los datos en múltiples sitios</h4>

<p>Para reusar los datos en múltiples sitios, como explicamos en el
primer escenario, simplemente debes agregarle un campo
muchos-a-muchos, <code>ManyToManyField</code> hacia <code>Site</code> en tus
modelos. Por ejemplo:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">db</span> <span class="kw1">import</span> models
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
&nbsp;
<span class="kw1">class</span> Article<span class="br0">&#40;</span>models.<span class="me1">Model</span><span class="br0">&#41;</span>:
    headline <span class="sy0">=</span> models.<span class="me1">CharField</span><span class="br0">&#40;</span>maxlength<span class="sy0">=</span><span class="nu0">200</span><span class="br0">&#41;</span>
    <span class="co1"># ...</span>
    sites <span class="sy0">=</span> models.<span class="me1">ManyToManyField</span><span class="br0">&#40;</span>Site<span class="br0">&#41;</span></pre>
</div>

<p>Esa es toda la infraestructura necesaria para asociar artículos con
múltiples sitios en tu base de datos. Con eso en su lugar, puedes
reusar el mismo código de vista para múltiples sitios. Continuando con
el modelo <code>Article</code> del ejemplo, aquí mostramos cómo luciría una
vista <code>article_detail</code>:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">conf</span> <span class="kw1">import</span> settings
&nbsp;
<span class="kw1">def</span> article_detail<span class="br0">&#40;</span>request<span class="sy0">,</span> article_id<span class="br0">&#41;</span>:
    <span class="kw1">try</span>:
        a <span class="sy0">=</span> Article.<span class="me1">objects</span>.<span class="me1">get</span><span class="br0">&#40;</span><span class="kw2">id</span><span class="sy0">=</span>article_id<span class="sy0">,</span> sites__id<span class="sy0">=</span>settings.<span class="me1">SITE_ID</span><span class="br0">&#41;</span>
    <span class="kw1">except</span> Article.<span class="me1">DoesNotExist</span>:
        <span class="kw1">raise</span> Http404
    <span class="co1"># ...</span></pre>
</div>

<p>esta función de vista es reusable porque chequea el sitio del artículo
dinámicamente, según cuál sea el valor de la opción <code>SITE_ID</code>.</p>

<p>Por ejemplo, digamos que el archivo de configuración de LJWorld.com
tiene un <code>SITE_ID</code> asignado a <code>1</code>, y que el de Lawrence.com lo
tiene asignado a <code>2</code>. Si esta vista es llamada cuando el archivo de
configuración de LJWorld.com está activado, entonces la búsqueda de
artículos se limita a aquellos en que la lista de sitios incluye
LJWorld.com.</p>

<h4 id="asociacion_de_contenido_con_un_solo_sitio">14.2.4.2. Asociación de contenido con un solo sitio</h4>

<p>De manera similar, puedes asociar un modelo con el modelo <code>Site</code> en una
relación muchos-a-uno, usando <code>ForeignKey</code>.</p>

<p>Por ejemplo, si un artículo sólo se permite en un sitio, puedes usar
un modelo como este:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">db</span> <span class="kw1">import</span> models
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
&nbsp;
<span class="kw1">class</span> Article<span class="br0">&#40;</span>models.<span class="me1">Model</span><span class="br0">&#41;</span>:
    headline <span class="sy0">=</span> models.<span class="me1">CharField</span><span class="br0">&#40;</span>maxlength<span class="sy0">=</span><span class="nu0">200</span><span class="br0">&#41;</span>
    <span class="co1"># ...</span>
    <span class="kw3">site</span> <span class="sy0">=</span> models.<span class="me1">ForeignKey</span><span class="br0">&#40;</span>Site<span class="br0">&#41;</span></pre>
</div>

<p>Este tiene los mismos beneficios, como se describe en la última sección.</p>

<h4 id="obtencion_del_sitio_actual_desde_las_vistas">14.2.4.3. Obtención del sitio actual desde las vistas</h4>

<p>A un nivel más bajo, puedes usar el <em>framework sites</em> en tus vistas de
Django para hacer cosas particulares según el sitio en el cual la
vista sea llamada. Por ejemplo:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">conf</span> <span class="kw1">import</span> settings
&nbsp;
<span class="kw1">def</span> my_view<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    <span class="kw1">if</span> settings.<span class="me1">SITE_ID</span> <span class="sy0">==</span> <span class="nu0">3</span>:
        <span class="co1"># Do something.</span>
    <span class="kw1">else</span>:
        <span class="co1"># Do something else.</span></pre>
</div>

<p>Por supuesto, es horrible meter en el código el ID del sitio de esa
manera. Una forma levemente más limpia de lograr lo mismo, es chequear
el dominio actual del sitio:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">conf</span> <span class="kw1">import</span> settings
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
&nbsp;
<span class="kw1">def</span> my_view<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    current_site <span class="sy0">=</span> Site.<span class="me1">objects</span>.<span class="me1">get</span><span class="br0">&#40;</span><span class="kw2">id</span><span class="sy0">=</span>settings.<span class="me1">SITE_ID</span><span class="br0">&#41;</span>
    <span class="kw1">if</span> current_site.<span class="me1">domain</span> <span class="sy0">==</span> <span class="st0">'foo.com'</span>:
        <span class="co1"># Do something</span>
    <span class="kw1">else</span>:
        <span class="co1"># Do something else.</span></pre>
</div>

<p>Este fragmento de código usado para obtener el objeto <code>Site</code> según
el valor de <code>settings.SITE_ID</code> es tan usado, que el administrador de
modelos de <code>Site</code> (<code>Site.objects</code>) tiene un método
<code>get_current()</code>. El siguiente ejemplo es equivalente al anterior:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
&nbsp;
<span class="kw1">def</span> my_view<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    current_site <span class="sy0">=</span> Site.<span class="me1">objects</span>.<span class="me1">get_current</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="kw1">if</span> current_site.<span class="me1">domain</span> <span class="sy0">==</span> <span class="st0">'foo.com'</span>:
        <span class="co1"># Do something</span>
    <span class="kw1">else</span>:
        <span class="co1"># Do something else.</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> En este último ejemplo, no hay necesidad de importar <code>django.conf.settings</code>.</p></div>

<h4 id="obtencion_del_dominio_actual_para_ser_mostrado">14.2.4.4. Obtención del dominio actual para ser mostrado</h4>

<p>Una forma DRY (acrónimo del inglés <em>Don't Repeat Yourself</em>, "no te repitas") de
guardar el nombre del sitio y del dominio, como explicamos en "Escenario 2:
alojamiento del nombre/dominio de tu sitio en un solo lugar", se logra
simplemente haciendo referencia a <code>name</code> y a <code>domain</code> del objeto <code>Site</code>
actual. Por ejemplo:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
<span class="kw1">from</span> django.<span class="me1">core</span>.<span class="me1">mail</span> <span class="kw1">import</span> send_mail
&nbsp;
<span class="kw1">def</span> register_for_newsletter<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    <span class="co1"># Check form values, etc., and subscribe the user.</span>
    <span class="co1"># ...</span>
    current_site <span class="sy0">=</span> Site.<span class="me1">objects</span>.<span class="me1">get_current</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    send_mail<span class="br0">&#40;</span><span class="st0">'Thanks for subscribing to %s alerts'</span> % current_site.<span class="me1">name</span><span class="sy0">,</span>
        <span class="st0">'Thanks for your subscription. We appreciate it.<span class="es0">\n</span><span class="es0">\n</span>-The %s team.'</span> % current_site.<span class="me1">name</span><span class="sy0">,</span>
        <span class="st0">'editor@%s'</span> % current_site.<span class="me1">domain</span><span class="sy0">,</span>
        <span class="br0">&#91;</span>user_email<span class="br0">&#93;</span><span class="br0">&#41;</span>
    <span class="co1"># ...</span></pre>
</div>

<p>Continuando con nuestro ejemplo de LJWorld.com y Lawrence.com, en
Lawrence.com el correo electrónico tiene como sujeto la línea "Gracias
por suscribirse a las alertas de lawrence.com". En LJWorld.com, en
cambio, el sujeto es "Gracias por suscribirse a las alertas de
LJWorld.com". Este comportamiento específico para cada sitio, también
se aplica al cuerpo del correo electrónico.</p>

<p>Una forma aún más flexible (aunque un poco más pesada) de hacer lo
mismo, es usando el sistema de plantillas de Django. Asumiendo que
Lawrence.com y LJWorld.com tienen distintos directorios de plantillas
(<code>TEMPLATE_DIRS</code>), puedes simplemente delegarlo al sistema de
plantillas así:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">core</span>.<span class="me1">mail</span> <span class="kw1">import</span> send_mail
<span class="kw1">from</span> django.<span class="me1">template</span> <span class="kw1">import</span> loader<span class="sy0">,</span> Context
&nbsp;
<span class="kw1">def</span> register_for_newsletter<span class="br0">&#40;</span>request<span class="br0">&#41;</span>:
    <span class="co1"># Check form values, etc., and subscribe the user.</span>
    <span class="co1"># ...</span>
    subject <span class="sy0">=</span> loader.<span class="me1">get_template</span><span class="br0">&#40;</span><span class="st0">'alerts/subject.txt'</span><span class="br0">&#41;</span>.<span class="me1">render</span><span class="br0">&#40;</span>Context<span class="br0">&#40;</span><span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    message <span class="sy0">=</span> loader.<span class="me1">get_template</span><span class="br0">&#40;</span><span class="st0">'alerts/message.txt'</span><span class="br0">&#41;</span>.<span class="me1">render</span><span class="br0">&#40;</span>Context<span class="br0">&#40;</span><span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    send_mail<span class="br0">&#40;</span>subject<span class="sy0">,</span> message<span class="sy0">,</span> <span class="st0">'<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="c3a7aceeadacb7eeb1a6b3afba83a6bba2aeb3afa6eda0acae">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>'</span><span class="sy0">,</span> <span class="br0">&#91;</span>user_email<span class="br0">&#93;</span><span class="br0">&#41;</span>
    <span class="co1"># ...</span></pre>
</div>

<p>En este caso, debes crear las plantillas <code>subject.txt</code> y
<code>message.txt</code> en ambos directorios de plantillas, el de LJWorld.com
y el de Lawrence.com .  Como mencionamos anteriormente, eso te da más
flexibilidad, pero también es más complejo.</p>

<p>Una buena idea es explotar los objetos <code>Site</code> lo más posible, para
que no haya una complejidad y una redundancia innecesarias.</p>

<h4 id="obtencion_del_dominio_actual_para_las_urls_completas">14.2.4.5. Obtención del dominio actual para las URLs completas</h4>

<p>La convención de Django de usar <code>get_absolute_url()</code> para obtener
las URLs de los objetos sin el dominio, está muy bien. Pero en en
algunos casos puedes querer mostrar la URL completa — con <code>http://</code>
y el dominio, y todo — para un objeto.  Para hacerlo, puedes usar el
<em>framework</em> <em>sites</em>. Este es un ejemplo:</p>

<div class="code python">
<pre class="python"><span class="sy0">&gt;&gt;&gt;</span> <span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
<span class="sy0">&gt;&gt;&gt;</span> obj <span class="sy0">=</span> MyModel.<span class="me1">objects</span>.<span class="me1">get</span><span class="br0">&#40;</span><span class="kw2">id</span><span class="sy0">=</span><span class="nu0">3</span><span class="br0">&#41;</span>
<span class="sy0">&gt;&gt;&gt;</span> obj.<span class="me1">get_absolute_url</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="st0">'/mymodel/objects/3/'</span>
<span class="sy0">&gt;&gt;&gt;</span> Site.<span class="me1">objects</span>.<span class="me1">get_current</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">domain</span>
<span class="st0">'example.com'</span>
<span class="sy0">&gt;&gt;&gt;</span> <span class="st0">'http://%s%s'</span> % <span class="br0">&#40;</span>Site.<span class="me1">objects</span>.<span class="me1">get_current</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">domain</span><span class="sy0">,</span> obj.<span class="me1">get_absolute_url</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="st0">'http://example.com/mymodel/objects/3/'</span></pre>
</div>

<h3 id="currentsitemanager">14.2.5. CurrentSiteManager</h3>

<p>Si los <code>Site</code> juegan roles importantes en tu aplicación, considera el
uso del útil <code>CurrentSiteManager</code> en tu modelo (o modelos). Es un
administrador de modelos (consulta el Apéndice B) que filtra
automáticamente sus consultas para incluir sólo los objetos asociados
al <code>Site</code> actual.</p>

<p>Usa <code>CurrentSiteManager</code> agregándolo a tu modelo explícitamente. Por
ejemplo:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">db</span> <span class="kw1">import</span> models
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">managers</span> <span class="kw1">import</span> CurrentSiteManager
&nbsp;
<span class="kw1">class</span> Photo<span class="br0">&#40;</span>models.<span class="me1">Model</span><span class="br0">&#41;</span>:
    photo <span class="sy0">=</span> models.<span class="me1">FileField</span><span class="br0">&#40;</span>upload_to<span class="sy0">=</span><span class="st0">'/home/photos'</span><span class="br0">&#41;</span>
    photographer_name <span class="sy0">=</span> models.<span class="me1">CharField</span><span class="br0">&#40;</span>maxlength<span class="sy0">=</span><span class="nu0">100</span><span class="br0">&#41;</span>
    pub_date <span class="sy0">=</span> models.<span class="me1">DateField</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="kw3">site</span> <span class="sy0">=</span> models.<span class="me1">ForeignKey</span><span class="br0">&#40;</span>Site<span class="br0">&#41;</span>
    objects <span class="sy0">=</span> models.<span class="me1">Manager</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    on_site <span class="sy0">=</span> CurrentSiteManager<span class="br0">&#40;</span><span class="br0">&#41;</span></pre>
</div>

<p>Con este modelo, <code>Photo.objects.all()</code> retorna todos los objetos <code>Photo</code> de
la base de datos, pero <code>Photo.on_site.all()</code> retorna sólo los objetos
<code>Photo</code> asociados con el sitio actual, de acuerdo a la opción de configuración
<code>SITE_ID</code>.</p>

<p>En otras palabras, estas dos sentencias son equivalentes:</p>

<div class="code python">
<pre class="python">Photo.<span class="me1">objects</span>.<span class="kw2">filter</span><span class="br0">&#40;</span><span class="kw3">site</span><span class="sy0">=</span>settings.<span class="me1">SITE_ID</span><span class="br0">&#41;</span>
Photo.<span class="me1">on_site</span>.<span class="kw2">all</span><span class="br0">&#40;</span><span class="br0">&#41;</span></pre>
</div>

<p>¿Cómo supo <code>CurrentSiteManager</code> cuál campo de <code>Photo</code> era el <code>Site</code>?  Por
defecto busca un campo llamado <code>site</code>. Si tu modelo tiene un campo
<code>ForeignKey</code> o un campo <code>ManyToManyField</code> llamado de otra forma que
<code>site</code>, debes pasarlo explícitamente como el parámetro para
<code>CurrentSiteManager</code>.  El modelo a continuación, que tiene un campo llamado
<code>publish_on</code>, lo demuestra:</p>

<div class="code python">
<pre class="python"><span class="kw1">from</span> django.<span class="me1">db</span> <span class="kw1">import</span> models
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">models</span> <span class="kw1">import</span> Site
<span class="kw1">from</span> django.<span class="me1">contrib</span>.<span class="me1">sites</span>.<span class="me1">managers</span> <span class="kw1">import</span> CurrentSiteManager
&nbsp;
<span class="kw1">class</span> Photo<span class="br0">&#40;</span>models.<span class="me1">Model</span><span class="br0">&#41;</span>:
    photo <span class="sy0">=</span> models.<span class="me1">FileField</span><span class="br0">&#40;</span>upload_to<span class="sy0">=</span><span class="st0">'/home/photos'</span><span class="br0">&#41;</span>
    photographer_name <span class="sy0">=</span> models.<span class="me1">CharField</span><span class="br0">&#40;</span>maxlength<span class="sy0">=</span><span class="nu0">100</span><span class="br0">&#41;</span>
    pub_date <span class="sy0">=</span> models.<span class="me1">DateField</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    publish_on <span class="sy0">=</span> models.<span class="me1">ForeignKey</span><span class="br0">&#40;</span>Site<span class="br0">&#41;</span>
    objects <span class="sy0">=</span> models.<span class="me1">Manager</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    on_site <span class="sy0">=</span> CurrentSiteManager<span class="br0">&#40;</span><span class="st0">'publish_on'</span><span class="br0">&#41;</span></pre>
</div>

<p>Si intentas usar <code>CurrentSiteManager</code> y pasarle un nombre de campo que no
existe, Django lanzará un <code>ValueError</code>.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Probablemente querrás tener un <code>Manager</code> normal (no específico al sitio)
en tu modelo, incluso si usas <code>CurrentSiteManager</code>. Como se explica en el
Apéndice B, si defines un <em>manager</em> manualmente, Django no creará
automáticamente el <em>manager</em> <code>objects = models.Manager()</code>.</p>

<p>Además, algunas partes de Django — el sitio de administración y las vistas
genéricas — usan el <em>manager</em> que haya sido definido <em>primero</em> en el
modelo. Así que si quieres que el sitio de administración tenga acceso a
todos los objetos (no sólo a los específicos al sitio actual), pon un
<code>objects = models.Manager()</code> en tu modelo, antes de definir
<code>CurrentSiteManager</code>.</p></div>

<h3 id="el_uso_que_hace_django_del_framework_sites">14.2.6. El uso que hace Django del <em>framework</em> Sites</h3>

<p>Si bien no es necesario que uses el <em>framework</em> <em>sites</em>, es extremadamente
recomendado, porque Django toma ventaja de ello en algunos lugares. Incluso si
tu instalación de Django está alimentando a un solo sitio, deberías tomarte unos
segundos para crear el objeto <em>site</em> con tu <code>domain</code> y <code>name</code>, y apuntar su
ID en tu opción de configuración <code>SITE_ID</code>.</p>

<p>Este es el uso que hace Django del <em>framework</em> <em>sites</em>:</p>

<ul>
<li>En el <em>framework</em> <em>redirects</em> (consulta la sección <em>"Redirects"</em> más
adelante), cada objeto <em>redirect</em> está asociado con un sitio en
particular. Cuando Django busca un <em>redirect</em>, toma en cuenta el
<code>SITE_ID</code> actual.</li>
<li>En el <em>framework</em> <em>comments</em>, cada comentario está asociado con un sitio
en particular. Cuando un comentario es posteado, su <code>site</code> es asignado
al <code>SITE_ID</code> actual, y cuando los comentarios son listados con la
etiqueta de plantillas apropiada, sólo los comentarios del sitio actual
son mostrados.</li>
<li>En el <em>framework</em> <em>flatpages</em> (consulta la sección <em>"Flatpages"</em> más
adelante), cada página es asociada con un sitio en particular. Cuando una
página es creada, tú especificas su <code>site</code>, y el <em>middleware</em> de
<em>flatpage</em> chequea el <code>SITE_ID</code> actual cuando se traen páginas para ser
mostradas.</li>
<li>En el <em>framework</em> <em>syndication</em> (consulta el Capítulo 11), las plantillas
para <code>title</code> y <code>description</code> tienen acceso automático a la variable
<code>{&#123; site &#125;}</code>, que es el objeto <code>Site</code> que representa al sitio actual.
Además, la conexión para proporcionar las URLs de los elementos usan el
<code>domain</code> dede el objeto <code>Site</code> actual si no especificas un <em>fully
qualified domain</em>.</li>
<li>En el <em>framework</em> <em>authentication</em> (consulta el Capítulo 12), la vista
<code>django.contrib.auth.views.login</code> le pasa el nombre del <code>Site</code> actual
a la plantilla como <code>{&#123; site_name &#125;}</code>.</li>
</ul>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_14/la_libreria_estandar_de_django.html">
                        <strong>&larr; Anterior</strong>
                        <small>14.1. La librería estándar de Django</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_14/flatpages.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>14.3. Flatpages</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Empezando</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Los principios de las páginas Web dinámicas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> El sistema de plantillas de Django</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Interactuar con una base de datos: Modelos</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El sitio de Administración Django</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Procesamiento de formularios</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Vistas avanzadas y URLconfs</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Vistas genéricas</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Extender el sistema de plantillas</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Generación de contenido no HTML</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Sesiones, usuario e inscripciones</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Cache</a>
            </li>
                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_14.html">
                    <span>Capítulo 14.</span> Otros sub-frameworks contribuidos
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/la_libreria_estandar_de_django.html">
                    <span>14.1.</span> La librería estándar de Django
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_14/sites.html">
                    <span>14.2.</span> Sites
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/flatpages.html">
                    <span>14.3.</span> Flatpages
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/redirects.html">
                    <span>14.4.</span> Redirects
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/proteccion_contra_csrf.html">
                    <span>14.5.</span> Protección contra CSRF
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/hacer_los_datos_mas_humanos.html">
                    <span>14.6.</span> Hacer los datos más humanos
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/filtros_de_marcado.html">
                    <span>14.7.</span> Filtros de marcado
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/que_sigue.html">
                    <span>14.8.</span> ¿Qué sigue?
                </a>
            </li>
                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Middleware</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Integración con Base de datos y Aplicaciones existentes</a>
            </li>
                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Extender la Interfaz de Administración de Django</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>20.</span> <a href="../capitulo_20.html"> Puesta en marcha de Django en un servidor</a>
            </li>
                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
