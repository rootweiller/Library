<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>10.4. Procesando el envío del formulario (Symfony 1.4, la guía definitiva)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_10/widgets_de_formulario.html" />
                    <link rel="next" href="../capitulo_10/validadores.html" />
                <link rel="start" href="/libro/symfony_1_4/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="10.4. Procesando el envío del formulario (Symfony 1.4, la guía definitiva)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_1_4"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_4/" itemprop="url">
                    <span itemprop="title">Symfony 1.4, la guía definitiva</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_4/capitulo_10.html" itemprop="url">
                    <span itemprop="title">Capítulo 10. Formularios</span>
                </a>
            </li>
        
            <li class="active">
                <span>10.4. Procesando el envío del formulario</span>
            </li>
        </ol>
    </div>

    <h1 id="procesando_el_envio_del_formulario" class="title">
        <span>10.4.</span> Procesando el envío del formulario
    </h1>

    

<p>Una vez que el usuario rellena un formulario y lo envía, la aplicación web del servidor debe obtener los datos y procesarlos como sea conveniente. La clase <code>sfForm</code> incluye todos los métodos necesarios para hacerlo en unas pocas líneas de código.</p>

<h3 id="procesado_simple_de_formularios">10.4.1. Procesado simple de formularios</h3>

<p>Como los widgets al final siempre generan etiquetas HTML normales, la acción puede obtener sus valores directamente como parámetros de la petición. Siguiendo el ejemplo del formulario de contacto, su acción asociada podría ser la siguiente:</p>

<div class="code php">
<pre class="php"><span class="co1">// en modules/mimodulo/actions/actions.class.php</span>
<span class="kw2">public</span> <span class="kw2">function</span> executeContacto<span class="br0">&#40;</span><span class="re0">$request</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="co1">// Definir el formulario</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span> <span class="sy0">=</span> <span class="kw2">new</span> sfForm<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInputText<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'default'</span> <span class="sy0">=&gt;</span> <span class="st_h">'<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="394056795c535c54495556175a5654">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'asunto'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormChoice<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'Asunto A'</span><span class="sy0">,</span> <span class="st_h">'Asunto B'</span><span class="sy0">,</span> <span class="st_h">'Asunto C'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="co1">// Procesar la petición</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// Procesar los datos del formulario</span>
    <span class="re0">$nombre</span> <span class="sy0">=</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'nombre'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="sy0">...</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'mimodulo/otraaccion'</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Si el método de la petición es <code>GET</code>, la acción devuelve como resultado <code>sfView::SUCCESS</code> y por tanto se muestra la plantilla <code>contactoSuccess</code> con el formulario de contacto. Si el método de la petición es <code>POST</code>, la acción se encarga de procesar los datos del formulario y después redirecciona a otra acción del mismo módulo. Para que el código anterior funcione bien, el atributo <code>action</code> de la etiqueta <code>&lt;form&gt;</code> debe ser igual a la acción que muestra el formulario. Ese es el motivo por lo que en los ejemplos anteriores el atributo <code>action</code> del formulario siempre era <code>mimodulo/contacto</code>:</p>

<div class="code php">
<pre class="php">// en modules/mimodulo/templates/contactoSuccess.php
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$form</span><span class="sy0">-&gt;</span><span class="me1">renderFormTag</span><span class="br0">&#40;</span><span class="st_h">'mimodulo/contacto'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>
...</pre>
</div>

<h3 id="procesado_de_formularios_con_validacion">10.4.2. Procesado de formularios con validación</h3>

<p>Las aplicaciones reales procesan los formularios de forma mucho más avanzada, no simplemente obteniendo los datos enviados por el usuario. Normalmente, el controlador de la aplicación se encarga de:</p>

<ol>
<li>Comprobar que los datos cumplen una serie de reglas de validación (algunos campos son obligatorios, el email debe tener un formato adecuado, etc.)</li>
<li>Opcionalmente se pueden transformar los datos para facilitar su procesamiento (eliminar espacios en blanco sobrantes, convertir fechas al formato PHP , etc.)</li>
<li>Si los datos no son válidos, se vuelve a mostrar el formulario con los mensajes de error apropiados.</li>
<li>Si los datos son correctos, hacer algo con ellos y redirigir al usuario a otra acción.</li>
</ol>

<p>Symfony incluye un mecanismo de validación automática que comprueba si los datos enviados por el usuario cumplen una serie de reglas predefinidas. Para ello, primero se define una serie de validadores para cada campo. A continuación, cuando el usuario envía el formulario, sus datos se unen al objeto del formulario, mediante un proceso llamado <em>bind</em>. Por último, se pide al formulario que compruebe si los datos son válidos. El siguiente ejemplo muestra cómo validar que el valor del widget <code>email</code> es realmente una dirección de email y que el campo <code>mensaje</code> tiene una longitud de al menos cuatro caracteres:</p>

<div class="code php">
<pre class="php"><span class="co1">// en modules/mimodulo/actions/actions.class.php</span>
<span class="kw2">public</span> <span class="kw2">function</span> executeContacto<span class="br0">&#40;</span><span class="re0">$request</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="co1">// Definir el formulario</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span> <span class="sy0">=</span> <span class="kw2">new</span> sfForm<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInputText<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'default'</span> <span class="sy0">=&gt;</span> <span class="st_h">'<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="5c25331c393639312c3033723f3331">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'asunto'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormChoice<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'Asunto A'</span><span class="sy0">,</span> <span class="st_h">'Asunto B'</span><span class="sy0">,</span> <span class="st_h">'Asunto C'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setValidators</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'asunto'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="co1">// Procesar la petición</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">bind</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">isValid</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
      <span class="co1">// Procesar los datos del formulario</span>
&nbsp;
      <span class="sy0">...</span>
&nbsp;
      <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'mimodulo/otraaccion'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>El método <code>setValidators()</code> utiliza una sintaxis similar a la de <code>setWidgets()</code>. Las clases <code>sfValidatorEmail</code> y <code>sfValidatorString</code> son solamente dos de los muchos validadores que incluye Symfony y que se explican más adelante. La clase <code>sfForm</code> también proporciona el método <code>setValidator()</code> para definir los validadores uno a uno.</p>

<p>El método <code>sfForm::bind()</code> se emplea para introducir los datos enviados por el usuario dentro del objeto del formulario. Como se trata de unir los datos y el formulario, este proceso se denomina <em>bind</em>, que significa "unir" en inglés.</p>

<p>A continuación, el método <code>isValid()</code> comprueba si los datos cumplen las reglas de todos los validadores. Si este es el caso, el método <code>isValid()</code> devuelve <code>true</code> y la acción ya puede continuar con el procesado de los datos. Si el formulario no es válido, la acción termina su ejecución y devuelve el valor <code>sfView::SUCCESS</code> que hace que se vuelva a mostrar el formulario. Sin embargo, ahora ya no se muestra el formulario original, sino que se rellenan todos los campos con los datos introducidos por el usuario y se añaden los mensajes de error en aquellos campos que no cumplen las reglas de validación.</p>

<div class="figure" id="figure_10_2">
    <img src="/img/symfony_1_4/02_01.png" alt="Invalid form" />

    <p class="caption"><strong>Figura 10.2</strong> Invalid form</p>
</div>


<div class="admonition note"><p><strong class="title">Nota</strong> El proceso de validación no se detiene al encontrar el primer error. El método <code>isValid()</code> procesa todos los datos enviados y comprueba todos los validadores de cada campo, para que el usuario no se encuentre con errores de validación cada vez que envía el formulario.</p></div>

<h3 id="utilizando_datos_de_formulario_limpios">10.4.3. Utilizando datos de formulario limpios</h3>

<p>El código de los ejemplos anteriores no especifica qué datos de la petición se unen al formulario. El problema es que la petición contiene muchos más datos que los del formulario. Entre otros, contiene las cabeceras, las cookies y los datos pasados como parámetros <code>GET</code>. Esta información ajena al formulario podría producir problemas en la fase <em>bind</em> del formulario. Por tanto, una buena práctica consiste en pasar al método <code>bind()</code> solamente los datos del formulario.</p>

<p>Afortunadamente, Symfony permite cambiar el nombre de todos los campos del formulario para que sigan la sintaxis de los arrays. Define el formato del nombre de los atributos con el método <code>setNameFormat()</code> dentro de la acción donde se crea el formulario:</p>

<div class="code php">
<pre class="php"><span class="co1">// en modules/mimodulo/actions/actions.class.php</span>
<span class="co1">// Definir el formulario</span>
<span class="sy0">...</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setNameFormat</span><span class="br0">&#40;</span><span class="st_h">'contacto[%s]'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>De esta forma, todos los campos del formulario generado tienen un nombre <code>contacto[nombre-del-widget]</code> en vez de simplemente <code>nombre-del-widget</code>:</p>

<div class="code html5">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;contacto_nombre&quot;</span>&gt;</span>Nombre<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;contacto[nombre]&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;contacto_nombre&quot;</span> <span class="sy0">/</span>&gt;</span>
...
<span class="sc2">&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;contacto_email&quot;</span>&gt;</span>Email<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;contacto[email]&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;contacto_email&quot;</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="1d64725d787778706d7172337e7270">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>&quot;</span> <span class="sy0">/</span>&gt;</span>
...
<span class="sc2">&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;contacto_asunto&quot;</span>&gt;</span>Asunto<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">select</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;contacto[asunto]&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;contacto_asunto&quot;</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">option</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;0&quot;</span>&gt;</span>Asunto A<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">option</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">option</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;1&quot;</span>&gt;</span>Asunto B<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">option</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">option</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;2&quot;</span>&gt;</span>Asunto C<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">option</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">select</span>&gt;</span>
...
<span class="sc2">&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;contacto_mensaje&quot;</span>&gt;</span>Mensaje<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">textarea</span> <span class="kw3">rows</span><span class="sy0">=</span><span class="st0">&quot;4&quot;</span> <span class="kw3">cols</span><span class="sy0">=</span><span class="st0">&quot;30&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;contacto[mensaje]&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;contacto_mensaje&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">textarea</span>&gt;</span></pre>
</div>

<p>Ahora la acción puede obtener todos los datos del formulario mediante el parámetro <code>contacto</code> de la petición. Esta variable será un array con todos los datos introducidos por el usuario:</p>

<div class="code php">
<pre class="php"><span class="co1">// en modules/mimodulo/actions/actions.class.php</span>
<span class="co1">// Procesar la petición</span>
<span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">bind</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'contacto'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">isValid</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// Procesar los datos del formulario</span>
    <span class="re0">$contacto</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">getValues</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$nombre</span> <span class="sy0">=</span> <span class="re0">$contacto</span><span class="br0">&#91;</span><span class="st_h">'nombre'</span><span class="br0">&#93;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// Si quieres obtener un valor específico</span>
    <span class="re0">$nombre</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">getValue</span><span class="br0">&#40;</span><span class="st_h">'nombre'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="sy0">...</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'mimodulo/otraaccion'</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Cuando método <code>bind()</code> recibe un array de parámetros, Symfony aplica automáticamente un mecanismo de seguridad que impide al usuario enviar más datos de los que contiene el formulario original. Por tanto, el proceso de validación produce un error si el array <code>contacto</code> contiene información de campos que no se encuentran en el formulario original.</p>

<p>Otra diferencia importante en el código del último ejemplo es que la acción no obtiene los datos directamente de la petición, sino que emplea el objeto del formulario (<code>$form-&gt;getValues()</code>). Los validadores filtran y <em>limpian</em> los datos que se les pasan, por lo que siempre es mejor confiar en los datos del formulario (mediante <code>getValues()</code> o <code>getValue()</code>) en vez de confiar en los datos de la petición. Además, si el widget es complejo (como por ejemplo los widgets de fechas), los datos devueltos por <code>getValues()</code> ya están correctamente formateados:</p>

<div class="code php">
<pre class="php"><span class="co1">// Las fechas son widgets complejos formados por varios campos</span>
<span class="sy0">&lt;</span>label <span class="kw1">for</span><span class="sy0">=</span><span class="st0">&quot;contacto_fecha&quot;</span><span class="sy0">&gt;</span>Fecha de nacimiento<span class="sy0">&lt;/</span>label<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>select id<span class="sy0">=</span><span class="st0">&quot;contacto_fecha_month&quot;</span> name<span class="sy0">=</span><span class="st0">&quot;contacto[fecha][month]&quot;</span><span class="sy0">&gt;...&lt;/</span>select<span class="sy0">&gt;</span> <span class="sy0">/</span>
<span class="sy0">&lt;</span>select id<span class="sy0">=</span><span class="st0">&quot;contacto_fecha_day&quot;</span> name<span class="sy0">=</span><span class="st0">&quot;contacto[fecha][day]&quot;</span><span class="sy0">&gt;...&lt;/</span>select<span class="sy0">&gt;</span> <span class="sy0">/</span>
<span class="sy0">&lt;</span>select id<span class="sy0">=</span><span class="st0">&quot;contacto_fecha_year&quot;</span> name<span class="sy0">=</span><span class="st0">&quot;contacto[fecha][year]&quot;</span><span class="sy0">&gt;...&lt;/</span>select<span class="sy0">&gt;</span>
&nbsp;
<span class="co1">// Para obtener la fecha, se deben procesar los campos en la acción</span>
<span class="re0">$contacto</span> <span class="sy0">=</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'contacto'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$mes</span> <span class="sy0">=</span> <span class="re0">$contacto</span><span class="br0">&#91;</span><span class="st_h">'fecha'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'month'</span><span class="br0">&#93;</span><span class="sy0">;</span>
<span class="re0">$dia</span> <span class="sy0">=</span> <span class="re0">$contacto</span><span class="br0">&#91;</span><span class="st_h">'fecha'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'day'</span><span class="br0">&#93;</span><span class="sy0">;</span>
<span class="re0">$ano</span> <span class="sy0">=</span> <span class="re0">$contacto</span><span class="br0">&#91;</span><span class="st_h">'fecha'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'year'</span><span class="br0">&#93;</span><span class="sy0">;</span>
<span class="re0">$fechaNacimiento</span> <span class="sy0">=</span> <span class="kw3">mktime</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="re0">$mes</span><span class="sy0">,</span> <span class="re0">$dia</span><span class="sy0">,</span> <span class="re0">$ano</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// Si utilizas el método getValues(), obtienes la fecha directamente</span>
<span class="re0">$contacto</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">getValues</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$fechaNacimiento</span> <span class="sy0">=</span> <span class="re0">$contacto</span><span class="br0">&#91;</span><span class="st_h">'fecha'</span><span class="br0">&#93;</span><span class="sy0">;</span></pre>
</div>

<p>Te aconsejamos que siempre utilices esta sintaxis de arrays para nombrar a los campos de tu formulario (mediante <code>setNameFormat()</code>) y que siempre obtengas los datos <em>limpios</em> a través del formulario (mediante <code>getValues()</code>).</p>

<h3 id="modificando_los_mensajes_de_error">10.4.4. Modificando los mensajes de error</h3>

<p>Una de las imágenes anteriores mostraba el formulario con algunos mensajes de error. ¿De dónde han salido estos errores? Como se explicó anteriormente, cada widget está compuesto de cuatro elementos y el mensaje de error es uno de ellos. De hecho, el formateador de tabla que utiliza Symfony por defecto muestra cada campo de la siguiente forma:</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$field</span><span class="sy0">-&gt;</span><span class="me1">hasError</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">:</span> <span class="sy1">?&gt;</span>
&lt;tr&gt;
  &lt;td colspan=&quot;2&quot;&gt;
    <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$field</span><span class="sy0">-&gt;</span><span class="me1">renderError</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>           // Lista de errores
  &lt;/td&gt;
&lt;/tr&gt;
<span class="kw2">&lt;?php</span> <span class="kw1">endif</span><span class="sy0">;</span> <span class="sy1">?&gt;</span>
&lt;tr&gt;
  &lt;th&gt;<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$field</span><span class="sy0">-&gt;</span><span class="me1">renderLabel</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&lt;/th&gt;    // Título
  &lt;td&gt;
    <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$field</span><span class="sy0">-&gt;</span><span class="me1">render</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>                // Widget
    <span class="kw2">&lt;?php</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$field</span><span class="sy0">-&gt;</span><span class="me1">hasHelp</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">:</span> <span class="sy1">?&gt;</span>
    &lt;br /&gt;<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$field</span><span class="sy0">-&gt;</span><span class="me1">renderHelp</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>      // Mensaje de ayuda
    <span class="kw2">&lt;?php</span> <span class="kw1">endif</span><span class="sy0">;</span> <span class="sy1">?&gt;</span>
  &lt;/td&gt;
&lt;/tr&gt;</pre>
</div>

<p>Haciendo uso de los métodos anteriores puedes modificar el aspecto y la posición de los mensajes de error de cada campo. También puedes mostrar un mensaje de error global en el formulario avisando al usuario de que al menos uno de sus campos no es válido:</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$form</span><span class="sy0">-&gt;</span><span class="me1">hasErrors</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">:</span> <span class="sy1">?&gt;</span>
  El formulario contiene algunos errores que debes solucionar.
<span class="kw2">&lt;?php</span> <span class="kw1">endif</span><span class="sy0">;</span> <span class="sy1">?&gt;</span></pre>
</div>

<h3 id="modificando_los_validadores">10.4.5. Modificando los validadores</h3>

<p>Todos los campos del formulario deben tener asociado un validador y además, por defecto todos los campos son obligatorios. Si un campo del formulario es opcional, utiliza la opción <code>required</code> con un valor <code>false</code> en su validador. El siguiente ejemplo muestra cómo hacer obligatorio el campo <code>name</code> y opcional el campo <code>email</code>:</p>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setValidators</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'required'</span> <span class="sy0">=&gt;</span> <span class="kw4">false</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'asunto'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Los campos también pueden tener más de un validador. El campo <code>email</code> podría por ejemplo validarse mediante <code>sfValidatorEmail</code> para comprobar que su formato es adecuado y mediante <code>fValidatorString</code> para asegurar que su longitud es de al menos cuatro caracteres. Para combinar dos validadores, se utiliza el validador <code>sfValidatorAnd</code> y se le pasan como argumentos tanto <code>sfValidatorEmail</code> como <code>sfValidatorString</code>:</p>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setValidators</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorAnd<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'required'</span> <span class="sy0">=&gt;</span> <span class="kw4">false</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'asunto'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">4</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Si se cumplen las condiciones de los dos validadores, el campo <code>email</code> se considera válido. De la misma forma, existe un método llamado <code>sfValidatorOr</code> que permite combinar varios validadores. Si se cumple al menos uno de esos validadores, el campo se declara válido.</p>

<p>Cada validador que no se cumple genera un mensaje de error para el campo. Aunque estos mensajes están escritos en inglés, Symfony utiliza los <em>helpers</em> de internacionalización al mostrarlos por pantalla, por lo que puedes traducirlos fácilmente al idioma que quieras. Otra forma de traducir los mensajes de error es utilizar el tercer parámetro opcional de los validadores, que permite modificar sus mensajes de error. Todos los validadores cuentan con al menos dos mensajes de error: el mensaje <code>required</code> y el mensaje <code>invalid</code>. Algunos validadores definen más mensajes de error, que también se pueden redefinir mediante este tercer parámetro:</p>

<div class="code php">
<pre class="php"><span class="co1">// en modules/mimodulo/actions/actions.class.php</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setValidators</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'required'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'Introduce por favor un email'</span><span class="sy0">,</span>
    <span class="st_h">'invalid'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'Escribe por favor una dirección de email válida (por ej. <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="85fceac5e0efe0e8f5e9eaabe6eae8">[email&#160;protected]</a><script cf-hash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>)'</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'asunto'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">4</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'required'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'Escribe por favor un mensaje'</span><span class="sy0">,</span>
    <span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="st_h">'Escribe por favor un mensaje más largo (escribe al menos cuatro caracteres)'</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Los mensajes de error propios también se muestran por pantalla mediante los <em>helpers</em> de internacionalización, por lo que se pueden traducir fácilmente a cualquier idioma (el Capítulo 13 lo explica en detalle).</p>

<h3 id="aplicando_un_mismo_validador_a_varios_campos">10.4.6. Aplicando un mismo validador a varios campos</h3>

<p>Con todo lo explicado anteriormente no es posible validar que varios campos diferentes cumplen una misma condición. Este caso es muy común por ejemplo en los formularios de registro de usuario, que suelen contender dos campos diferentes de contraseña cuyos valores deben coincidir. Cada contraseña es un campo independiente, pero su validación sólo es posible de forma combinada.</p>

<p>En estos casos se utiliza un validador múltiple en el método <code>setPostValidator()</code>, que es un validador que se ejecuta después de todos los demás validadores y que recibe un array con todos los valores <em>limpios</em>. Si quieres validar los datos originales, debes utilizar el método <code>setPreValidator()</code>.</p>

<p>Un formulario de registro típico tendría el siguiente aspecto:</p>

<div class="code php">
<pre class="php"><span class="co1">// en modules/mimodulo/actions/actions.class.php</span>
<span class="co1">// Definir el formulario</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span> <span class="sy0">=</span> <span class="kw2">new</span> sfForm<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'login'</span>     <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInputText<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'password1'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInputText<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'password2'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInputText<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setValidators</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'login'</span>     <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">// login es obligatorio</span>
  <span class="st_h">'password1'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">// password1 es obligatorio</span>
  <span class="st_h">'password2'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">// password2 es obligatorio</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">form</span><span class="sy0">-&gt;</span><span class="me1">setPostValidators</span><span class="br0">&#40;</span><span class="kw2">new</span> sfValidatorSchemaCompare<span class="br0">&#40;</span><span class="st_h">'password1'</span><span class="sy0">,</span> <span class="st_h">'=='</span><span class="sy0">,</span> <span class="st_h">'password2'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>El validador <code>sfValidatorSchemaCompare</code> es un tipo especial de validador múltiple que recibe todos los valores <em>limpios</em> y puede elegir dos de ellos para compararlos. Si quieres definir más de un post-validador, puedes hacer uso de los métodos <code>sfValidatorAnd</code> y <code>sfValidatorOr</code>.</p>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_10/widgets_de_formulario.html">
                        <strong>&larr; Anterior</strong>
                        <small>10.3. Widgets de formulario</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_10/validadores.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>10.5. Validadores</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Symfony</a>
            </li>
                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Explorando el interior de Symfony</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Ejecutar aplicaciones Symfony</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Introducción a la creación de páginas</a>
            </li>
                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Configurar Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El Controlador</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> La Vista</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> El modelo (Doctrine)</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Enlaces y sistema de enrutamiento</a>
            </li>
                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_10.html">
                    <span>Capítulo 10.</span> Formularios
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/mostrando_un_formulario.html">
                    <span>10.1.</span> Mostrando un formulario
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/modificando_el_aspecto_de_los_formularios.html">
                    <span>10.2.</span> Modificando el aspecto de los formularios
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/widgets_de_formulario.html">
                    <span>10.3.</span> Widgets de formulario
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_10/procesando_el_envio_del_formulario.html">
                    <span>10.4.</span> Procesando el envío del formulario
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/validadores.html">
                    <span>10.5.</span> Validadores
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/usos_alternativos_de_los_formularios.html">
                    <span>10.6.</span> Usos alternativos de los formularios
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/widget_y_validadores_propios.html">
                    <span>10.7.</span> Widget y validadores propios
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/formularios_basados_en_un_modelo.html">
                    <span>10.8.</span> Formularios basados en un modelo
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_10/resumen.html">
                    <span>10.9.</span> Resumen
                </a>
            </li>
                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Emails</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Uso de la cache</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Internacionalización y localización</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Generador de la parte de administración</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Pruebas unitarias y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Herramientas para la administración de aplicaciones</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Personalizar Symfony</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Rendimiento</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Configuración avanzada</a>
            </li>
                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
