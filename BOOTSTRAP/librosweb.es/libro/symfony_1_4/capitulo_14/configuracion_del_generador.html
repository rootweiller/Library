<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>14.3. Configuración del generador (Symfony 1.4, la guía definitiva)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_14/creando_la_parte_de_administracion_de_las_aplicaciones.html" />
                    <link rel="next" href="../capitulo_14/modificando_el_aspecto_de_los_modulos_generados.html" />
                <link rel="start" href="/libro/symfony_1_4/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="14.3. Configuración del generador (Symfony 1.4, la guía definitiva)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_1_4"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_4/" itemprop="url">
                    <span itemprop="title">Symfony 1.4, la guía definitiva</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_4/capitulo_14.html" itemprop="url">
                    <span itemprop="title">Capítulo 14. Generador de la parte de administración</span>
                </a>
            </li>
        
            <li class="active">
                <span>14.3. Configuración del generador</span>
            </li>
        </ol>
    </div>

    <h1 id="configuracion_del_generador" class="title">
        <span>14.3.</span> Configuración del generador
    </h1>

    

<p>El archivo de configuración del generador es muy poderoso, ya que permite modificar la administración generada automáticamente de muchas formas. Lo único malo de que tenga tantas posibilidades es que la descripción completa de su sintaxis es muy larga de leer y cuesta aprenderla, por lo que este capítulo es uno de los más largos del libro.</p>

<p>Los ejemplos de esta sección modifican el módulo de administración <code>articulo</code> y también el módulo <code>comentario</code> basado en la definición de la clase <code>BlogComentario</code>. Antes de modificar el módulo <code>comentario</code>, es necesario crear su ruta y después crear el módulo mediante la tarea <code>propel:generate-admin</code>:</p>

<div class="code cli">
<pre class="cli">$ php symfony propel:generate-admin backend BlogComentario --module=comentario</pre>
</div>

<div class="figure" id="figure_14_4">
    <img src="/img/symfony_1_4/f1407.png" alt="Chuleta del generador de administraciones" />

    <p class="caption"><strong>Figura 14.4</strong> Chuleta del generador de administraciones</p>
</div>


<h3 id="campos">14.3.1. Campos</h3>

<p>Por defecto, las columnas de la vista <code>list</code> son las columnas definidas en el archivo <code>schema.yml</code>. Los campos de las vistas <code>new</code> y <code>edit</code> son los que define el formulario asociado con el modelo (<code>BlogArticuloForm</code>). El archivo <code>generator.yml</code> permite seleccionar los campos que se muestran y los que se ocultan. También permite añadir campos propios, incluso aunque no existan en el modelo de objetos.</p>

<h3 id="opciones_de_los_campos">14.3.2. Opciones de los campos</h3>

<p>El generador de la administración crea un <code>field</code> para cada columna del archivo <code>schema.yml</code>. Bajo la clave <code>fields</code> se puede definir la forma en la que se muestra cada campo, su formato, etc. El ejemplo que se muestra en el listado 14-5 define el título y atributo <code>class</code> del campo <code>titulo</code> y el título y mensaje de ayuda del campo <code>contenido</code>. Las siguientes secciones describen en detalle cómo funciona cada opción.</p>

<p><strong>Listado 14-5 - Establecer parámetros a las columnas</strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  fields</span>:<span class="co4">
    titulo</span>:<span class="co3">
      label</span><span class="sy2">: </span>Título del artículo<span class="co3">
      attributes</span><span class="sy2">: </span><span class="br0">&#123;</span> class<span class="sy2">: </span>mi_clase_css <span class="br0">&#125;</span><span class="co3">
    contenido</span><span class="sy2">: </span><span class="br0">&#123;</span> label<span class="sy2">: </span>Cuerpo del artículo, help<span class="sy2">: </span>Rellena el cuerpo del artículo <span class="br0">&#125;</span></pre>
</div>

<p>Además de las opciones globales para todas las vistas, se pueden redefinir las opciones de la clave <code>fields</code> para cada una de las vistas (<code>list</code>, <code>filter</code>, <code>form</code>, <code>new</code> y <code>edit</code>) tal y como muestra el listado 14-6.</p>

<p><strong>Listado 14-6 - Redefiniendo las opciones globales en cada vista</strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  fields</span>:<span class="co3">
    titulo</span><span class="sy2">: </span>   <span class="br0">&#123;</span> label<span class="sy2">: </span>Título del artículo <span class="br0">&#125;</span><span class="co3">
    contenido</span><span class="sy2">: </span><span class="br0">&#123;</span> label<span class="sy2">: </span>Cuerpo <span class="br0">&#125;</span>
<span class="co4">
  list</span>:<span class="co4">
    fields</span>:<span class="co3">
      titulo</span><span class="sy2">: </span> <span class="br0">&#123;</span> label<span class="sy2">: </span>Título <span class="br0">&#125;</span>
<span class="co4">
  form</span>:<span class="co4">
    fields</span>:<span class="co3">
      contenido</span><span class="sy2">: </span><span class="br0">&#123;</span> label<span class="sy2">: </span>Cuerpo del artículo <span class="br0">&#125;</span></pre>
</div>

<p>Este ejemplo se puede tomar como una regla general: cualquier opción establecida para todo el módulo mediante la clave <code>fields</code>, se puede redefinir en la configuración de cualquier vista. A continuación se indican las normas que se siguen al redefinir las opciones:</p>

<ul>
<li><code>new</code> y <code>edit</code> heredan de <code>form</code>, que a su vez hereda de <code>fields</code></li>
<li><code>list</code> hereda de <code>fields</code></li>
<li><code>filter</code> hereda de <code>fields</code></li>
</ul>

<h4 id="mostrando_nuevos_campos">14.3.2.1. Mostrando nuevos campos</h4>

<p>La sección <code>fields</code> permite definir para cada vista los campos que se muestran, los que se ocultan, la forma en la que se agrupan y las opciones para ordenarlos. Para ello se emplea la clave <code>display</code>. El código del listado 14-7 reordena los campos del módulo <code>comentario</code>:</p>

<p><strong>Listado 14-7 - Seleccionando los campos que se muestran, en <code>modules/comentario/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  fields</span>:<span class="co3">
    articulo_id</span><span class="sy2">: </span><span class="br0">&#123;</span> label<span class="sy2">: </span>Artículo <span class="br0">&#125;</span><span class="co3">
    created_at</span><span class="sy2">: </span> <span class="br0">&#123;</span> label<span class="sy2">: </span>Fecha de publicación <span class="br0">&#125;</span><span class="co3">
    contenido</span><span class="sy2">: </span>  <span class="br0">&#123;</span> label<span class="sy2">: </span>Cuerpo <span class="br0">&#125;</span>
<span class="co4">
  list</span>:<span class="co3">
    display</span><span class="sy2">: </span>    <span class="br0">&#91;</span>id, blog_articulo_id, contenido<span class="br0">&#93;</span>
<span class="co4">
  form</span>:<span class="co4">
    display</span>:<span class="co3">
      NONE</span><span class="sy2">: </span>     <span class="br0">&#91;</span>blog_articulo_id<span class="br0">&#93;</span><span class="co3">
      Editable</span><span class="sy2">: </span> <span class="br0">&#91;</span>autor, contenido, created_at<span class="br0">&#93;</span></pre>
</div>

<p>Con esta configuración, la vista <code>list</code> muestra tres columnas, como se ve en la figura 14-5 y el formulario de las vistas <code>new</code> y <code>edit</code> muestran cuatro campos agrupados en dos secciones, como se ve en la figura 14-6.</p>

<div class="figure" id="figure_14_5">
    <img src="/img/symfony_1_4/f1408.png" alt="Columnas seleccionadas para la vista &quot;list&quot; del módulo &quot;comentario&quot;" />

    <p class="caption"><strong>Figura 14.5</strong> Columnas seleccionadas para la vista &quot;list&quot; del módulo &quot;comentario&quot;</p>
</div>


<div class="figure" id="figure_14_6">
    <img src="/img/symfony_1_4/f1409.png" alt="Agrupando campos en la vista &quot;edit&quot; del módulo &quot;comentario&quot;" />

    <p class="caption"><strong>Figura 14.6</strong> Agrupando campos en la vista &quot;edit&quot; del módulo &quot;comentario&quot;</p>
</div>


<p>De esta forma, la opción <code>display</code> tiene dos propósitos:</p>

<ul>
<li>En la vista <code>list</code>: crea un array simple con el nombre de los campos para seleccionar las columnas que se muestran y el orden en el que lo hacen.</li>
<li>En las vistas <code>form</code>, <code>new</code> y <code>edit</code>: crea un array asociativo cuya clave es el nombre del grupo o <code>NONE</code> para definir un grupo sin nombre. Las columnas también se indican mediante un array simple con los nombres de los campos en el mismo orden en el que se van a mostrar. Si no se incluyen todos los campos obligatorios referenciados en la clase del formulario, se producen errores de validación (ver Capítulo 10).</li>
</ul>

<h4 id="campos_propios">14.3.2.2. Campos propios</h4>

<p>Los campos que se configuran en el archivo <code>generator.yml</code> no tienen que corresponderse obligatoriamente con alguna de las columnas del esquema de datos. Si la clase relacionada incluye un método <em>getter</em> para el campo propio, este se puede utilizar como un campo más de la vista <code>list</code>; si además del <em>getter</em> existe un método <em>setter</em>, el campo también se puede utilizar en la vista <code>edit</code>. En el listado 14-8 se muestra un ejemplo que extiende el modelo de <code>BlogArticulo</code> para añadir el método <code>getNumeroComentarios()</code> que obtiene el número de comentarios de un artículo.</p>

<p><strong>Listado 14-8 - Añadiendo un <em>getter</em> propio en el modelo, en <code>lib/model/BlogArticulo.php</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> getNumeroComentarios<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw1">return</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">countBlogComentarios</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Una vez definido este <em>getter</em>, el campo <code>numero_comentarios</code> está disponible como campo del módulo generado (el <em>getter</em> utiliza como nombre la habitual transformación <em>camelCase</em> del nombre del campo) como se muestra en el listado 14-9.</p>

<p><strong>Listado 14-9 - Los <em>getters</em> propios permiten añadir más columnas a los módulos de administración, en <code>backend/modules/articulo/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    display</span><span class="sy2">: </span><span class="br0">&#91;</span>titulo, blog_autor, blog_categoria, numero_comentarios<span class="br0">&#93;</span></pre>
</div>

<p>La vista <code>list</code> resultante se muestra en la figura 14-7</p>

<div class="figure" id="figure_14_7">
    <img src="/img/symfony_1_4/f1410.png" alt="Campo propio en la vista &quot;list&quot; del módulo &quot;articulo&quot;" />

    <p class="caption"><strong>Figura 14.7</strong> Campo propio en la vista &quot;list&quot; del módulo &quot;articulo&quot;</p>
</div>


<h4 id="campos_parciales">14.3.2.3. Campos parciales</h4>

<p>El código del modelo debe ser independiente de su presentación. De hecho, si el método de un campo propio genera código HTML, este código se muestra pero no se interpreta, ya que Symfony le aplica por defecto el mecanismo de escape. Una buena práctica consiste en generar el código HTML del campo propio mediante un elemento parcial. Afortunadamente, el generador de la administración permite utilizar elementos parciales si la declaración del nombre del campo contiene un guión bajo como primer carácter. De esta forma, el archivo <code>generator.yml</code> del listado 14-9 debería modificarse para ser como el del listado 14-12.</p>

<p><strong>Listado 14-12 - Se pueden utilizar elementos parciales como campos, mediante el uso del prefijo <code>_</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    display</span><span class="sy2">: </span><span class="br0">&#91;</span>titulo, blog_autor, blog_categoria, _numero_comentarios<span class="br0">&#93;</span></pre>
</div>

<p>Para que funcione la configuración anterior, es necesario crear un elemento parcial llamado <code>_numero_comentarios.php</code> en el directorio <code>modules/comentario/templates/</code>, tal y como muestra el listado 14-13.</p>

<p><strong>Listado 14-3 - Elemento parcial para la vista <code>list</code> del ejemplo, en <code>modules/comentario/templates/_numero_comentarios.php</code></strong></p>

<div class="code php">
<pre class="php">&lt;strong&gt;<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$BlogArticle</span><span class="sy0">-&gt;</span><span class="me1">getNumeroComentarios</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&lt;/strong&gt;</pre>
</div>

<p>La plantilla de un elemento parcial tiene acceso al objeto actual mediante una variable que se llama igual que la clase (<code>$BlogArticle</code> en este ejemplo).</p>

<div class="figure" id="figure_14_8">
    <img src="/img/symfony_1_4/f1408.png" alt="Elemento parcial en la vista &quot;list&quot; del módulo &quot;articulo&quot;" />

    <p class="caption"><strong>Figura 14.8</strong> Elemento parcial en la vista &quot;list&quot; del módulo &quot;articulo&quot;</p>
</div>


<p>Si quieres definir los parámetros de un elemento parcial, utiliza la misma sintaxis que para los campos normales. Indica los parámetros bajo la clave <code>field</code> y <strong>no</strong> incluyas el guión bajo (<code>_</code>) delante del nombre del campo. El listado 14-14 muestra un ejemplo.</p>

<p><strong>Listado 14-14 - Las propiedades de un elemento parcial se pueden definir bajo la clave <code>fields</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  fields</span>:<span class="co3">
    numero_comentarios</span><span class="sy2">: </span><span class="br0">&#123;</span> label<span class="sy2">: </span>Número de comentarios <span class="br0">&#125;</span></pre>
</div>

<p>Si el código del elemento parcial crece demasiado, es recomendable sustituirlo por un componente. Para definir un campo basado en un componente, solamente es necesario reemplazar el prefijo <code>_</code> por el prefijo <code>~</code>, como muestra el listado 14-17.</p>

<p><strong>Listado 14-17 - Se pueden utilizar componentes en los campos, mediante el prefijo <code>~</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    display</span><span class="sy2">: </span><span class="br0">&#91;</span>titulo, blog_autor, blog_categoria, ~numero_comentarios<span class="br0">&#93;</span></pre>
</div>

<p>En la plantilla que se genera, la configuración anterior resulta en una llamada al componente <code>numeroComentarios</code> del módulo actual.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Los campos propios y los campos creados con elementos parciales se pueden utilizar en las vistas <code>list</code>, <code>new</code>, <code>edit</code> y <code>filter</code>. Si se utiliza el mismo elemento parcial en varias vistas, la variable <code>$type</code> almacena el contexto (<code>list</code>, <code>new</code>, <code>edit</code> o <code>filter</code>).</p></div>

<h3 id="modificando_la_vista">14.3.3. Modificando la vista</h3>

<p>Si se quiere modificar el aspecto visual de las vistas <code>new</code>, <code>edit</code> y <code>list</code>, no se deben modificar las plantillas. Como se generan automáticamente, no es una buena idea modificarlas. En su lugar, se debe utilizar el archivo de configuración <code>generator.yml</code>, porque puede hacer prácticamente cualquier cosa que se necesite sin tener que sacrificar la modularidad de la aplicación.</p>

<h4 id="modificando_el_titulo_de_la_vista">14.3.3.1. Modificando el título de la vista</h4>

<p>Además de una serie de campos propios, las páginas <code>list</code>, <code>new</code> y <code>edit</code> pueden mostrar un título específico. El listado 14-16 muestra cómo modificar el título de las vistas del módulo <code>articulo</code>. La vista <code>edit</code> resultante se ilustra en la figura 14-9.</p>

<p><strong>Listado 14-16 - Estableciendo el título de cada vista, en <code>backend/modules/articulo/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    title</span><span class="sy2">: </span>Lista de artículos
<span class="co4">
  new</span>:<span class="co3">
    title</span><span class="sy2">: </span>Nuevo artículo
<span class="co4">
  edit</span>:<span class="co3">
    title</span><span class="sy2">: </span>Editar artículo <span class="co2">%%titulo%% (%%id%%)</span></pre>
</div>

<div class="figure" id="figure_14_9">
    <img src="/img/symfony_1_4/f1409.png" alt="Título propio en la vista &quot;edit&quot; del módulo &quot;articulo&quot;" />

    <p class="caption"><strong>Figura 14.9</strong> Título propio en la vista &quot;edit&quot; del módulo &quot;articulo&quot;</p>
</div>


<p>Como los títulos por defecto utilizan el nombre de cada clase, normalmente no es necesario modificarlos (siempre que el modelo utilice nombres de clase explícitos).</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Las opciones del archivo <code>generator.yml</code> pueden utilizar el valor de cualquier campo encerrando su nombre entre <code>%%</code> y <code>%%</code>.</p></div>

<h4 id="anadiendo_mensajes_de_ayuda">14.3.3.2. Añadiendo mensajes de ayuda</h4>

<p>En las vistas <code>list</code>, <code>new</code> y <code>edit</code>, se pueden añadir <em>"tooltips"</em> o mensajes de ayuda para describir los campos que se muestran en los formularios. El listado 14-17 muestra como añadir un mensaje de ayuda para el campo <code>blog_articulo_id</code> en la vista <code>edit</code> del módulo <code>comentario</code>. Para ello, se utiliza la propiedad <code>help</code> bajo la clave <code>fields</code>. El resultado se muestra en la figura 14-10.</p>

<p><strong>Listado 14-17 - Añadiendo un mensaje de ayuda en la vista <code>edit</code>, en <code>modules/comentario/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  edit</span>:<span class="co4">
    fields</span>:<span class="co3">
      blog_articulo_id</span><span class="sy2">: </span><span class="br0">&#123;</span> help<span class="sy2">: </span>Este comentario pertenece a este artículo <span class="br0">&#125;</span></pre>
</div>

<div class="figure" id="figure_14_10">
    <img src="/img/symfony_1_4/f1410.png" alt="Mensaje de ayuda en la vista &quot;edit&quot; del módulo &quot;comentario&quot;" />

    <p class="caption"><strong>Figura 14.10</strong> Mensaje de ayuda en la vista &quot;edit&quot; del módulo &quot;comentario&quot;</p>
</div>


<p>En la vista <code>list</code>, los mensajes de ayuda se muestran en la cabecera de la columna; en las vistas <code>new</code>, <code>edit</code> y <code>filter</code>, los mensajes se muestran debajo de cada cuadro de texto.</p>

<h4 id="modificando_el_formato_de_la_fecha">14.3.3.3. Modificando el formato de la fecha</h4>

<p>Las fechas se pueden mostrar siguiendo un formato propio si se utiliza la opción <code>date_format</code>, tal y como se muestra en el listado 14-18.</p>

<p><strong>Listado 14-18 - Dando formato a la fecha en la vista <code>list</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co4">
    fields</span>:<span class="co3">
      created_at</span><span class="sy2">: </span><span class="br0">&#123;</span> label<span class="sy2">: </span>Fecha de publicación, date_format<span class="sy2">: </span>dd/MM <span class="br0">&#125;</span></pre>
</div>

<p>La sintaxis que se utiliza es la misma que la del <em>helper</em> <code>format_date()</code> descrito en el capítulo anterior.</p>

<div class="admonition sidebar"><p><strong class="title">Las plantillas de administración están preparadas para la internacionalización</strong> Los módulos de administración generados automáticamente muestran cadenas de texto propias (los nombres de las acciones, los mensajes de ayuda de la paginación, etc.) y cadenas de texto personalizadas (títulos, nombres de columnas, mensajes de ayuda, mensajes de error, etc.)</p>

<p>Symfony incluye la traducción en varios idiomas de todas las cadenas de texto propias. Si lo deseas, también puedes añadir tus propias traducciones o sobreescribir alguna traducción existente creando un archivo propio en formato XLIFF en el directorio <code>i18n</code>. Las traducciones deben crearse para el catálogo <code>sf_admin</code>, por lo que los archivos se deben llamar obligatoriamente <code>apps/frontend/i18n/sf_admin.XX.xml</code>, donde <code>XX</code> es el código ISO del idioma.</p>

<p>Además, todas las cadenas de texto propias incluidas en las plantillas generadas se internacionalizan de forma automática, es decir, se encierran en una llamada al <em>helper</em> <code>__()</code>. Por tanto, es muy fácil traducir la administración generada automáticamente añadiendo las traducciones de todas las frases en un archivo con formato XLIFF en el directorio <code>apps/frontend/i18n/</code>, tal y como se explicó en el capítulo anterior.</p>

<p>Si quieres modificar el catálogo por defecto utilizado para las cadenas de texto propias, utiliza la opción <code>i18n_catalogue</code>:</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">generator</span>:<span class="co3">
  class</span><span class="sy2">: </span>sfPropelGenerator<span class="co4">
  param</span>:<span class="co3">
    i18n_catalogue</span><span class="sy2">: </span>admin</pre>
</div>

<p></p></div>

<h3 id="opciones_especificas_para_la_vista_list">14.3.4. Opciones específicas para la vista <code>list</code></h3>

<p>La vista <code>list</code>' puede mostrar la información de cada fila en varias columnas o de forma conjunta en una sola línea. También puede mostrar opciones para filtrar los resultados, paginación de resultados y opciones para ordenar los datos. Todas estas opciones se pueden modificar mediante los archivos de configuración, como se muestra en las siguientes secciones.</p>

<h4 id="modificando_el_layout">14.3.4.1. Modificando el layout</h4>

<p>Por defecto, la unión entre la vista <code>list</code> y la vista <code>edit</code> se realiza mediante la columna que muestra la clave primaria. Si se observa de nuevo la figura 14-8, se ve que la columna <code>id</code> de la lista de comentarios no solo muestra la clave primaria de cada comentario, sino que incluye un enlace que permite a los usuarios acceder de forma directa a la vista <code>edit</code>.</p>

<p>Si se quiere mostrar en otra columna el enlace a los datos detallados, se añade el prefijo <code>=</code> al nombre de la columna que se utiliza en la clave <code>display</code>. El listado 14-19 elimina la columna <code>id</code> de la vista <code>list</code> de los comentarios y establece el enlace en el campo <code>contenido</code>. La figura 14-11 muestra el resultado de este cambio.</p>

<p><strong>Listado 14-19 - Cambiando el enlace a la vista <code>edit</code> en la vista <code>list</code>, en <code>modules/comentario/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    display</span><span class="sy2">: </span>   <span class="br0">&#91;</span>id, =contenido<span class="br0">&#93;</span></pre>
</div>

<div class="figure" id="figure_14_11">
    <img src="/img/symfony_1_4/f1411.png" alt="Estableciendo el enlace a la vista <code>edit</code> en otra columna, en la vista <code>list</code> del módulo <code>comentario</code>" />

    <p class="caption"><strong>Figura 14.11</strong> Estableciendo el enlace a la vista <code>edit</code> en otra columna, en la vista <code>list</code> del módulo <code>comentario</code></p>
</div>


<p>La vista <code>list</code> muestra por defecto todos sus datos en varias columnas. También es posible mostrar de forma seguida todos los datos en una sola cadena de texto que ocupe toda la anchura de la tabla. El aspecto con el que se muestran los datos se denomina <em>"layout"</em> y la forma en la que se muestran todos seguidos se denomina <code>stacked</code>. Si se utiliza el layout <code>stacked</code>, la clave <code>params</code> debe contener el patrón que define el orden en el que se muestran los datos. El listado 14-20 muestra por ejemplo el layout deseado para la vista <code>list</code> del módulo <code>comentario</code>. La figura 14-12 ilustra el resultado final.</p>

<p><strong>Listado 14-20 - Uso del layout <code>stacked</code> en la vista <code>list</code>, en <code>modules/comentario/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    layout</span><span class="sy2">: </span> stacked<span class="co3">
    params</span><span class="sy2">: </span> <span class="sy2">|
</span><span class="co0">      %%=contenido%%&lt;br /&gt;
      (escrito por %%autor%% el %%created_at%% y relacionado con %%_article_link%%)</span><span class="co3">
    display</span><span class="sy2">: </span> <span class="br0">&#91;</span>created_at, autor, contenido<span class="br0">&#93;</span></pre>
</div>

<div class="figure" id="figure_14_12">
    <img src="/img/symfony_1_4/f1412.png" alt="Layout &quot;stacked&quot; en la vista &quot;list&quot; del módulo &quot;comentario&quot;" />

    <p class="caption"><strong>Figura 14.12</strong> Layout &quot;stacked&quot; en la vista &quot;list&quot; del módulo &quot;comentario&quot;</p>
</div>


<p>El layout normal en varias columnas requiere un array con el nombre de los campos en la clave <code>display</code>; sin embargo, el layout <code>stacked</code> requiere que la clave <code>params</code> incluya el código HTML que se utilizará para mostrar cada fila de datos. No obstante, el array de la clave <code>display</code> también se utiliza en el layout <code>stacked</code> para determinar las cabeceras de columnas disponibles para reordenar los datos mostrados.</p>

<h4 id="filtrando_los_resultados">14.3.4.2. Filtrando los resultados</h4>

<p>En la vista de tipo <code>list</code>, se pueden añadir fácilmente una serie de filtros. Con estos filtros, los usuarios pueden mostrar menos resultados y pueden obtener más rápidamente los que están buscando. Los filtros se configuran mediante un array con los nombres de los campos en la clave <code>filter</code>. El listado 14-21 muestra como incluir un filtro según los campos <code>blog_articulo_id</code>, <code>autor</code> y <code>created_at</code> en la vista <code>list</code> del módulo <code>comentario</code>, y la figura 14-13 ilustra el resultado.</p>

<p><strong>Listado 14-21 - Incluyendo filtros en la vista <code>list</code>, en <code>modules/comentario/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    layout</span><span class="sy2">: </span> stacked<span class="co3">
    params</span><span class="sy2">: </span> <span class="sy2">|
</span><span class="co0">      %%=contenido%% &lt;br /&gt;
      (escrito por %%autor%% el %%created_at%% y relacionado con %%_article_link%%)</span><span class="co3">
    display</span><span class="sy2">: </span> <span class="br0">&#91;</span>created_at, autor, contenido<span class="br0">&#93;</span>
<span class="co4">
  filter</span>:<span class="co3">
    display</span><span class="sy2">: </span><span class="br0">&#91;</span>blog_articulo_id, autor, created_at<span class="br0">&#93;</span></pre>
</div>

<div class="figure" id="figure_14_13">
    <img src="/img/symfony_1_4/f1413.png" alt="Filtros en la vista &quot;list&quot; del módulo &quot;comentario&quot;" />

    <p class="caption"><strong>Figura 14.13</strong> Filtros en la vista &quot;list&quot; del módulo &quot;comentario&quot;</p>
</div>


<p>Los filtros que muestra Symfony dependen del tipo de columna definido en el esquema de datos y se pueden modificar en la clase de los filtros del formulario:</p>

<ul>
<li>Para las columnas de texto (como el campo <code>autor</code> en el módulo <code>comentario</code>), el filtro es un cuadro de texto que permite realizar búsquedas textuales (los comodines se añaden automáticamente).</li>
<li>Para las claves externas (como el campo <code>blog_articulo_id</code> en el módulo <code>comentario</code>), el filtro es una lista desplegable con los datos de la columna correspondiente en la tabla asociada. Por defecto, las opciones de la lista desplegable son las que devuelve el método <code>__toString()</code> de la clase relacionada.</li>
<li>Para las fechas (como el campo <code>created_at</code> en el módulo <code>comentario</code>), el filtro está formado por un par de elementos para seleccionar fechas, de forma que se pueda indicar un intervalo temporal.</li>
<li>Para las columnas booleanas, el filtro muestra una lista desplegable con los valores <code>true</code>, <code>false</code> y <code>true or false</code> (la última opción es para reinicializar el filtro).</li>
</ul>

<p>Al igual que las vistas <code>new</code> y <code>edit</code> están relacionadas con la clase de un formulario, los filtros utilizan la clase del formulario de filtros asociado por defecto con el modelo (como por ejemplo <code>BlogArticuloFormFilter</code> para el modelo <code>BlogArticulo</code>). Si defines tu propia clase para el formulario de filtros, puedes personalizar los campos de los filtros aprovechando todas las opciones del framework de formularios y utilizando todos los widgets disponibles. Como muestra el listado 14-22, utilizar un filtro propio es tan sencillo como indicar la opción <code>class</code> dentro de la sección <code>filter</code>.</p>

<p><strong>Listado 14-22 - Personalizando la clase del formulario utilizado para los filtros</strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  filter</span>:<span class="co3">
    class</span><span class="sy2">: </span>BackendArticuloFormFilter</pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> Si quieres deshabilitar todos los filtros, utiliza <code>false</code> como valor de la opción <code>class</code>.</p></div>

<p>También puedes hacer uso de elementos parciales para añadir tu propia lógica en los filtros. Cada elemento parcial recibe como argumentos <code>form</code> y <code>attributes</code> que se utilizan para mostrar el elemento del formulario. El listado 14-23 muestra un ejemplo que utiliza elementos parciales para obtener el mismo comportamiento que el de por defecto.</p>

<p><strong>Listado 14-23 - Utilizando un elemento parcial como filtro</strong></p>

<div class="code php">
<pre class="php">// El elemento parcial se define en templates/_estado.php
<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$form</span><span class="br0">&#91;</span><span class="re0">$nombre</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">render</span><span class="br0">&#40;</span><span class="re0">$attributes</span><span class="sy0">-&gt;</span><span class="me1">getRawValue</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<div class="code yaml">
<pre class="yaml">// Se añade el filtro parcial en la lista de filtros de config/generator.yml<span class="co4">
config</span>:<span class="co3">
  filter</span><span class="sy2">: </span><span class="br0">&#91;</span>created_at, _estado<span class="br0">&#93;</span></pre>
</div>

<h4 id="ordenando_el_listado">14.3.4.3. Ordenando el listado</h4>

<p>Como muestra la figura 14-18, en la vista <code>list</code> las columnas que forman la cabecera de la tabla son enlaces que se pueden utilizar para reordenar los datos del listado. Las cabeceras se muestran tanto en el layout normal como en el layout <code>stacked</code>. Al pinchar en cualquiera de estos enlaces, se recarga la página añadiendo un parámetro <code>sort</code> que permite reordenar los datos de forma adecuada.</p>

<div class="figure" id="figure_14_14">
    <img src="/img/symfony_1_4/f1414.png" alt="Las cabeceras de la tabla de la vista &quot;list&quot; permiten reordenar los datos" />

    <p class="caption"><strong>Figura 14.14</strong> Las cabeceras de la tabla de la vista &quot;list&quot; permiten reordenar los datos</p>
</div>


<p>Se puede utilizar la misma sintaxis que emplea Symfony para incluir un enlace que apunte directamente a los datos ordenados de una forma determinada:</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span> <span class="kw1">echo</span> link_to<span class="br0">&#40;</span><span class="st_h">'Listado de comentarios ordenados por fecha'</span><span class="sy0">,</span> <span class="st_h">'@blog_comentario?sort=created_at&amp;sort_type=desc'</span> <span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<p>También es posible indicar en el archivo <code>generator.yml</code> el orden por defecto para la vista <code>list</code> mediante el parámetro <code>sort</code>. El listado 14-24 muestra un ejemplo de la sintaxis que debe utilizarse.</p>

<p><strong>Listado 14-24 - Estableciendo un orden por defecto en la vista <code>list</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    sort</span><span class="sy2">: </span>  created_at
    <span class="co1"># Sintaxis alternativa para indicar la forma de ordenar</span><span class="co3">
    sort</span><span class="sy2">: </span>  <span class="br0">&#91;</span>created_at, desc<span class="br0">&#93;</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> Solamente se pueden reordenar los datos mediante los campos que se corresponden con columnas reales, no mediante los campos propios y los campos parciales.</p></div>

<h4 id="modificando_la_paginacion">14.3.4.4. Modificando la paginación</h4>

<p>La administración generada automáticamente tiene en cuenta la posibilidad de que las tablas contengan muchos datos, por lo que la vista <code>list</code> incluye por defecto una paginación de datos. Si el número total de filas de la tabla es mayor que el número máximo de filas por página, entonces aparece la paginación al final del listado. La figura 14-15 muestra el ejemplo de un listado con 6 comentarios de prueba para el que el número máximo de comentarios por página es de 5. La paginación de datos asegura un buen rendimiento a la aplicación, porque solamente se obtienen los datos de las filas que se muestran, y permite una buena usabilidad, ya que hasta las filas que contienen millones de filas se pueden manejar con el módulo de administración.</p>

<div class="figure" id="figure_14_15">
    <img src="/img/symfony_1_4/f1415.png" alt="La paginación se muestra cuando el listado es muy largo" />

    <p class="caption"><strong>Figura 14.15</strong> La paginación se muestra cuando el listado es muy largo</p>
</div>


<p>El número máximo de filas que se muestran en cada página se controla mediante la opción <code>max_per_page</code>:</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    max_per_page</span><span class="sy2">: </span>  <span class="nu0">5</span></pre>
</div>

<h4 id="mejorando_el_rendimiento_mediante_una_join">14.3.4.5. Mejorando el rendimiento mediante una Join</h4>

<p>El generador de la administración utiliza por defecto el método <code>doSelect()</code> para obtener las filas de datos. Sin embargo, si se utilizan objetos relacionados en el listado, el número de consultas a la base de datos puede aumentar demasiado. Si se quiere mostrar por ejemplo el nombre del artículo en el listado de comentarios, se debe hacer una consulta adicional por cada comentario para obtener el objeto <code>BlogArticulo</code> relacionado. Afortunadamente, se puede indicar al paginador que utilice un método específico tipo <code>doSelectJoinXXX()</code> para optimizar el número de consultas necesario. La opción <code>peer_method</code> es la encargada de indicar el método a utilizar.</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    peer_method</span><span class="sy2">: </span>doSelectJoinBlogArticulo</pre>
</div>

<p>En el Capítulo 18 se explica más detalladamente el concepto de Join.</p>

<h3 id="opciones_especificas_para_las_vistas_new_y_edit">14.3.5. Opciones específicas para las vistas new y edit</h3>

<p>Las vistas <code>new</code> y <code>edit</code> permiten al usuario modificar el valor de cualquier columna de un registro nuevo o existente de la base de datos. Por defecto, el formulario utilizado por el generador de la parte de administración es el formulario asociado con el modelo: <code>BlogArticuloForm</code> para el modelo <code>BlogArticulo</code>. Si quieres utilizar una clase propia, puedes indicarlo en la opción <code>class</code> de la sección <code>form</code>, tal y como muestra el listado 14-25.</p>

<p><strong>Listado 14-25 - Utilizando una clase de formulario propia en las vistas <code>new</code> y <code>edit</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  form</span>:<span class="co3">
    class</span><span class="sy2">: </span>BackendBlogArticuloForm</pre>
</div>

<p>Si se emplea una clase de formulario propia, es posible modificar todos los widgets y validadores utilizados por el generador de la parte de administración. Además, en este caso la clase de formulario por defecto se puede utilizar y modificar para su uso específico en la aplicación <code>frontend</code>.</p>

<p>El listado 14-26 muestra cómo personalizar los títulos, mensajes de ayuda y layout del formulario directamente desde el archivo de configuración <code>generator.yml</code>.</p>

<p><strong>Listado 14-26 - Modificando el aspecto del formulario</strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  form</span>:<span class="co4">
    display</span>:<span class="co3">
      NONE</span><span class="sy2">: </span>    <span class="br0">&#91;</span>articulo_id<span class="br0">&#93;</span><span class="co3">
      Editable</span><span class="sy2">: </span><span class="br0">&#91;</span>autor, contenido, created_at<span class="br0">&#93;</span><span class="co4">
    fields</span>:<span class="co3">
      contenido</span><span class="sy2">: </span> <span class="br0">&#123;</span> label<span class="sy2">: </span>cuerpo, help<span class="sy2">: </span><span class="st0">&quot;El contenido del artículo se puede escribir con el formato Markdown&quot;</span> <span class="br0">&#125;</span></pre>
</div>

<h4 id="manejando_los_campos_parciales">14.3.5.1. Manejando los campos parciales</h4>

<p>Las vistas <code>new</code> y <code>edit</code> pueden utilizar los mismos elementos parciales que se emplean en las vistas de tipo <code>list</code>.</p>

<h3 id="trabajando_con_claves_externas">14.3.6. Trabajando con claves externas</h3>

<p>Si el esquema de la aplicación define relaciones entre tablas, los módulos generados para la administración pueden aprovechar esas relaciones para automatizar aun más los campos, simplificando enormemente la gestión de las relaciones entre tablas.</p>

<h4 id="relaciones_uno_a_muchos">14.3.6.1. Relaciones uno-a-muchos</h4>

<p>El generador de la administración se ocupa automáticamente de las relaciones de tipo 1-n entre tablas. Como se muestra en la figura 14-1, la tabla <code>blog_comentario</code> se relaciona con la tabla <code>blog_articulo</code> mediante el campo <code>blog_articulo_id</code>. Si se utiliza el generador de administraciones para iniciar el módulo de la clase <code>BlogComentario</code>, la acción <code>edit</code> muestra automáticamente el campo <code>blog_articulo_id</code> como una lista desplegable con los valores de los <code>id</code> de todas las filas de datos de la tabla <code>blog_articulo</code> (observa de nuevo la figura 14-9).</p>

<p>La explicación anterior también es aplicable si quieres mostrar la lista de comentarios relacionados con un artículo en el módulo <code>articulo</code> (relación n-1).</p>

<h4 id="relaciones_muchos_a_muchos">14.3.6.2. Relaciones muchos-a-muchos</h4>

<p>Symfony también se encarga de las relaciones n-n, como se muestra en la figura 14-16.</p>

<div class="figure" id="figure_14_16">
    <img src="/img/symfony_1_4/f1416.png" alt="Relaciones muchos a muchos" />

    <p class="caption"><strong>Figura 14.16</strong> Relaciones muchos a muchos</p>
</div>


<p>Personalizando el widget utilizado para mostrar este tipo de relación, se puede modificar la forma en la que se muestra el campo (ver figura 14-17):</p>

<div class="figure" id="figure_14_17">
    <img src="/img/symfony_1_4/f1417.png" alt="Tipos de campos especiales disponibles para la gestión de las relaciones muchos-a-muchos" />

    <p class="caption"><strong>Figura 14.17</strong> Tipos de campos especiales disponibles para la gestión de las relaciones muchos-a-muchos</p>
</div>


<h3 id="anadiendo_nuevas_interacciones">14.3.7. Añadiendo nuevas interacciones</h3>

<p>Los módulos de administración permiten a los usuarios realizar las operaciones CRUD habituales, aunque también es posible añadir otras interacciones diferentes o restringir las interacciones disponibles en una vista. La configuración que se muestra en el listado 14-27 habilita todas las operaciones CRUD habituales para el módulo <code>articulo</code>.</p>

<p><strong>Listado 14-27 - Definiendo las interacciones de cada vista, en <code>backend/modules/articulo/config/generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    title</span><span class="sy2">: </span>         Listado de Artículos<span class="co4">
    object_actions</span>:<span class="co3">
      _edit</span><span class="sy2">: </span>        ~<span class="co3">
      _delete</span><span class="sy2">: </span>      ~<span class="co4">
    batch_actions</span>:<span class="co3">
      _delete</span><span class="sy2">: </span>      ~<span class="co4">
    actions</span>:<span class="co3">
      _new</span><span class="sy2">: </span>         ~
<span class="co4">
  edit</span>:<span class="co3">
    title</span><span class="sy2">: </span>         Cuerpo del artículo <span class="co2">%%titulo%%</span><span class="co4">
    actions</span>:<span class="co3">
      _delete</span><span class="sy2">: </span>      ~<span class="co3">
      _list</span><span class="sy2">: </span>        ~<span class="co3">
      _save</span><span class="sy2">: </span>        ~<span class="co3">
      _save_and_add</span><span class="sy2">: </span>~</pre>
</div>

<p>En la vista de tipo <code>list</code>, existen tres opciones relacionadas con las acciones: la lista de las acciones disponibles para todos los objetos (<code>object_actions</code>), la lista de opciones disponibles para una selección de objetos (<code>batch_actions</code>) y la lista de acciones disponibles para la página entera (<code>actions</code>). La lista de interacciones definidas en el listado 14-27 producen el resultado de la figura 14-18. Cada fila de datos muestra un botón para modificar la información y un botón para eliminar ese registro, además de un <em>checkbox</em> en cada fila para poder borrar varios elementos seleccionados. Al final de la lista se muestra un botón para crear nuevos elementos.</p>

<div class="figure" id="figure_14_18">
    <img src="/img/symfony_1_4/f1418.png" alt="Interacciones de la vista &quot;list&quot;" />

    <p class="caption"><strong>Figura 14.18</strong> Interacciones de la vista &quot;list&quot;</p>
</div>


<p>En las vistas <code>new</code> y <code>edit</code>, como sólo se modifica un registro de datos cada vez, solamente se define un conjunto de acciones (en <code>actions</code>). Las interacciones definidas en el listado 14-27 se muestran con el aspecto de la figura 14-23. Tanto la acción <code>save</code> (guardar) como la acción <code>save_and_add</code> (guardar_y_añadir) guardan los cambios realizados en los datos. La única diferencia es que la acción <code>save</code> vuelve a mostrar la vista <code>edit</code> con los nuevos datos y la acción <code>save_and_add</code> muestra la vista <code>new</code> para añadir otro elemento. Por tanto, la acción <code>save_and_add</code> es un atajo muy útil cuando se están añadiendo varios elementos de forma consecutiva. El botón de la acción <code>delete</code> (<code>borrar</code>) se encuentra lo suficientemente alejado de los otros dos botones como para que no sea pulsado por accidente.</p>

<p>Los nombres de las interacciones que empiezan con un guión bajo (<code>_</code>) son reconocidos por Symfony y por tanto, utilizan el mismo icono y realizan la misma acción que las interacciones por defecto. El generador de la administración es capaz de reconocer las acciones <code>_edit</code>, <code>_delete</code>, <code>_new</code>, <code>_list</code>, <code>_save</code>, <code>_save_and_add</code> y <code>_create</code>.</p>

<div class="figure" id="figure_14_19">
    <img src="/img/symfony_1_4/f1419.png" alt="Interacciones de la vista &quot;edit&quot;" />

    <p class="caption"><strong>Figura 14.19</strong> Interacciones de la vista &quot;edit&quot;</p>
</div>


<p>También es posible definir interacciones propias, para lo que se debe especificar un nombre que no empiece por guión bajo y una acción del módulo actual, tal y como se muestra en el listado 14-28.</p>

<p><strong>Listado 14-28 - Definiendo una interacción propia</strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">list</span>:<span class="co3">
  title</span><span class="sy2">: </span>         Listado de Artículos<span class="co4">
  object_actions</span>:<span class="co3">
    _edit</span><span class="sy2">: </span>       -<span class="co3">
    _delete</span><span class="sy2">: </span>     -<span class="co3">
    comentar</span><span class="sy2">: </span>    <span class="br0">&#123;</span> label<span class="sy2">: </span>Añade un comentario, action<span class="sy2">: </span>comentar <span class="br0">&#125;</span></pre>
</div>

<p>Ahora, cada artículo que aparece en el listado muestra un enlace con el texto <em>Añade un comentario</em>, tal y como se muestra en la figura 14-20. Al pinchar sobre ese enlace, se ejecuta la acción <code>comentar()</code> del módulo actual. La clave primaria del objeto relacionado se pasa automáticamente a los parámetros de la petición que se produce.</p>

<div class="figure" id="figure_14_20">
    <img src="/img/symfony_1_4/f1420.png" alt="Interacciones propias en la vista &quot;list&quot;" />

    <p class="caption"><strong>Figura 14.20</strong> Interacciones propias en la vista &quot;list&quot;</p>
</div>


<p>La acción <code>comentar</code> puede ser tan sencilla como la que muestra el listado 14-29.</p>

<p><strong>Listado 14-29 - Acción para una interacción propia, en <code>actions/actions.class.php</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> executeComentar<span class="br0">&#40;</span><span class="re0">$request</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$comentario</span> <span class="sy0">=</span> <span class="kw2">new</span> BlogComentario<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="re0">$comentario</span><span class="sy0">-&gt;</span><span class="me1">setArticuloId</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'id'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="re0">$comentario</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'blog_comentario_edit'</span><span class="sy0">,</span> <span class="re0">$comentario</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Las acciones de tipo <code>batch</code> reciben un array con todas las claves primarias de las filas seleccionadas a través de un parámetro de petición llamado <code>id</code>.</p>

<p>Por último, si se quieren eliminar todas las acciones para una determinada vista, se utiliza una lista vacía como la del listado 14-30.</p>

<p><strong>Listado 14-30 - Eliminando todas las acciones en la vista <code>list</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span>:<span class="co4">
  list</span>:<span class="co3">
    title</span><span class="sy2">: </span>  Listado de Artículos<span class="co3">
    actions</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="br0">&#125;</span></pre>
</div>

<h3 id="validacion_de_formularios">14.3.8. Validación de formularios</h3>

<p>La validación de datos se realiza de forma automática en el formulario utilizado en las vistas <code>new</code> y <code>edit</code>. Si se quiere personalizar la validación, se deben modificar las clases correspondientes de cada formulario.</p>

<h3 id="restringiendo_las_acciones_del_usuario_mediante_credenciales">14.3.9. Restringiendo las acciones del usuario mediante credenciales</h3>

<p>Los campos y las interacciones disponibles en un módulo de administración pueden variar en función de las credenciales del usuario conectado (el Capítulo 6 describe las opciones de seguridad de Symfony).</p>

<p>Los campos definidos en el generador pueden incluir una opción <code>credentials</code> para restringir su acceso solamente a los usuarios con la credencial adecuada. Esta característica se puede utilizar en la vista <code>list</code>. Además, el generador puede ocultar algunas interacciones en función de la credenciales del usuario. El listado 14-31 muestra estas opciones.</p>

<p><strong>Listado 14-31 - Utilizando credenciales en <code>generator.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">config</span><span class="sy2">:
</span>  <span class="co1"># La columna id solamente se muestra para los usuarios con la credencial &quot;admin&quot;</span><span class="co4">
  list</span>:<span class="co3">
    title</span><span class="sy2">: </span>         Listado de Artículos<span class="co3">
    display</span><span class="sy2">: </span>       <span class="br0">&#91;</span>id, =titulo, contenido, numero_comentarios<span class="br0">&#93;</span><span class="co4">
    fields</span>:<span class="co3">
      id</span><span class="sy2">: </span>          <span class="br0">&#123;</span> credentials<span class="sy2">: </span><span class="br0">&#91;</span>admin<span class="br0">&#93;</span> <span class="br0">&#125;</span>
&nbsp;
  <span class="co1"># La acción &quot;comentar&quot; se restringe a los usuarios con la credencial &quot;admin&quot;</span><span class="co4">
  actions</span>:<span class="co3">
    comentar</span><span class="sy2">: </span><span class="br0">&#123;</span> credentials<span class="sy2">: </span><span class="br0">&#91;</span>admin<span class="br0">&#93;</span> <span class="br0">&#125;</span></pre>
</div>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_14/creando_la_parte_de_administracion_de_las_aplicaciones.html">
                        <strong>&larr; Anterior</strong>
                        <small>14.2. Creando la parte de administración de las aplicaciones</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_14/modificando_el_aspecto_de_los_modulos_generados.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>14.4. Modificando el aspecto de los módulos generados</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Symfony</a>
            </li>
                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Explorando el interior de Symfony</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Ejecutar aplicaciones Symfony</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Introducción a la creación de páginas</a>
            </li>
                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Configurar Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El Controlador</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> La Vista</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> El modelo (Doctrine)</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Enlaces y sistema de enrutamiento</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Formularios</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Emails</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Uso de la cache</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Internacionalización y localización</a>
            </li>
                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_14.html">
                    <span>Capítulo 14.</span> Generador de la parte de administración
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/generacion_de_codigo_en_funcion_del_modelo.html">
                    <span>14.1.</span> Generación de código en función del modelo
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/creando_la_parte_de_administracion_de_las_aplicaciones.html">
                    <span>14.2.</span> Creando la parte de administración de las aplicaciones
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_14/configuracion_del_generador.html">
                    <span>14.3.</span> Configuración del generador
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/modificando_el_aspecto_de_los_modulos_generados.html">
                    <span>14.4.</span> Modificando el aspecto de los módulos generados
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_14/resumen.html">
                    <span>14.5.</span> Resumen
                </a>
            </li>
                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Pruebas unitarias y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> Herramientas para la administración de aplicaciones</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Personalizar Symfony</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Rendimiento</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Configuración avanzada</a>
            </li>
                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
