<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Capítulo 6. Añadiendo otro modelo (Introducción a Ruby on Rails)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="./capitulo_5.html" />
                    <link rel="next" href="./capitulo_7.html" />
                <link rel="start" href="/libro/introduccion_rails/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Capítulo 6. Añadiendo otro modelo (Introducción a Ruby on Rails)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page introduccion_rails"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/introduccion_rails/" itemprop="url">
                    <span itemprop="title">Introducción a Ruby on Rails</span>
                </a>
            </li>

        
            <li class="active">
                <span>Capítulo 6. Añadiendo otro modelo</span>
            </li>
        </ol>
    </div>

    <h1 id="anadiendo_otro_modelo" class="title">
        <span>Capítulo 6.</span> Añadiendo otro modelo
    </h1>

    <p>A continuación vamos a añadir un segundo modelo a la aplicación. Este nuevo
modelo se encargará de gestionar los comentarios de los artículos.</p>

<h2 id="generando_el_modelo">6.1. Generando el modelo</h2>

<p>Para generar el nuevo modelo usaremos el mismo generador que se explicó
anteriormente para el modelo <code>Article</code>. Esta vez se creará un modelo llamado
<code>Comment</code> que gestionará los comentarios de los artículos. Para crearlo,
ejecuta el siguiente comando:</p>

<div class="code cli">
<pre class="cli">$ bin/rails generate model Comment commenter:string body:text article:references</pre>
</div>

<p>Como resultado de este comando se generarán cuatro archivos:</p>

<div class="table" id="table_6_1">

    <table>
<thead>
<tr>
  <th>File</th>
  <th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>db/migrate/20140120201010_create_comments.rb</code></td>
  <td>Archivo de migración para crear la tabla <code>comments</code> en la base de datos (en tu caso el nombre del archivo será ligeramente diferente)</td>
</tr>
<tr>
  <td><code>app/models/comment.rb</code></td>
  <td>El modelo <code>Comment</code></td>
</tr>
<tr>
  <td><code>test/models/comment_test.rb</code></td>
  <td>Los tests del modelo</td>
</tr>
<tr>
  <td><code>test/fixtures/comments.yml</code></td>
  <td>Comentarios de prueba para los tests</td>
</tr>
</tbody>
</table>
</div>


<p>Primero echa un vistazo al archivo <code>app/models/comment.rb</code>:</p>

<div class="code ruby">
<pre class="ruby"><span class="kw1">class</span> Comment <span class="sy0">&lt;</span> <span class="re2">ActiveRecord::Base</span>
  belongs_to <span class="re3">:article</span>
<span class="kw1">end</span></pre>
</div>

<p>Su contenido es muy similar al del modelo <code>Article</code> generado anteriormente. La
única diferencia es la línea <code>belongs_to :article</code>, que configura una relación
para <em>Active Record</em>. En la próxima sencción se explican estas relaciones entre
modelos.</p>

<p>Además del modelo, Rails genera un archivo de migración para crear la tabla
correspondiente en la base de datos:</p>

<div class="code ruby">
<pre class="ruby"><span class="kw1">class</span> CreateComments <span class="sy0">&lt;</span> <span class="re2">ActiveRecord::Migration</span>
  <span class="kw1">def</span> change
    create_table <span class="re3">:comments</span> <span class="kw1">do</span> <span class="sy0">|</span>t<span class="sy0">|</span>
      t.<span class="kw3">string</span> <span class="re3">:commenter</span>
      t.<span class="me1">text</span> <span class="re3">:body</span>
&nbsp;
      <span class="co1"># this line adds an integer column called `article_id`.</span>
      t.<span class="me1">references</span> <span class="re3">:article</span>, index: <span class="kw2">true</span>
&nbsp;
      t.<span class="me1">timestamps</span>
    <span class="kw1">end</span>
  <span class="kw1">end</span>
<span class="kw1">end</span></pre>
</div>

<p>La línea <code>t.references</code> crea una columna de tipo <em>clave foránea</em> para 
establecer la relación entre los dos modelos. Además se crea un índice para 
esta columna. Como ya tenemos todo preparado, ejecuta el siguiente comando:</p>

<div class="code cli">
<pre class="cli">$ bin/rake db:migrate</pre>
</div>

<p>Rails es lo bastante <em>inteligente</em> como para ejecutar solamente las migraciones
que todavía no se han ejecutado en la base de datos que se está utilizando. Así
que el resultado de ejecutar el comando será:</p>

<div class="code cli">
<pre class="cli">==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================</pre>
</div>

<h2 id="asociando_modelos">6.2. Asociando modelos</h2>

<p>Las asociaciones de <em>Active Record</em> permiten declarar las relaciones que 
existen entre dos modelos. En el caso de los comentarios y los artículos, las
relaciones se podrían escribir de esta manera:</p>

<ul>
<li>Cada comentario pertenece (en inglés, <em>"belongs to"</em>) a un artículo.</li>
<li>Un artículo puede tener muchos (en inglés, <em>"have many"</em>) comentarios.</li>
</ul>

<p>Si te fijas un poco, la sintaxis que utiliza Rails es prácticamente la misma
que como se describen las relaciones en inglés. Recuerda la línea del modelo
<code>Comment</code> (archivo <code>app/models/comment.rb</code>) que establece la relación con
<code>Article</code>:</p>

<div class="code ruby">
<pre class="ruby"><span class="kw1">class</span> Comment <span class="sy0">&lt;</span> <span class="re2">ActiveRecord::Base</span>
  belongs_to <span class="re3">:article</span>
<span class="kw1">end</span></pre>
</div>

<p>Ahora edita el archivo <code>app/models/article.rb</code> para definir el otro extremo de
la relación:</p>

<div class="code ruby">
<pre class="ruby"><span class="kw1">class</span> Article <span class="sy0">&lt;</span> <span class="re2">ActiveRecord::Base</span>
  has_many <span class="re3">:comments</span>
  validates <span class="re3">:title</span>, presence: <span class="kw2">true</span>,
                    length: <span class="br0">&#123;</span> minimum: <span class="nu0">5</span> <span class="br0">&#125;</span>
<span class="kw1">end</span></pre>
</div>

<p>Gracias a estas dos declaraciones (<code>belongs_to</code> y <code>has_many</code>), Rails puede
hacer casi todo el trabajo automáticamente. Si por ejemplo tienes una variable
de instancia llamada <code>@article</code> que contiene un artículo, puedes obtener todos
sus comentarios mediante la isntrucción <code>@article.comments</code>.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Consulta el artículo <a href="http://guides.rubyonrails.org/association_basics.html">Active Record Associations</a>
para obtener más información sobre las asociaciones.</p></div>

<h2 id="anadiendo_una_ruta_para_los_comentarios">6.3. Añadiendo una ruta para los comentarios</h2>

<p>En primer lugar debemos añadir una nueva ruta para que Rails sepa dónde 
queremos navegar para ver los comentarios. Para ello, abre el archivo
<code>config/routes.rb</code> y haz que tenga el siguiente contenido:</p>

<div class="code ruby">
<pre class="ruby">resources <span class="re3">:articles</span> <span class="kw1">do</span>
  resources <span class="re3">:comments</span>
<span class="kw1">end</span></pre>
</div>

<p>Esta configuración crea la ruta <code>comments</code> dentro de la ruta <code>articles</code> que
definimos anteriormente. Esta es otra forma de establecer la relación entre
los dos modelos.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Para obtener más información sobre el enrutamiento, consulta la guía
<a href="http://guides.rubyonrails.org/routing.html">Routing Guide</a>.</p></div>

<h2 id="generando_un_controlador">6.4. Generando un controlador</h2>

<p>El modelo ya está creado así que ahora podemos dedicarnos a su controlador
asociado. De nuevo utilizaremos el comando que genera controladores:</p>

<div class="code cli">
<pre class="cli">$ bin/rails generate controller Comments</pre>
</div>

<p>Como resultado de este comando se generan seis archivos y un directorio vacío:</p>

<div class="table" id="table_6_2">

    <table>
<thead>
<tr>
  <th>Archivo/Directorio</th>
  <th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>app/controllers/comments_controller.rb</code></td>
  <td>El controlador <code>Comments</code></td>
</tr>
<tr>
  <td><code>app/views/comments/</code></td>
  <td>Direcotrio donde guardar las vistas del controlador</td>
</tr>
<tr>
  <td><code>test/controllers/comments_controller_test.rb</code></td>
  <td>El test funcional del controlador</td>
</tr>
<tr>
  <td><code>app/helpers/comments_helper.rb</code></td>
  <td>El <em>helper</em> para las vistas relacionadas con los comentarios</td>
</tr>
<tr>
  <td><code>test/helpers/comments_helper_test.rb</code></td>
  <td>Test unitario para el <em>helper</em></td>
</tr>
<tr>
  <td><code>app/assets/javascripts/comment.js.coffee</code></td>
  <td>Archivo CoffeeScript para las vistas del controlador</td>
</tr>
<tr>
  <td><code>app/assets/stylesheets/comment.css.scss</code></td>
  <td>Hoja de estilos CSS para las vistas del controlador</td>
</tr>
</tbody>
</table>
</div>


<p>Como sucede en cualquier blog de Internet, los usuarios podrán añadir 
comentarios en los artículos y después de hacerlo, se les redirigirá a la
página de ese mismo artículo para que puedan ver su comentario publicado. Por 
eso el controlador <code>CommentsController</code> deberá incluir un método para crear
comentarios y para borrar todos los comentarios de <em>spam</em> que lleguen.</p>

<p>Así que en primer lugar vamos a modificar la plantilla que muestra los 
artículos (archivo <code>app/views/articles/show.html.erb</code>) para que deje crear 
nuevos comentarios:</p>

<div class="code rails">
<pre class="rails">&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  <span class="sy0">&lt;%</span>= <span class="re1">@article</span>.<span class="me1">title</span> <span class="sy0">%&gt;</span>
&lt;/p&gt;
&nbsp;
&lt;p&gt;
  &lt;strong&gt;Text:&lt;/strong&gt;
  <span class="sy0">&lt;%</span>= <span class="re1">@article</span>.<span class="me1">text</span> <span class="sy0">%&gt;</span>
&lt;/p&gt;
&nbsp;
&lt;h2&gt;Add a comment:&lt;/h2&gt;
<span class="sy0">&lt;%</span>= <span class="kw5">form_for</span><span class="br0">&#40;</span><span class="br0">&#91;</span>@article, <span class="re1">@article</span>.<span class="me1">comments</span>.<span class="me1">build</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="kw1">do</span> <span class="sy0">|</span>f<span class="sy0">|</span> <span class="sy0">%&gt;</span>
  &lt;p&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">label</span> <span class="re3">:commenter</span> <span class="sy0">%&gt;</span>&lt;br&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">text_field</span> <span class="re3">:commenter</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
  &lt;p&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">label</span> <span class="re3">:body</span> <span class="sy0">%&gt;</span>&lt;br&gt;
    <span class="sy0">&lt;%</span>= f.<span class="kw5">text_area</span> <span class="re3">:body</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
  &lt;p&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">submit</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
<span class="sy0">&lt;%</span> <span class="kw1">end</span> <span class="sy0">%&gt;</span>
&nbsp;
<span class="sy0">&lt;%</span>= <span class="kw5">link_to</span> <span class="st0">'Back'</span>, articles_path <span class="sy0">%&gt;</span>
| <span class="sy0">&lt;%</span>= <span class="kw5">link_to</span> <span class="st0">'Edit'</span>, edit_article_path<span class="br0">&#40;</span>@article<span class="br0">&#41;</span> <span class="sy0">%&gt;</span></pre>
</div>

<p>Este código añade un formulario en la página <code>show</code> de los artículos para
poder crear nuevos comentarios llamando a la acción <code>create</code> del controlador
<code>CommentsController</code>. En este caso el método <code>form_for</code> utiliza un array que
crea rutas anidadas de tipo <code>/articles/1/comments</code>.</p>

<p>El siguiente paso consiste en crear la acción <code>create</code> en el archivo
<code>app/controllers/comments_controller.rb</code>:</p>

<div class="code ruby">
<pre class="ruby"><span class="kw1">class</span> CommentsController <span class="sy0">&lt;</span> ApplicationController
  <span class="kw1">def</span> create
    <span class="re1">@article</span> = Article.<span class="me1">find</span><span class="br0">&#40;</span>params<span class="br0">&#91;</span><span class="re3">:article_id</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
    <span class="re1">@comment</span> = <span class="re1">@article</span>.<span class="me1">comments</span>.<span class="me1">create</span><span class="br0">&#40;</span>comment_params<span class="br0">&#41;</span>
    redirect_to article_path<span class="br0">&#40;</span>@article<span class="br0">&#41;</span>
  <span class="kw1">end</span>
&nbsp;
  private
    <span class="kw1">def</span> comment_params
      params.<span class="kw3">require</span><span class="br0">&#40;</span><span class="re3">:comment</span><span class="br0">&#41;</span>.<span class="me1">permit</span><span class="br0">&#40;</span><span class="re3">:commenter</span>, <span class="re3">:body</span><span class="br0">&#41;</span>
    <span class="kw1">end</span>
<span class="kw1">end</span></pre>
</div>

<p>Este controlador es un poco más complejo del que creamos para los artículos.
Esta es una de las consecuencias de anidar relaciones. Cada petición 
relacionada con un comentario debe contener una referencia al artículo con el
que está relacionado. Por eso tenemos que buscar primero el modelo <code>Article</code>
que está relacionado con el comentario.</p>

<p>Además, la acción utiliza algunos de los métodos disponibles para las 
relaciones. Así por ejemplo se utiliza el método <code>create</code> sobre
<code>@article.comments</code> para crear y guardar un comentario. Esto hace que el
comentario esté automáticamente relacionado con este artículo específico.</p>

<p>Después de crear el nuevo comentario, se redirige al usuario de nuevo a la
página que meustra el artículo original mediante el <em>helper</em>
<code>article_path(@article)</code>. Como acabamos de ver, este <em>helper</em>  llama a la
acción <code>show</code> del controlador <code>ArticlesController</code>, que a su vez renderiza la
plantilla <code>show.html.erb</code>. Como esta es la plantilla en la que se debe mostrar
el nuevo comentario, añade lo siguiente en el archivo
<code>app/views/articles/show.html.erb</code>:</p>

<div class="code rails">
<pre class="rails">&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  <span class="sy0">&lt;%</span>= <span class="re1">@article</span>.<span class="me1">title</span> <span class="sy0">%&gt;</span>
&lt;/p&gt;
&nbsp;
&lt;p&gt;
  &lt;strong&gt;Text:&lt;/strong&gt;
  <span class="sy0">&lt;%</span>= <span class="re1">@article</span>.<span class="me1">text</span> <span class="sy0">%&gt;</span>
&lt;/p&gt;
&nbsp;
&lt;h2&gt;Comments&lt;/h2&gt;
<span class="sy0">&lt;%</span> <span class="re1">@article</span>.<span class="me1">comments</span>.<span class="kw5">each</span> <span class="kw1">do</span> <span class="sy0">|</span>comment<span class="sy0">|</span> <span class="sy0">%&gt;</span>
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    <span class="sy0">&lt;%</span>= comment.<span class="me1">commenter</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
&nbsp;
  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    <span class="sy0">&lt;%</span>= comment.<span class="me1">body</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
<span class="sy0">&lt;%</span> <span class="kw1">end</span> <span class="sy0">%&gt;</span>
&nbsp;
&lt;h2&gt;Add a comment:&lt;/h2&gt;
<span class="sy0">&lt;%</span>= <span class="kw5">form_for</span><span class="br0">&#40;</span><span class="br0">&#91;</span>@article, <span class="re1">@article</span>.<span class="me1">comments</span>.<span class="me1">build</span><span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="kw1">do</span> <span class="sy0">|</span>f<span class="sy0">|</span> <span class="sy0">%&gt;</span>
  &lt;p&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">label</span> <span class="re3">:commenter</span> <span class="sy0">%&gt;</span>&lt;br&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">text_field</span> <span class="re3">:commenter</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
  &lt;p&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">label</span> <span class="re3">:body</span> <span class="sy0">%&gt;</span>&lt;br&gt;
    <span class="sy0">&lt;%</span>= f.<span class="kw5">text_area</span> <span class="re3">:body</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
  &lt;p&gt;
    <span class="sy0">&lt;%</span>= f.<span class="me1">submit</span> <span class="sy0">%&gt;</span>
  &lt;/p&gt;
<span class="sy0">&lt;%</span> <span class="kw1">end</span> <span class="sy0">%&gt;</span>
&nbsp;
<span class="sy0">&lt;%</span>= <span class="kw5">link_to</span> <span class="st0">'Edit Article'</span>, edit_article_path<span class="br0">&#40;</span>@article<span class="br0">&#41;</span> <span class="sy0">%&gt;</span> |
<span class="sy0">&lt;%</span>= <span class="kw5">link_to</span> <span class="st0">'Back to Articles'</span>, articles_path <span class="sy0">%&gt;</span></pre>
</div>

<p>Ahora ya puedes añadir artículos y comentarios en el blog y cada contenido se
muestra en el lugar adecuado.</p>

<div class="figure" id="figure_6_1">
    <img src="/img/introduccion_rails/article_with_comments.png" alt="Artículo con comentarios" />

    <p class="caption"><strong>Figura 6.1</strong> Artículo con comentarios</p>
</div>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="./capitulo_5.html">
                        <strong>&larr; Anterior</strong>
                        <small>Capítulo 5. Creando un nuevo post</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="./capitulo_7.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>Capítulo 7. Refactorización</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="./capitulo_1.html"> Antes de empezar</a>
            </li>
                                            <li class="level-1">
                <span>2.</span> <a href="./capitulo_2.html"> ¿Qué es Rails?</a>
            </li>
                                            <li class="level-1">
                <span>3.</span> <a href="./capitulo_3.html"> Creando un nuevo proyecto</a>
            </li>
                                            <li class="level-1">
                <span>4.</span> <a href="./capitulo_4.html"> Hola, Rails!</a>
            </li>
                                            <li class="level-1">
                <span>5.</span> <a href="./capitulo_5.html"> Creando un nuevo post</a>
            </li>
                                            <li class="level-1 active">
                <a href="./capitulo_6.html">
                    <span>Capítulo 6.</span> Añadiendo otro modelo
                </a>
            </li>
                                            <li class="level-1">
                <span>7.</span> <a href="./capitulo_7.html"> Refactorización</a>
            </li>
                                            <li class="level-1">
                <span>8.</span> <a href="./capitulo_8.html"> Borrando comentarios</a>
            </li>
                                            <li class="level-1">
                <span>9.</span> <a href="./capitulo_9.html"> Seguridad</a>
            </li>
                                            <li class="level-1">
                <span>10.</span> <a href="./capitulo_10.html"> Siguientes pasos</a>
            </li>
                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
