<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>5.3. El widget de direcciones con Google Maps (Más con Symfony)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_5/creando_un_widget_simple_y_un_validador.html" />
                    <link rel="next" href="../capitulo_5/conclusiones.html" />
                <link rel="start" href="/libro/mas_con_symfony/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="5.3. El widget de direcciones con Google Maps (Más con Symfony)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page mas_con_symfony"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/mas_con_symfony/" itemprop="url">
                    <span itemprop="title">Más con Symfony</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/mas_con_symfony/capitulo_5.html" itemprop="url">
                    <span itemprop="title">Capítulo 5. Widgets y validadores propios</span>
                </a>
            </li>
        
            <li class="active">
                <span>5.3. El widget de direcciones con Google Maps</span>
            </li>
        </ol>
    </div>

    <h1 id="el_widget_de_direcciones_con_google_maps" class="title">
        <span>5.3.</span> El widget de direcciones con Google Maps
    </h1>

    

<p>En esta sección se va a crear un widget avanzado, por lo que se utilizarán
nuevos métodos e incluso se integrará código JavaScript. El widget se llamará
"GMAW, acrónimo de <em>"Google Map Address Widget"</em>.</p>

<p>¿Cuál es el propósito de este widget? Su objetivo principal es permitir que el
usuario pueda introducir una dirección. Para ello se va a hacer uso de un cuadro
de texto sencillo y del servicio de mapas de Google.</p>

<div class="figure" id="figure_5_1">
    <img src="/img/mas_con_symfony/widgets-figure-01.png" alt="&quot;Google Map Address Widget&quot;" title="Google Map Address Widget" />

    <p class="caption"><strong>Figura 5.1</strong> &quot;Google Map Address Widget&quot;</p>
</div>


<p>Caso de uso 1:</p>

<ul>
<li>El usuario introduce una dirección.</li>
<li>El usuario pulsa el botón <em>"lookup"</em>.</li>
<li>Se crea un nuevo marcador en el mapa y se actualizan los campos ocultos que
guardan la longitud y la latitud. El marcador del mapa se coloca en la
localización de la dirección indicada. Si el servicio de geocodificación de
Google no puede encontrar la dirección, se muestra un mensaje de error.</li>
</ul>

<p>Caso de uso 2:</p>

<ul>
<li>El usuario pincha en el mapa.</li>
<li>Se actualizan los campos ocultos de longitud y latitud.</li>
<li>Se realiza una búsqueda inversa para determinar la dirección que corresponde
a ese punto del mapa.</li>
</ul>

<p><em>El formulario debe incluir y gestionar los siguientes campos:</em></p>

<ul>
<li><code>latitude</code>: valor decimal entre 90 y -90</li>
<li><code>longitude</code>: valor decimal entre 180 y -180</li>
<li><code>address</code>: cadena de texto</li>
</ul>

<p>Una vez definidas las especificaciones funcionales del widget, se definen a
continuación las herramientas técnicas y sus responsabilidades:</p>

<ul>
<li>Google maps y los servicios de geocodificación: muestra el mapa y obtiene
la información de la dirección</li>
<li>jQuery: añade las interacciones JavaScript entre el formulario y el campo</li>
<li>sfForm: muestra el widget y valida los datos introducidos</li>
</ul>

<h3 id="widget_sfwidgetformgmapaddress">5.3.1. Widget <code>sfWidgetFormGMapAddress</code></h3>

<p>Como un widget es la representación visual de los datos, el método <code>configure()</code>
del widget debe incluir diferentes opciones para configurar el mapa de Google
o para modificar los estilos de cada elemento. Una de las opciones más importantes
es <code>template.html</code>, que define cómo se ordenan todos los elementos. Cuando se
crea un widget es muy importante pensar en su extensibilidad y en cómo reutilizarlo.</p>

<p>Otro aspecto importante es la definición de los archivos externos. Las clases
<code>sfWidgetForm</code> pueden implementar dos métodos específicos:</p>

<ul>
<li><code>getJavascripts()</code> devuelve un array de archivos JavaScript</li>
<li><code>getStylesheets()</code> devuelve un array de archivos CSS (donde la clave es la
ruta del archivo y su valor es el atributo <code>media</code>).</li>
</ul>

<p>El widget que se está creando sólo hace uso de JavaScript, por lo que no se
necesita ningún archivo CSS. En este caso, el widget no se encargará de
inicializar el código JavaScript de Google, a pesar de que luego hará uso de
los mapas y la geocodificación de Google. En su lugar, es responsabilidad del
programador incluir los archivos necesarios en la página. El motivo es que otros
elementos de la página diferentes al widget también podrían hacer uso de los
servicios de Google.</p>

<p>A continuación se muestra el código necesario:</p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> sfWidgetFormGMapAddress <span class="kw2">extends</span> sfWidgetForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="re0">$options</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$attributes</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'address.options'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'style'</span> <span class="sy0">=&gt;</span> <span class="st_h">'width:400px'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'default'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'address'</span> <span class="sy0">=&gt;</span> <span class="st_h">''</span><span class="sy0">,</span>
      <span class="st_h">'longitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'2.294359'</span><span class="sy0">,</span>
      <span class="st_h">'latitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'48.858205'</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'div.class'</span><span class="sy0">,</span> <span class="st_h">'sf-gmap-widget'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'map.height'</span><span class="sy0">,</span> <span class="st_h">'300px'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'map.width'</span><span class="sy0">,</span> <span class="st_h">'500px'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'map.style'</span><span class="sy0">,</span> <span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'lookup.name'</span><span class="sy0">,</span> <span class="st0">&quot;Lookup&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'template.html'</span><span class="sy0">,</span> <span class="st_h">'
      &lt;div id=&quot;{div.id}&quot; class=&quot;{div.class}&quot;&gt;
        {input.search} &lt;input type=&quot;submit&quot; value=&quot;{input.lookup.name}&quot;  id=&quot;{input.lookup.id}&quot; /&gt; &lt;br /&gt;
        {input.longitude}
        {input.latitude}
        &lt;div id=&quot;{map.id}&quot; style=&quot;width:{map.width};height:{map.height};{map.style}&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    '</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
     <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">addOption</span><span class="br0">&#40;</span><span class="st_h">'template.javascript'</span><span class="sy0">,</span> <span class="st_h">'
      &lt;script type=&quot;text/javascript&quot;&gt;
        jQuery(window).bind(&quot;load&quot;, function() {
          new sfGmapWidgetWidget({
            longitude: &quot;{input.longitude.id}&quot;,
            latitude: &quot;{input.latitude.id}&quot;,
            address: &quot;{input.address.id}&quot;,
            lookup: &quot;{input.lookup.id}&quot;,
            map: &quot;{map.id}&quot;
          });
        })
      &lt;/script&gt;
    '</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw2">public</span> <span class="kw2">function</span> getJavascripts<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'/sfFormExtraPlugin/js/sf_widget_gmap_address.js'</span>
    <span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw2">public</span> <span class="kw2">function</span> render<span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">,</span> <span class="re0">$value</span> <span class="sy0">=</span> <span class="kw4">null</span><span class="sy0">,</span> <span class="re0">$attributes</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$errors</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// definir las variables principales de la plantilla</span>
    <span class="re0">$template_vars</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'{div.id}'</span>             <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">generateId</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{div.class}'</span>          <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'div.class'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{map.id}'</span>             <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">generateId</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[map]'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{map.style}'</span>          <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'map.style'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{map.height}'</span>         <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'map.height'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{map.width}'</span>          <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'map.width'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{input.lookup.id}'</span>    <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">generateId</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[lookup]'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{input.lookup.name}'</span>  <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'lookup.name'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{input.address.id}'</span>   <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">generateId</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[address]'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{input.latitude.id}'</span>  <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">generateId</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[latitude]'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'{input.longitude.id}'</span> <span class="sy0">=&gt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">generateId</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[longitude]'</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// evitar cualquier error o aviso sobre formatos no válidos de $value</span>
    <span class="re0">$value</span> <span class="sy0">=</span> <span class="sy0">!</span><span class="kw3">is_array</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#41;</span> ? <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">:</span> <span class="re0">$value</span><span class="sy0">;</span>
    <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span>   <span class="sy0">=</span> <span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span><span class="br0">&#41;</span>   ? <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span> <span class="sy0">:</span> <span class="st_h">''</span><span class="sy0">;</span>
    <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span><span class="br0">&#41;</span> ? <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span> <span class="sy0">:</span> <span class="st_h">''</span><span class="sy0">;</span>
    <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span>  <span class="sy0">=</span> <span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span><span class="br0">&#41;</span>  ? <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span> <span class="sy0">:</span> <span class="st_h">''</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// definir el widget de la dirección</span>
    <span class="re0">$address</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormInputText<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'address.options'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$template_vars</span><span class="br0">&#91;</span><span class="st_h">'{input.search}'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$address</span><span class="sy0">-&gt;</span><span class="me1">render</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[address]'</span><span class="sy0">,</span> <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// definir los campos de longitud y latitud</span>
    <span class="re0">$hidden</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormInputHidden<span class="sy0">;</span>
    <span class="re0">$template_vars</span><span class="br0">&#91;</span><span class="st_h">'{input.longitude}'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$hidden</span><span class="sy0">-&gt;</span><span class="me1">render</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[longitude]'</span><span class="sy0">,</span> <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$template_vars</span><span class="br0">&#91;</span><span class="st_h">'{input.latitude}'</span><span class="br0">&#93;</span>  <span class="sy0">=</span> <span class="re0">$hidden</span><span class="sy0">-&gt;</span><span class="me1">render</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="sy0">.</span><span class="st_h">'[latitude]'</span><span class="sy0">,</span> <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// combinar las plantillas y las variables</span>
    <span class="kw1">return</span> <span class="kw3">strtr</span><span class="br0">&#40;</span>
      <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'template.html'</span><span class="br0">&#41;</span><span class="sy0">.</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getOption</span><span class="br0">&#40;</span><span class="st_h">'template.javascript'</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="re0">$template_vars</span>
    <span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Este widget utiliza el método <code>generateId()</code> para generar el <code>id</code> de cada elemento.
La variable <code>$name</code> se define en <code>sfFormFieldSchema</code>, por lo que <code>$name</code> está
compuesta por el nombre del formulario, cualquier otro nombre de un esquema de
widgets y el propio nombre del widget definido en el método <code>configure()</code>.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Si por ejemplo el nombre del formulario es <code>user</code>, el nombre del esquema de
widgets es <code>location</code> y el nombre del widget es <code>address</code>, el valor completo
de <code>name</code> será <code>user[location][address]</code> y el <code>id</code> será <code>user_location_address</code>.
En otras palabras, <code>$this-&gt;generateId($name.'[latitude]')</code> generará un valor
<code>id</code> válido y único para el campo <code>latitude</code>.</p></div>

<p>Los diferentes atributos <code>id</code> de los elementos son muy importantes porque se
pasan al bloque de código JavaScript (mediante la variable <code>template.js</code>), de
forma que los elementos se puedan manipular correctamente desde JavaScript.</p>

<p>El método <code>render()</code> también instancia dos widgets internos: el widget
<code>sfWidgetFormInputText</code>, que se emplea para mostrar el campo de la dirección
y un widget <code>sfWidgetFormInputHidden</code> que es el que se emplea para incluir los
campos ocultos.</p>

<p>El widget se puede probar fácilmente con el siguiente trozo de código:</p>

<div class="code php">
<pre class="php"><span class="re0">$widget</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormGMapAddress<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">echo</span> <span class="re0">$widget</span><span class="sy0">-&gt;</span><span class="me1">render</span><span class="br0">&#40;</span><span class="st_h">'user[location][address]'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'address'</span> <span class="sy0">=&gt;</span> <span class="st_h">'151 Rue montmartre, 75002 Paris'</span><span class="sy0">,</span>
  <span class="st_h">'longitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'2.294359'</span><span class="sy0">,</span>
  <span class="st_h">'latitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'48.858205'</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>El código HTML y JavaScript resultante es el siguiente:</p>

<div class="code html5">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;user_location_address&quot;</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;sf-gmap-widget&quot;</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">style</span><span class="sy0">=</span><span class="st0">&quot;width:400px&quot;</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;user[location][address][address]&quot;</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;151 Rue montmartre, 75002 Paris&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;user_location_address_address&quot;</span> <span class="sy0">/</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;submit&quot;</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;Lookup&quot;</span>  <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;user_location_address_lookup&quot;</span> <span class="sy0">/</span>&gt;</span> <span class="sc2">&lt;<span class="kw2">br</span> <span class="sy0">/</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;hidden&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;user[location][address][longitude]&quot;</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;2.294359&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;user_location_address_longitude&quot;</span> <span class="sy0">/</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;hidden&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;user[location][address][latitude]&quot;</span> <span class="kw3">value</span><span class="sy0">=</span><span class="st0">&quot;48.858205&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;user_location_address_latitude&quot;</span> <span class="sy0">/</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;user_location_address_map&quot;</span> <span class="kw3">style</span><span class="sy0">=</span><span class="st0">&quot;width:500px;height:300px;&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">script</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text/javascript&quot;</span>&gt;</span>
  jQuery(window).bind(&quot;load&quot;, function() {
    new sfGmapWidgetWidget({
      longitude: &quot;user_location_address_longitude&quot;,
      latitude: &quot;user_location_address_latitude&quot;,
      address: &quot;user_location_address_address&quot;,
      lookup: &quot;user_location_address_lookup&quot;,
      map: &quot;user_location_address_map&quot;
    });
  })
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span></pre>
</div>

<p>La parte JavaScript del widget toma los diferentes atributos <code>id</code> y les asocia
<em>listeners</em> de jQuery para ejecutar cierto código JavaScript como respuesta a
las acciones del usuario. El código JavaScript actualiza los campos ocultos con
la longitud y latitud proporcionadas por el servicio de geocodificación de
Google.</p>

<p>El objeto JavaScript dispone de varios métodos interesantes:</p>

<ul>
<li><code>init()</code>: es el método en el que se inicializan todas las variables y se
asocian los diferentes eventos</li>
<li><code>lookupCallback()</code>: método <em>static</em> que utiliza el geocodificador para buscar
la dirección indicada por el usuario</li>
<li><code>reverseLookupCallback()</code>: otro método <em>static</em> utilizado por el geocodificador
para convertir la longitud y latitud en una dirección válida.</li>
</ul>

<p>El código JavaScript completo se puede ver en el Apéndice A.</p>

<p>Si quieres conocer detalladamente todas las funcionalidades de los mapas de
Google, por favor consulta la documentación de su <a href="http://code.google.com/apis/maps/">API</a>.</p>

<h3 id="validador_sfvalidatorgmapaddress">5.3.2. Validador <code>sfValidatorGMapAddress</code></h3>

<p>La clase <code>sfValidatorGMapAddress</code> hereda de <code>sfValidatorBase</code>, que ya realiza
una validación: si el valor del campo se establece como es debido, su valor no
puede ser <code>null</code>. Por tanto, <code>sfValidatorGMapAddress</code> sólo necesita validar tres
valores diferentes: <code>latitude</code>, <code>longitude</code> y <code>address</code>. La variable <code>$value</code>
debería ser un array, pero como no podemos confiar en lo que introduzca el
usuario, el validador comprueba que todas las claves están presentes, de forma
que se pasen valores válidos a cada validador.</p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> sfValidatorGMapAddress <span class="kw2">extends</span> sfValidatorBase
<span class="br0">&#123;</span>
  <span class="kw2">protected</span> <span class="kw2">function</span> doClean<span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span><span class="kw3">is_array</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
      <span class="kw1">throw</span> <span class="kw2">new</span> sfValidatorError<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="st_h">'invalid'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    try
    <span class="br0">&#123;</span>
      <span class="re0">$latitude</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorNumber<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span> <span class="st_h">'min'</span> <span class="sy0">=&gt;</span> <span class="sy0">-</span><span class="nu0">90</span><span class="sy0">,</span> <span class="st_h">'max'</span> <span class="sy0">=&gt;</span> <span class="nu0">90</span><span class="sy0">,</span> <span class="st_h">'required'</span> <span class="sy0">=&gt;</span> <span class="kw4">true</span> <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$latitude</span><span class="sy0">-&gt;</span><span class="me1">clean</span><span class="br0">&#40;</span><span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span><span class="br0">&#41;</span> ? <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'latitude'</span><span class="br0">&#93;</span> <span class="sy0">:</span> <span class="kw4">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
      <span class="re0">$longitude</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorNumber<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span> <span class="st_h">'min'</span> <span class="sy0">=&gt;</span> <span class="sy0">-</span><span class="nu0">180</span><span class="sy0">,</span> <span class="st_h">'max'</span> <span class="sy0">=&gt;</span> <span class="nu0">180</span><span class="sy0">,</span> <span class="st_h">'required'</span> <span class="sy0">=&gt;</span> <span class="kw4">true</span> <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$longitude</span><span class="sy0">-&gt;</span><span class="me1">clean</span><span class="br0">&#40;</span><span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span><span class="br0">&#41;</span> ? <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'longitude'</span><span class="br0">&#93;</span> <span class="sy0">:</span> <span class="kw4">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
      <span class="re0">$address</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span> <span class="st_h">'min_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">10</span><span class="sy0">,</span> <span class="st_h">'max_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="st_h">'required'</span> <span class="sy0">=&gt;</span> <span class="kw4">true</span> <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="re0">$address</span><span class="sy0">-&gt;</span><span class="me1">clean</span><span class="br0">&#40;</span><span class="kw3">isset</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span><span class="br0">&#41;</span> ? <span class="re0">$value</span><span class="br0">&#91;</span><span class="st_h">'address'</span><span class="br0">&#93;</span> <span class="sy0">:</span> <span class="kw4">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    catch<span class="br0">&#40;</span>sfValidatorError <span class="re0">$e</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
      <span class="kw1">throw</span> <span class="kw2">new</span> sfValidatorError<span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">,</span> <span class="st_h">'invalid'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="kw1">return</span> <span class="re0">$value</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> Un validador siempre lanza una excepción de tipo <code>sfValidatorError</code> cuando un
valor no es válido. Ese es el motivo por el que se encierra la validación en
un bloque <code>try/catch</code>. En este caso, el validador lanza una nueva excepción de
tipo <code>invalid</code>, que equivale a un error de validación de tipo <code>invalid</code> en el
validador <code>sfValidatorGMapAddress</code>.</p></div>

<h3 id="pruebas">5.3.3. Pruebas</h3>

<p>¿Por qué son importantes las pruebas? El validador es lo que une la aplicación
con los datos introducidos por el usuario. Si el validador contiene errores, la
aplicación será vulnerable. Afortunadamente, Symfony incluye la librería de
pruebas llamada <code>lime</code>, que facilita la creación de pruebas unitarias y funcionales.</p>

<p>¿Cómo se puede probar el validador? Como se comentó anteriormente, un validador
lanza una excepción cada vez que se produce un error de validación. Por tanto,
para probarlo se le pasan valores válidos y erróneos y se comprueba si se lanza
una excepción en los valores erróneos.</p>

<div class="code php">
<pre class="php"><span class="re0">$t</span> <span class="sy0">=</span> <span class="kw2">new</span> lime_test<span class="br0">&#40;</span><span class="nu0">7</span><span class="sy0">,</span> <span class="kw2">new</span> lime_output_color<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$tests</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">false</span><span class="sy0">,</span> <span class="st_h">''</span><span class="sy0">,</span> <span class="st_h">'empty value'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">false</span><span class="sy0">,</span> <span class="st_h">'string value'</span><span class="sy0">,</span> <span class="st_h">'string value'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">false</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'empty array'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">false</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'address'</span> <span class="sy0">=&gt;</span> <span class="st_h">'my awesome address'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'incomplete address'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">false</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'address'</span> <span class="sy0">=&gt;</span> <span class="st_h">'my awesome address'</span><span class="sy0">,</span> <span class="st_h">'latitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'String'</span><span class="sy0">,</span> <span class="st_h">'longitude'</span> <span class="sy0">=&gt;</span> <span class="nu0">23</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'invalid values'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">false</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'address'</span> <span class="sy0">=&gt;</span> <span class="st_h">'my awesome address'</span><span class="sy0">,</span> <span class="st_h">'latitude'</span> <span class="sy0">=&gt;</span> <span class="nu0">200</span><span class="sy0">,</span> <span class="st_h">'longitude'</span> <span class="sy0">=&gt;</span> <span class="nu0">23</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'invalid values'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="kw3">array</span><span class="br0">&#40;</span><span class="kw4">true</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'address'</span> <span class="sy0">=&gt;</span> <span class="st_h">'my awesome address'</span><span class="sy0">,</span> <span class="st_h">'latitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'2.294359'</span><span class="sy0">,</span> <span class="st_h">'longitude'</span> <span class="sy0">=&gt;</span> <span class="st_h">'48.858205'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st_h">'valid value'</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$v</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorGMapAddress<span class="sy0">;</span>
&nbsp;
<span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">diag</span><span class="br0">&#40;</span><span class="st0">&quot;Testing sfValidatorGMapAddress&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">foreach</span><span class="br0">&#40;</span><span class="re0">$tests</span> <span class="kw1">as</span> <span class="re0">$test</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw3">list</span><span class="br0">&#40;</span><span class="re0">$validity</span><span class="sy0">,</span> <span class="re0">$value</span><span class="sy0">,</span> <span class="re0">$message</span><span class="br0">&#41;</span> <span class="sy0">=</span> <span class="re0">$test</span><span class="sy0">;</span>
&nbsp;
  try
  <span class="br0">&#123;</span>
    <span class="re0">$v</span><span class="sy0">-&gt;</span><span class="me1">clean</span><span class="br0">&#40;</span><span class="re0">$value</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$catched</span> <span class="sy0">=</span> <span class="kw4">false</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  catch<span class="br0">&#40;</span>sfValidatorError <span class="re0">$e</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$catched</span> <span class="sy0">=</span> <span class="kw4">true</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="re0">$t</span><span class="sy0">-&gt;</span><span class="me1">ok</span><span class="br0">&#40;</span><span class="re0">$validity</span> <span class="sy0">!=</span> <span class="re0">$catched</span><span class="sy0">,</span> <span class="st_h">'::clean() '</span><span class="sy0">.</span><span class="re0">$message</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Cuando se invoca el método <code>sfForm::bind()</code>, el formulario ejecuta el método
<code>clean()</code> de cada validador. La prueba anterior reproduce ese comportamiento
instanciando directamente el validador <code>sfValidatorGMapAddress</code> y probando los
diferentes valores.</p>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_5/creando_un_widget_simple_y_un_validador.html">
                        <strong>&larr; Anterior</strong>
                        <small>5.2. Creando un widget simple y un validador</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_5/conclusiones.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>5.4. Conclusiones</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción</a>
            </li>
                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Enrutamiento avanzado</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Mejora tu productividad</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Emails</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_5.html">
                    <span>Capítulo 5.</span> Widgets y validadores propios
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_5/como_funciona_un_widget_y_un_validador.html">
                    <span>5.1.</span> Cómo funciona un widget y un validador
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_5/creando_un_widget_simple_y_un_validador.html">
                    <span>5.2.</span> Creando un widget simple y un validador
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_5/el_widget_de_direcciones_con_google_maps.html">
                    <span>5.3.</span> El widget de direcciones con Google Maps
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_5/conclusiones.html">
                    <span>5.4.</span> Conclusiones
                </a>
            </li>
                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> Formularios avanzados</a>
            </li>
                                                                                                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Mejorando la barra de depuración web</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Uso avanzado de Doctrine</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Utilizando la herencia de tablas de Doctrine</a>
            </li>
                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Funcionamiento interno de Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Windows y Symfony</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Desarrollando aplicaciones Facebook</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Descubriendo el poder de la línea de comandos</a>
            </li>
                                                                                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Jugando con la cache de configuración de Symfony</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Trabajando con la comunidad Symfony</a>
            </li>
                                                                                            <li class="level-1">
                <span>A.</span> <a href="../apendice_a.html"> Código JavaScript de sfWidgetFormGMapAddress</a>
            </li>
                                            <li class="level-1">
                <span>B.</span> <a href="../apendice_b.html"> Ejemplo de instalador propio</a>
            </li>
                                            <li class="level-1">
                <span>C.</span> <a href="../apendice_c.html"> Licencia</a>
            </li>
                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
