<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>16.3. Cargando datos en una base de datos (Symfony 1.0, la guía definitiva)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_16/depuracion_de_aplicaciones.html" />
                    <link rel="next" href="../capitulo_16/instalando_aplicaciones.html" />
                <link rel="start" href="/libro/symfony_1_0/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="16.3. Cargando datos en una base de datos (Symfony 1.0, la guía definitiva)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_1_0"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_0/" itemprop="url">
                    <span itemprop="title">Symfony 1.0, la guía definitiva</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_1_0/capitulo_16.html" itemprop="url">
                    <span itemprop="title">Capítulo 16. Herramientas para la administración de aplicaciones</span>
                </a>
            </li>
        
            <li class="active">
                <span>16.3. Cargando datos en una base de datos</span>
            </li>
        </ol>
    </div>

    <h1 id="cargando_datos_en_una_base_de_datos" class="title">
        <span>16.3.</span> Cargando datos en una base de datos
    </h1>

    

<p>Durante el desarrollo de una aplicación, uno de los problemas recurrentes es el de la carga inicial de datos en la base de datos. Algunos sistemas de bases de datos disponen de soluciones específicas para esta tarea, pero ninguna se puede utilizar junto en el ORM de Symfony. Gracias al uso de YAML y al objeto <code>sfPropelData</code>, Symfony puede transferir automáticamente los datos almacenados en un archivo de texto a una base de datos. Aunque puede parecer que crear el archivo de texto con los datos iniciales de la aplicación cuesta más tiempo que insertarlos directamente en la base de datos, a la larga se ahorra mucho tiempo. Se trata de una utilidad muy práctica para la carga automática de datos de prueba para la aplicación.</p>

<h3 id="sintaxis_del_archivo_de_datos">16.3.1. Sintaxis del archivo de datos</h3>

<p>Symfony es capaz de procesar todos los archivos que siguen una sintaxis YAML definida muy simple y que se encuentren en el directorio <code>data/fixtures/</code>. Los archivos de datos, también llamados <em>"fixtures"</em>, se organizan por clases y cada sección de clase utiliza una cabecera con el valor del nombre de la clase. Para cada clase, las filas de datos disponen de una etiqueta que las identifica de forma única y una serie de pares <code>nombre_campo: valor</code>. El listado 16-12 muestra un ejemplo de un archivo preparado para cargar sus datos en una base de datos.</p>

<p><strong>Listado 16-12 - Archivo de datos de ejemplo, en <code>data/fixtures/import_data.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co3">Article</span><span class="sy2">: </span>                            <span class="co1">## Crea filas de datos en la tabla blog_article</span><span class="co3">
  first_post</span><span class="sy2">: </span>                       <span class="co1">## Etiqueta de la primera fila de datos</span><span class="co3">
    title</span><span class="sy2">: </span>      My first memories<span class="co3">
    content</span><span class="sy2">: |
</span><span class="co0">      For a long time I used to go to bed early. Sometimes, when I had put
      out my candle, my eyes would close so quickly that I had not even time
      to say &quot;I am going to sleep.&quot;
</span><span class="co3">
  second_post</span><span class="sy2">: </span>                      <span class="co1">## Etiqueta de la segunda fila de datos</span><span class="co3">
    title</span><span class="sy2">: </span>      Things got worse<span class="co3">
    content</span><span class="sy2">: |
</span><span class="co0">      Sometimes he hoped that she would die, painlessly, in some accident,
      she who was out of doors in the streets, crossing busy thoroughfares,
      from morning to night.</span></pre>
</div>

<p>Symfony transforma el nombre indicado para las columnas, en métodos <em>setter</em> utilizando la conversión de tipo <em>camelCase</em> (la columna <code>title</code> se transforma en <code>setTitle()</code>, la columna <code>content</code> se transforma en <code>setContent()</code>, etc.). La ventaja de esta transformación es que se puede definir, por ejemplo, una columna llamada <code>password</code> para la que no existe una columna en la tabla de la base de datos; solamente es necesario definir un método llamado <code>setPassword()</code> en el objeto <code>User</code> y ya es posible asignar valores a otras columnas de datos en función de este dato, como por ejemplo una columna que guarde la contraseña encriptada.</p>

<p>No es necesario definir el valor de la columna de la clave primaria. Como es un campo cuyo valor se autoincrementa, la capa de base de datos es capaz de determinar su valor.</p>

<p>A las columnas <code>created_at</code> tampoco es necesario asignarles un valor, ya que Symfony sabe que a las columnas que se llaman así, les debe asignar la fecha actual del sistema a la hora de crearlas.</p>

<h3 id="importando_los_datos">16.3.2. Importando los datos</h3>

<p>La tarea <code>propel-load-data</code> importa los datos de un archivo YAML en una base de datos. Las opciones de conexión con la base de datos se obtienen del archivo de configuración <code>databases.yml</code>, por lo que es necesario indicar a la tarea el nombre de una aplicación. Además, es posible indicar como argumento el nombre de un entorno de ejecución (su valor por defecro es <code>dev</code>).</p>

<div class="code cli">
<pre class="cli">&gt; symfony propel-load-data frontend</pre>
</div>

<p>Al ejecutar este comando, se leen todos los archivos de datos YAML del directorio <code>data/fixtures</code> y se insertan las filas de datos en la base de datos. Por defecto, se reemplaza todo el contenido existente en la base de datos, aunque si se utiliza un argumento opcional llamado <code>append</code>, el comando no borra los datos existentes.</p>

<div class="code cli">
<pre class="cli">&gt; symfony propel-load-data frontend append</pre>
</div>

<p>También es posible especificar otro archivo de datos u otro directorio, indicando su valor como una ruta relativa respecto del directorio del proyecto.</p>

<div class="code cli">
<pre class="cli">&gt; symfony propel-load-data frontend data/misfixtures/miarchivo.yml</pre>
</div>

<h3 id="usando_tablas_relacionadas">16.3.3. Usando tablas relacionadas</h3>

<p>Ahora ya es posible añadir filas de datos a una tabla, pero de esta forma no es posible añadir filas con claves externas que hacen relación a otra tabla. Como los archivos de datos no incluyen la clave primaria, se necesita un método alternativo para relacionar los diferentes registros de datos entre sí.</p>

<p>Volviendo al ejemplo del Capítulo 8, donde la tabla <code>blog_article</code> está relacionada con la tabla <code>blog_comment</code>, de la forma que se muestra en la figura 16-8.</p>

<div class="figure" id="figure_16_8">
    <img src="/img/symfony_1_0/f1608.png" alt="Ejemplo de modelo relacional de una base de datos" />

    <p class="caption"><strong>Figura 16.8</strong> Ejemplo de modelo relacional de una base de datos</p>
</div>


<p>En esta situación es en la que se utilizan las etiquetas únicas de cada fila de datos. Para añadir un campo de tipo <code>Comment</code> al artículo llamado <code>first_post</code>, simplemente es necesario añadir las siguientes líneas del listado 16-13 al archivo de datos <code>import_data.yml</code>.</p>

<p><strong>Listado 16-13 - Añadiendo un registro relacionado con otra tabla, en <code>data/fixtures/import_data.yml</code></strong></p>

<div class="code yaml">
<pre class="yaml"><span class="co4">Comment</span>:<span class="co4">
  first_comment</span>:<span class="co3">
    article_id</span><span class="sy2">: </span>  first_post<span class="co3">
    author</span><span class="sy2">: </span>      Anonymous<span class="co3">
    content</span><span class="sy2">: </span>     Your prose is too verbose. Write shorter sentences.</pre>
</div>

<p>La tarea <code>propel-load-data</code> es capaz de reconocer la etiqueta que se asignó anteriormente al artículo en el archivo <code>import_data.yml</code> y es capaz de obtener la clave primaria del registro de tipo <code>Article</code> correspondiente en la base de datos, para asignar ese valor al campo <code>article_id</code>. No es necesario trabajar con los valores de las columnas de tipo ID, solo es necesario enlazar las filas de datos mediante sus etiquetas, por lo que su funcionamiento es realmente simple.</p>

<p>La única restricción para las filas de datos enlazadas es que los objetos utilizados en una clave externa tienen que estar definidos anteriormente en el archivo; es decir, igual que si se tuvieran que definir uno a uno. Los archivos de datos se procesan desde el principio hasta el final y por tanto, el orden en el que se escriben las filas de datos es muy importante.</p>

<p>Un solo archivo de datos puede contener la declaración de varias clases diferentes. Sin embargo, si se necesitan insertar muchos datos en muchas tablas diferentes, es posible que el archivo de datos sea demasiado largo como para manejarlo fácilmente.</p>

<p>Como la tarea <code>propel-load-data</code> procesa todos los archivos que encuentra en el directorio <code>fixtures/</code>, es posible dividir el archivo de datos YAML en otros archivos más pequeños. Lo único que hay que tener en cuenta es que las claves externas obligan a definir un determinado orden al procesar los datos. Para asegurar que los archivos se procesan en el orden adecuado, se puede añadir un número como prefijo del nombre del archivo, de forma que se procesen en el orden establecido.</p>

<div class="code code">
<pre class="code">100_article_import_data.yml
200_comment_import_data.yml
300_rating_import_data.yml</pre>
</div>



    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_16/depuracion_de_aplicaciones.html">
                        <strong>&larr; Anterior</strong>
                        <small>16.2. Depuración de aplicaciones</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_16/instalando_aplicaciones.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>16.4. Instalando aplicaciones</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a Symfony</a>
            </li>
                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> Explorando el interior de Symfony</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Ejecutar aplicaciones Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Introducción a la creación de páginas</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> Configurar Symfony</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El Controlador</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> La Vista</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> El modelo</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Enlaces y sistema de enrutamiento</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Formularios</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Integración con Ajax</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Uso de la cache</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Internacionalización y localización</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Generadores</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Pruebas unitarias y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_16.html">
                    <span>Capítulo 16.</span> Herramientas para la administración de aplicaciones
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/logs.html">
                    <span>16.1.</span> Logs
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/depuracion_de_aplicaciones.html">
                    <span>16.2.</span> Depuración de aplicaciones
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_16/cargando_datos_en_una_base_de_datos.html">
                    <span>16.3.</span> Cargando datos en una base de datos
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/instalando_aplicaciones.html">
                    <span>16.4.</span> Instalando aplicaciones
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_16/resumen.html">
                    <span>16.5.</span> Resumen
                </a>
            </li>
                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Personalizar Symfony</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> Rendimiento</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> Configuración avanzada</a>
            </li>
                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
