<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>7.2. La primera aplicación (Introducción a AJAX)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_7.html" />
                    <link rel="next" href="../capitulo_7/metodos_y_propiedades_del_objeto_xmlhttprequest.html" />
                <link rel="start" href="/libro/ajax/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="7.2. La primera aplicación (Introducción a AJAX)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page ajax"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/ajax/" itemprop="url">
                    <span itemprop="title">Introducción a AJAX</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/ajax/capitulo_7.html" itemprop="url">
                    <span itemprop="title">Capítulo 7. Primeros pasos con AJAX</span>
                </a>
            </li>
        
            <li class="active">
                <span>7.2. La primera aplicación</span>
            </li>
        </ol>
    </div>

    <h1 id="la_primera_aplicacion" class="title">
        <span>7.2.</span> La primera aplicación
    </h1>

    

<h3 id="codigo_fuente">7.2.1. Código fuente</h3>

<p>La aplicación AJAX completa más sencilla consiste en una adaptación del clásico <em>"Hola Mundo"</em>. En este caso, una aplicación JavaScript descarga un archivo del servidor y muestra su contenido sin necesidad de recargar la página.</p>

<p>Código fuente completo:</p>

<div class="code javascript">
<pre class="javascript">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hola Mundo con AJAX&lt;/title&gt;
&nbsp;
<span class="sy0">&lt;</span>script type<span class="sy0">=</span><span class="st0">&quot;text/javascript&quot;</span><span class="sy0">&gt;</span>
<span class="kw1">function</span> descargaArchivo<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="co1">// Obtener la instancia del objeto XMLHttpRequest</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">XMLHttpRequest</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    peticion_http <span class="sy0">=</span> <span class="kw1">new</span> XMLHttpRequest<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">ActiveXObject</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    peticion_http <span class="sy0">=</span> <span class="kw1">new</span> ActiveXObject<span class="br0">&#40;</span><span class="st0">&quot;Microsoft.XMLHTTP&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// Preparar la funcion de respuesta</span>
  peticion_http.<span class="me1">onreadystatechange</span> <span class="sy0">=</span> muestraContenido<span class="sy0">;</span>
&nbsp;
  <span class="co1">// Realizar peticion HTTP</span>
  peticion_http.<span class="me1">open</span><span class="br0">&#40;</span><span class="st0">'GET'</span><span class="sy0">,</span> <span class="st0">'http://localhost/holamundo.txt'</span><span class="sy0">,</span> <span class="kw2">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
  peticion_http.<span class="me1">send</span><span class="br0">&#40;</span><span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">function</span> muestraContenido<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">readyState</span> <span class="sy0">==</span> <span class="nu0">4</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">status</span> <span class="sy0">==</span> <span class="nu0">200</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        alert<span class="br0">&#40;</span>peticion_http.<span class="me1">responseText</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
window.<span class="me1">onload</span> <span class="sy0">=</span> descargaArchivo<span class="sy0">;</span>
<span class="sy0">&lt;/</span>script<span class="sy0">&gt;</span>
&nbsp;
&lt;/head&gt;
&lt;body&gt;&lt;/body&gt;
&lt;/html&gt;</pre>
</div>

<p>En el ejemplo anterior, cuando se carga la página se ejecuta el método JavaScript que muestra el contenido de un archivo llamado <code>holamundo.txt</code> que se encuentra en el servidor. La clave del código anterior es que la petición HTTP y la descarga de los contenidos del archivo se realizan sin necesidad de recargar la página.</p>

<h3 id="analisis_detallado">7.2.2. Análisis detallado</h3>

<p>La aplicación AJAX del ejemplo anterior se compone de cuatro grandes bloques: instanciar el objeto <code>XMLHttpRequest</code>, preparar la función de respuesta, realizar la petición al servidor y ejecutar la función de respuesta.</p>

<p>Todas las aplicaciones realizadas con técnicas de AJAX deben instanciar en primer lugar el objeto <code>XMLHttpRequest</code>, que es el objeto clave que permite realizar comunicaciones con el servidor en segundo plano, sin necesidad de recargar las páginas.</p>

<p>La implementación del objeto <code>XMLHttpRequest</code> depende de cada navegador, por lo que es necesario emplear una discriminación sencilla en función del navegador en el que se está ejecutando el código:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">XMLHttpRequest</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>  <span class="co1">// Navegadores que siguen los estándares</span>
  peticion_http <span class="sy0">=</span> <span class="kw1">new</span> XMLHttpRequest<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="kw1">else</span> <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">ActiveXObject</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>  <span class="co1">// Navegadores obsoletos</span>
  peticion_http <span class="sy0">=</span> <span class="kw1">new</span> ActiveXObject<span class="br0">&#40;</span><span class="st0">&quot;Microsoft.XMLHTTP&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Los navegadores que siguen los estándares (Firefox, Safari, Opera, Internet Explorer 7 y 8) implementan el objeto <code>XMLHttpRequest</code> de forma nativa, por lo que se puede obtener a través del objeto <code>window</code>. Los navegadores obsoletos (Internet Explorer 6 y anteriores) implementan el objeto <code>XMLHttpRequest</code> como un objeto de tipo ActiveX.</p>

<p>Una vez obtenida la instancia del objeto <code>XMLHttpRequest</code>, se prepara la función que se encarga de procesar la respuesta del servidor. La propiedad <code>onreadystatechange</code> del objeto <code>XMLHttpRequest</code> permite indicar esta función directamente incluyendo su código mediante una función anónima o indicando una referencia a una función independiente. En el ejemplo anterior se indica directamente el nombre de la función:</p>

<div class="code javascript">
<pre class="javascript">peticion_http.<span class="me1">onreadystatechange</span> <span class="sy0">=</span> muestraContenido<span class="sy0">;</span></pre>
</div>

<p>El código anterior indica que cuando la aplicación reciba la respuesta del servidor, se debe ejecutar la función <code>muestraContenido()</code>. Como es habitual, la referencia a la función se indica mediante su nombre sin paréntesis, ya que de otro modo se estaría ejecutando la función y almacenando el valor devuelto en la propiedad <code>onreadystatechange</code>.</p>

<p>Después de preparar la aplicación para la respuesta del servidor, se realiza la petición HTTP al servidor:</p>

<div class="code javascript">
<pre class="javascript">peticion_http.<span class="me1">open</span><span class="br0">&#40;</span><span class="st0">'GET'</span><span class="sy0">,</span> <span class="st0">'http://localhost/prueba.txt'</span><span class="sy0">,</span> <span class="kw2">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
peticion_http.<span class="me1">send</span><span class="br0">&#40;</span><span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Las instrucciones anteriores realizan el tipo de petición más sencillo que se puede enviar al servidor. En concreto, se trata de una petición de tipo <code>GET</code> simple que no envía ningún parámetro al servidor. La petición HTTP se crea mediante el método <code>open()</code>, en el que se incluye el tipo de petición (<code>GET</code>), la URL solicitada (<code>http://localhost/prueba.txt</code>) y un tercer parámetro que vale <code>true</code>.</p>

<p>Una vez creada la petición HTTP, se envía al servidor mediante el método <code>send()</code>. Este método incluye un parámetro que en el ejemplo anterior vale <code>null</code>. Más adelante se ven en detalle todos los métodos y propiedades que permiten hacer las peticiones al servidor.</p>

<p>Por último, cuando se recibe la respuesta del servidor, la aplicación ejecuta de forma automática la función establecida anteriormente.</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">function</span> muestraContenido<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">readyState</span> <span class="sy0">==</span> <span class="nu0">4</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">status</span> <span class="sy0">==</span> <span class="nu0">200</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      alert<span class="br0">&#40;</span>peticion_http.<span class="me1">responseText</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>La función <code>muestraContenido()</code> comprueba en primer lugar que se ha recibido la respuesta del servidor (mediante el valor de la propiedad <code>readyState</code>). Si se ha recibido alguna respuesta, se comprueba que sea válida y correcta (comprobando si el código de estado HTTP devuelto es igual a <code>200</code>). Una vez realizadas las comprobaciones, simplemente se muestra por pantalla el contenido de la respuesta del servidor (en este caso, el contenido del archivo solicitado) mediante la propiedad <code>responseText</code>.</p>

<h3 id="refactorizando_la_primera_aplicacion">7.2.3. Refactorizando la primera aplicación</h3>

<p>La primera aplicación AJAX mostrada anteriormente presenta algunas carencias importantes. A continuación, se refactoriza su código ampliándolo y mejorándolo para que se adapte mejor a otras situaciones. En primer lugar, se definen unas variables que se utilizan en la función que procesa la respuesta del servidor:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">var</span> READY_STATE_UNINITIALIZED <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> 
<span class="kw1">var</span> READY_STATE_LOADING <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span> 
<span class="kw1">var</span> READY_STATE_LOADED <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span>
<span class="kw1">var</span> READY_STATE_INTERACTIVE <span class="sy0">=</span> <span class="nu0">3</span><span class="sy0">;</span> 
<span class="kw1">var</span> READY_STATE_COMPLETE <span class="sy0">=</span> <span class="nu0">4</span><span class="sy0">;</span></pre>
</div>

<p>Como se verá más adelante, la respuesta del servidor sólo puede corresponder a alguno de los cinco estados definidos por las variables anteriores. De esta forma, el código puede utilizar el nombre de cada estado en vez de su valor numérico, por lo que se facilita la lectura y el mantenimiento de las aplicaciones.</p>

<p>Además, la variable que almacena la instancia del objeto <code>XMLHttpRequest</code> se va a transformar en una variable global, de forma que todas las funciones que hacen uso de ese objeto tengan acceso directo al mismo:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">var</span> peticion_http<span class="sy0">;</span></pre>
</div>

<p>A continuación, se crea una función genérica de carga de contenidos mediante AJAX:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">function</span> cargaContenido<span class="br0">&#40;</span>url<span class="sy0">,</span> metodo<span class="sy0">,</span> funcion<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  peticion_http <span class="sy0">=</span> inicializa_xhr<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    peticion_http.<span class="me1">onreadystatechange</span> <span class="sy0">=</span> funcion<span class="sy0">;</span>
    peticion_http.<span class="me1">open</span><span class="br0">&#40;</span>metodo<span class="sy0">,</span> url<span class="sy0">,</span> <span class="kw2">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
    peticion_http.<span class="me1">send</span><span class="br0">&#40;</span><span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>La función definida admite tres parámetros: la URL del contenido que se va a cargar, el método utilizado para realizar la petición HTTP y una referencia a la función que procesa la respuesta del servidor.</p>

<p>En primer lugar, la función <code>cargaContenido()</code> inicializa el objeto <code>XMLHttpRequest</code> (llamado <code>xhr</code> de forma abreviada). Una vez inicializado, se emplea el objeto <code>peticion_http</code> para establecer la función que procesa la respuesta del servidor. Por último, la función <code>cargaContenido()</code> realiza la petición al servidor empleando la URL y el método HTTP indicados como parámetros.</p>

<p>La función <code>inicializa_xhr()</code> se emplea para encapsular la creación del objeto <code>XMLHttpRequest</code>:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">function</span> inicializa_xhr<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">XMLHttpRequest</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw1">new</span> XMLHttpRequest<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">ActiveXObject</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw1">new</span> ActiveXObject<span class="br0">&#40;</span><span class="st0">&quot;Microsoft.XMLHTTP&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>La función <code>muestraContenido()</code> también se refactoriza para emplear las variables globales definidas:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">function</span> muestraContenido<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">readyState</span> <span class="sy0">==</span> READY_STATE_COMPLETE<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">status</span> <span class="sy0">==</span> <span class="nu0">200</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      alert<span class="br0">&#40;</span>peticion_http.<span class="me1">responseText</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Por último, la función <code>descargaArchivo()</code> simplemente realiza una llamada a la función <code>cargaContenido()</code> con los parámetros adecuados:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">function</span> descargaArchivo<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  cargaContenido<span class="br0">&#40;</span><span class="st0">&quot;http://localhost/holamundo.txt&quot;</span><span class="sy0">,</span> <span class="st0">&quot;GET&quot;</span><span class="sy0">,</span> muestraContenido<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>A continuación se muestra el código completo de la refactorización de la primera aplicación:</p>

<div class="code javascript">
<pre class="javascript"><span class="sy0">&lt;!</span>DOCTYPE html PUBLIC <span class="st0">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="st0">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span><span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>html<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>head<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>title<span class="sy0">&gt;</span>Hola Mundo con AJAX<span class="sy0">,</span> version <span class="nu0">2</span><span class="sy0">&lt;/</span>title<span class="sy0">&gt;</span>
&nbsp;
<span class="sy0">&lt;</span>script type<span class="sy0">=</span><span class="st0">&quot;text/javascript&quot;</span> language<span class="sy0">=</span><span class="st0">&quot;javascript&quot;</span><span class="sy0">&gt;</span>
&nbsp;
<span class="kw1">var</span> READY_STATE_UNINITIALIZED<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> 
<span class="kw1">var</span> READY_STATE_LOADING<span class="sy0">=</span><span class="nu0">1</span><span class="sy0">;</span> 
<span class="kw1">var</span> READY_STATE_LOADED<span class="sy0">=</span><span class="nu0">2</span><span class="sy0">;</span>
<span class="kw1">var</span> READY_STATE_INTERACTIVE<span class="sy0">=</span><span class="nu0">3</span><span class="sy0">;</span> 
<span class="kw1">var</span> READY_STATE_COMPLETE<span class="sy0">=</span><span class="nu0">4</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">var</span> peticion_http<span class="sy0">;</span>
&nbsp;
<span class="kw1">function</span> cargaContenido<span class="br0">&#40;</span>url<span class="sy0">,</span> metodo<span class="sy0">,</span> funcion<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  peticion_http <span class="sy0">=</span> inicializa_xhr<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    peticion_http.<span class="me1">onreadystatechange</span> <span class="sy0">=</span> funcion<span class="sy0">;</span>
    peticion_http.<span class="me1">open</span><span class="br0">&#40;</span>metodo<span class="sy0">,</span> url<span class="sy0">,</span> <span class="kw2">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
    peticion_http.<span class="me1">send</span><span class="br0">&#40;</span><span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">function</span> inicializa_xhr<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">XMLHttpRequest</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw1">new</span> XMLHttpRequest<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">&#40;</span>window.<span class="me1">ActiveXObject</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw1">new</span> ActiveXObject<span class="br0">&#40;</span><span class="st0">&quot;Microsoft.XMLHTTP&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">function</span> muestraContenido<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">readyState</span> <span class="sy0">==</span> READY_STATE_COMPLETE<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span><span class="br0">&#40;</span>peticion_http.<span class="me1">status</span> <span class="sy0">==</span> <span class="nu0">200</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      alert<span class="br0">&#40;</span>peticion_http.<span class="me1">responseText</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">function</span> descargaArchivo<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  cargaContenido<span class="br0">&#40;</span><span class="st0">&quot;http://localhost/holamundo.txt&quot;</span><span class="sy0">,</span> <span class="st0">&quot;GET&quot;</span><span class="sy0">,</span> muestraContenido<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
window.<span class="me1">onload</span> <span class="sy0">=</span> descargaArchivo<span class="sy0">;</span>
&nbsp;
<span class="sy0">&lt;/</span>script<span class="sy0">&gt;</span>
&nbsp;
<span class="sy0">&lt;/</span>head<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>body<span class="sy0">&gt;&lt;/</span>body<span class="sy0">&gt;</span>
<span class="sy0">&lt;/</span>html<span class="sy0">&gt;</span></pre>
</div>

<p><div class="exercise"><p class="title">Ejercicio 11</p> <p>A partir de la página web proporcionada, añadir el código JavaScript necesario para que:</p>

<ol>
<li>Al cargar la página, el cuadro de texto debe mostrar por defecto la URL de la propia página.</li>
<li>Al pulsar el botón "Mostrar Contenidos", se debe descargar mediante peticiones AJAX el contenido correspondiente a la URL introducida por el usuario. El contenido de la respuesta recibida del servidor se debe mostrar en la zona de "Contenidos del archivo".</li>
<li>En la zona "Estados de la petición" se debe mostrar en todo momento el estado en el que se encuentra la petición (No inicializada, cargando, completada, etc.)</li>
<li>Mostrar el contenido de todas las cabeceras de la respuesta del servidor en la zona "Cabeceras HTTP de la respuesta del servidor".</li>
<li>Mostrar el código y texto de estado de la respuesta del servidor en la zona "Código de estado".</li>
</ol>

<p><a href="/ejercicios/ajax/ejercicio11/ejercicio11.zip">Descargar archivo ZIP con la página HTML</a></p>

<p><a href="http://www.librosweb.es/ajax/capitulo14/ejercicio_11.html">Ver solución</a></p></div></p>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_7.html">
                        <strong>&larr; Anterior</strong>
                        <small>Capítulo 7. Primeros pasos con AJAX</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_7/metodos_y_propiedades_del_objeto_xmlhttprequest.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>7.3. Métodos y propiedades del objeto XMLHttpRequest</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a AJAX</a>
            </li>
                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> JavaScript básico</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> JavaScript avanzado</a>
            </li>
                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> DOM (Document Object Model)</a>
            </li>
                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> BOM (Browser Object Model)</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> Eventos</a>
            </li>
                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_7.html">
                    <span>Capítulo 7.</span> Primeros pasos con AJAX
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_7/la_primera_aplicacion.html">
                    <span>7.2.</span> La primera aplicación
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/metodos_y_propiedades_del_objeto_xmlhttprequest.html">
                    <span>7.3.</span> Métodos y propiedades del objeto XMLHttpRequest
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/utilidades_y_objetos_para_ajax.html">
                    <span>7.4.</span> Utilidades y objetos para AJAX
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/interaccion_con_el_servidor.html">
                    <span>7.5.</span> Interacción con el servidor
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/aplicaciones_complejas.html">
                    <span>7.6.</span> Aplicaciones complejas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/seguridad.html">
                    <span>7.7.</span> Seguridad
                </a>
            </li>
                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Técnicas básicas con AJAX</a>
            </li>
                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> Técnicas avanzadas con AJAX</a>
            </li>
                                                                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Frameworks y librerías</a>
            </li>
                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Otras utilidades</a>
            </li>
                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Recursos útiles</a>
            </li>
                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Bibliografía</a>
            </li>
                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Ejercicios resueltos</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
