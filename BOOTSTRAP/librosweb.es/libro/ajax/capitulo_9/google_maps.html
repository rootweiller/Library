<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>9.3. Google Maps (Introducción a AJAX)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                    <link rel="prev" href="../capitulo_9/lector_rss.html" />
                    <link rel="next" href="../capitulo_10.html" />
                <link rel="start" href="/libro/ajax/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="9.3. Google Maps (Introducción a AJAX)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page ajax"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/ajax/" itemprop="url">
                    <span itemprop="title">Introducción a AJAX</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/ajax/capitulo_9.html" itemprop="url">
                    <span itemprop="title">Capítulo 9. Técnicas avanzadas con AJAX</span>
                </a>
            </li>
        
            <li class="active">
                <span>9.3. Google Maps</span>
            </li>
        </ol>
    </div>

    <h1 id="google_maps" class="title">
        <span>9.3.</span> Google Maps
    </h1>

    

<h3 id="contexto_3">9.3.1. Contexto</h3>

<p>Google Maps fue una de las primeras aplicaciones basadas en AJAX de uso masivo por parte de los usuarios. Su gran éxito ha provocado que todos sus rivales hayan copiado el funcionamiento de sus mapas.</p>

<p>Además, Google ofrece de forma gratuita una API con la que poder desarrollar aplicaciones a medida basadas en los mapas de Google, integrar los mapas en otras aplicaciones e incluso hacer <em>"mash-up"</em> o mezclas de Google Maps y otras aplicaciones web que también disponen de una API pública.</p>

<h3 id="solucion_propuesta_3">9.3.2. Solución propuesta</h3>

<p>Antes de utilizar la API de los mapas de Google, es necesario obtener una clave personal y única para cada sitio web donde se quiere utilizar. El uso de la API es gratuito para cualquier aplicación que pueda ser accedida libremente por los usuarios. La clave de la API se puede obtener desde: http://www.google.com/apis/maps/</p>

<p>Para usos comerciales de la API también existen servicios de pago que requieren el uso de otras claves.</p>

<p>Las claves se solicitan por cada ruta del servidor. De esta forma, si se solicita una clave para http://www.misitio.com/ruta1, cualquier aplicación o página que se encuentre bajo esa ruta del servidor podrá hacer uso de la API de los mapas con esa clave.</p>

<p>Si no se dispone de un sitio web público, es posible indicar como servidor el valor <code>http://localhost</code> para poder hacer pruebas en un servidor local. Para solicitar la clave, es necesario disponer de una cuenta de usuario de Google (se puede utilizar por ejemplo la cuenta de Gmail). La clave generada depende por tanto del dominio de la aplicación y de la cuenta de usuario.</p>

<p>Las claves de la API de Google Maps consisten en una cadena de texto muy larga con un aspecto similar al siguiente: <code>ABQIAAAA30JtKUU8se-7KKPRGSfCMBT2yXp_ZAY8_ufC3CFXhHIE1NvwkxRZNdns2BwZvEY-V68DvlyUYwi1-Q</code>.</p>

<p>Una vez obtenida la clave, cualquier página que quiera hacer uso de la API debe enlazar el siguiente archivo de JavaScript:</p>

<div class="code html5">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">script</span> <span class="kw3">src</span><span class="sy0">=</span><span class="st0">&quot;http://maps.google.com/maps?file=api&amp;amp;v=2&amp;amp;hl=es&amp;amp;key=ABQIAAAA30JtKUU8se-7KKPRGSfCMBT2yXp_ZAY8_ufC3CFXhHIE1NvwkxRZNdns2BwZvEY-V68DvlyUYwi1-Q&quot;</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text/javascript&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span></pre>
</div>

<p>Los parámetros necesarios son <code>file</code>, que indica el tipo de archivo que se quiere cargar (en este caso la API), <code>v</code>, que indica la versión de la API (en este caso <code>2</code>), <code>hl</code>, que permite indicar el idioma en el que se muestran los mapas (si no se indica este parámetro, los mapas se muestran en inglés) y el parámetro <code>key</code>, que contiene la clave que se acaba de obtener.</p>

<p>Una vez obtenida la clave, es muy sencillo crear el primer mapa de Google:</p>

<div class="code html5">
<pre class="html5"><span class="sc0">&lt;!DOCTYPE HTML PUBLIC &quot; *W3C*DTD HTML 4.01//EN&quot;</span>
<span class="sc0">  &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;</span>
<span class="sc2">&lt;<span class="kw2">html</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">head</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">meta</span> <span class="kw3">http-equiv</span><span class="sy0">=</span><span class="st0">&quot;Content-Type&quot;</span> <span class="kw3">content</span><span class="sy0">=</span><span class="st0">&quot;text/html; charset=iso-8859-1&quot;</span> <span class="sy0">/</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">title</span>&gt;</span>Ejemplo de uso de Google Maps<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">title</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">script</span> <span class="kw3">src</span><span class="sy0">=</span><span class="st0">&quot;http://maps.google.com/maps?file=api&amp;amp;v=2&amp;amp;hl=es&amp;amp;key=ABQIAAAA30JtKUU8se-7KKPRGSfCMBT2yXp_ZAY8_ufC3CFXhHIE1NvwkxRZNdns2BwZvEY-V68DvlyUYwi1-Q&quot;</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text/javascript&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span>
<span class="sc2">&lt;<span class="kw2">script</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text/javascript&quot;</span>&gt;</span>
function load() {
  if (GBrowserIsCompatible()) {
    var latitud = 48.858729;
    var longitud = 2.352448;
    var zoom = 15;
    var mapa = new GMap2(document.getElementById(&quot;mapa&quot;));
    mapa.setCenter(new GLatLng(latitud, longitud), zoom);
  }
}
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">head</span>&gt;</span>
&nbsp;
<span class="sc2">&lt;<span class="kw2">body</span> <span class="kw3">onload</span><span class="sy0">=</span><span class="st0">&quot;load()&quot;</span> <span class="kw3">onunload</span><span class="sy0">=</span><span class="st0">&quot;GUnload()&quot;</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;mapa&quot;</span> <span class="kw3">style</span><span class="sy0">=</span><span class="st0">&quot;width: 500px; height: 400px&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">body</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">html</span>&gt;</span></pre>
</div>

<p>El anterior código HTML y JavaScript genera el siguiente mapa:</p>

<div class="figure" id="figure_9_5">
    <img src="/img/ajax/f0905.gif" alt="Mapa sencillo creado con la API de Google Maps y las coordenadas de longitud y latitud indicadas" />

    <p class="caption"><strong>Figura 9.5</strong> Mapa sencillo creado con la API de Google Maps y las coordenadas de longitud y latitud indicadas</p>
</div>


<p>En primer lugar, se define un elemento (normalmente un <code>&lt;div&gt;</code>) en el que se mostrará el mapa. El tamaño del mapa será igual al tamaño de su elemento contenedor, a no ser que se indique explícitamente otro tamaño:</p>

<div class="code html5">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;mapa&quot;</span> <span class="kw3">style</span><span class="sy0">=</span><span class="st0">&quot;width: 500px; height: 400px&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span></pre>
</div>

<p>Una vez definido el contenedor del mapa, se establecen los eventos necesarios en la página que lo contiene:</p>

<div class="code html5">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">body</span> <span class="kw3">onload</span><span class="sy0">=</span><span class="st0">&quot;load()&quot;</span> <span class="kw3">onunload</span><span class="sy0">=</span><span class="st0">&quot;GUnload()&quot;</span>&gt;</span></pre>
</div>

<p>Los ejemplos que se pueden consultar en la documentación de Google utilizan esa asignación directa de eventos en la etiqueta <code>&lt;body&gt;</code>. Evidentemente, los eventos también se podrían asignar de forma <em>semántica</em> mediante el siguiente código:</p>

<div class="code html5">
<pre class="html5">window.onload = load;
window.onunload = GUnload;</pre>
</div>

<p>La función <code>load()</code> es la que se ejecuta al cargar la página y la que establece las opciones con las que se crea el mapa. En primer lugar, se ejecuta la función <code>GBrowserIsCompatible()</code>, que indica si el navegador actual del usuario es compatible con el uso de los mapas de Google. En caso contrario, no se ejecutan las instrucciones y no se muestra el mapa:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">if</span> <span class="br0">&#40;</span>GBrowserIsCompatible<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  ...
<span class="br0">&#125;</span></pre>
</div>

<p>Para crear un nuevo mapa, se utiliza la clase <code>GMap2</code>, que representa un mapa en una página. Las páginas pueden contener más de un mapa, pero cada uno de ellos hace referencia a una instancia diferente de la clase <code>GMap2</code>. El único argumento obligatorio para crear el mapa es la referencia al elemento que contendrá el mapa (obtenida mediante su <code>id</code>):</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">var</span> mapa <span class="sy0">=</span> <span class="kw1">new</span> GMap2<span class="br0">&#40;</span>document.<span class="me1">getElementById</span><span class="br0">&#40;</span><span class="st0">&quot;mapa&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Una vez instanciada la clase <code>GMap2</code>, el mapa ya ha sido creado. Sin embargo, el mapa no se muestra correctamente hasta que se indique en que punto geográfico está centrado. El método <code>setCenter()</code> permite centrar un mapa y opcionalmente, indicar el nivel de zoom y el tipo de mapa que se muestra:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">var</span> latitud <span class="sy0">=</span> <span class="nu0">42.845007</span><span class="sy0">;</span>
<span class="kw1">var</span> longitud <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">2.673</span><span class="sy0">;</span>
<span class="kw1">var</span> zoom <span class="sy0">=</span> <span class="nu0">15</span><span class="sy0">;</span>
mapa.<span class="me1">setCenter</span><span class="br0">&#40;</span><span class="kw1">new</span> GLatLng<span class="br0">&#40;</span>latitud<span class="sy0">,</span> longitud<span class="br0">&#41;</span><span class="sy0">,</span> zoom<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>El punto geográfico en el que está centrado el mapa se indica mediante un objeto de tipo <code>GLatLng()</code> que toma dos parámetros: el primero es el valor de la latitud del punto geográfico y el otro parámetro indica la longitud de esa posición geográfica. De forma opcional se puede indicar el nivel de zoom del mapa.</p>

<p>La latitud puede tomar un valor entre <code>+90</code> (<code>90</code> grados al norte del ecuador) y <code>-90</code> (<code>90</code> grados al sur del ecuador), la longitud puede tomar un valor entre <code>+180</code> (<code>180</code> grados al este de Greenwitch) y <code>-180</code> (<code>180</code> grados al oeste de Greenwitch). El nivel de zoom puede variar entre <code>1</code> (en el que se ve la Tierra entera) y <code>18</code> (en el que se ven los detalles de cada calle). No obstante, se debe tener en cuenta que no todos los puntos geográficos disponen de todos los niveles de zoom.</p>

<p>Después de crear un mapa básico, es muy sencillo añadir los controles para aumentar o disminuir el nivel de zoom y el control que indica el tipo de mapa que se muestra:</p>

<div class="code javascript">
<pre class="javascript">mapa.<span class="me1">addControl</span><span class="br0">&#40;</span><span class="kw1">new</span> GSmallMapControl<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
mapa.<span class="me1">addControl</span><span class="br0">&#40;</span><span class="kw1">new</span> GMapTypeControl<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Ahora, el mapa permite variar el nivel de zoom y mostrar otro tipo de mapa, como se muestra en la siguiente imagen:</p>

<div class="figure" id="figure_9_6">
    <img src="/img/ajax/f0906.gif" alt="Mapa sencillo creado con la API de Google Maps y que permite variar su nivel de zoom y el tipo de mapa que se muestra" />

    <p class="caption"><strong>Figura 9.6</strong> Mapa sencillo creado con la API de Google Maps y que permite variar su nivel de zoom y el tipo de mapa que se muestra</p>
</div>


<p>Google Maps incluye una documentación muy extensa sobre el uso de la API y todos los métodos disponibles. La documentación inicial con ejemplos básicos se puede consultar en: http://www.google.com/apis/maps/documentation/</p>

<p>La referencia completa de clases, propiedades y métodos de la API está disponible en: http://www.google.com/apis/maps/documentation/reference.html</p>

<p>Los mapas de Google permiten controlar un gran número de eventos, pudiendo asociar funciones o ejecutar directamente código JavaScript cada vez que se produce un evento. El siguiente ejemplo muestra un mensaje de tipo <code>alert()</code> con las coordenadas del centro del mapa cada vez que el usuario suelta el mapa después de haberlo movido:</p>

<div class="code javascript">
<pre class="javascript">GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>mapa<span class="sy0">,</span> <span class="st0">&quot;moveend&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">var</span> centro <span class="sy0">=</span> mapa.<span class="me1">getCenter</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  alert<span class="br0">&#40;</span>centro.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Además del evento <code>moveend</code> existen muchos otros, como por ejemplo <code>move</code> que permite ejecutar cualquier función de forma repetida a medida que el usuario mueve el mapa. Los mapas también permiten colocar marcadores para mostrar una posición. El siguiente ejemplo hace uso del evento <code>click</code> sobre los mapas para mostrar marcadores:</p>

<div class="code javascript">
<pre class="javascript">GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>mapa<span class="sy0">,</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span>marcador<span class="sy0">,</span> punto<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  mapa.<span class="me1">addOverlay</span><span class="br0">&#40;</span><span class="kw1">new</span> GMarker<span class="br0">&#40;</span>punto<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Ahora, cada vez que se pulsa sobre un punto del mapa, se añade un nuevo marcador en ese punto:</p>

<div class="figure" id="figure_9_7">
    <img src="/img/ajax/f0907.gif" alt="Los eventos de la API de los mapas de Google permiten añadir marcadores de posición cada vez que se pincha en un punto del mapa" />

    <p class="caption"><strong>Figura 9.7</strong> Los eventos de la API de los mapas de Google permiten añadir marcadores de posición cada vez que se pincha en un punto del mapa</p>
</div>


<p>Modificando ligeramente el ejemplo anterior, es posible borrar un marcador si se pulsa sobre el:</p>

<div class="code javascript">
<pre class="javascript">GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>mapa<span class="sy0">,</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span>marcador<span class="sy0">,</span> punto<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>marcador<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    mapa.<span class="me1">removeOverlay</span><span class="br0">&#40;</span>marcador<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
    mapa.<span class="me1">addOverlay</span><span class="br0">&#40;</span><span class="kw1">new</span> GMarker<span class="br0">&#40;</span>punto<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Modificando de nuevo el código anterior, es posible añadir eventos a los marcadores para que cada vez que se pinche en uno de ellos se muestre un mensaje con sus coordenadas geográficas:</p>

<div class="code javascript">
<pre class="javascript">GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>mapa<span class="sy0">,</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span>marcador<span class="sy0">,</span> punto<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">var</span> nuevoMarcador <span class="sy0">=</span> <span class="kw1">new</span> GMarker<span class="br0">&#40;</span>punto<span class="br0">&#41;</span><span class="sy0">;</span>
  GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>nuevoMarcador<span class="sy0">,</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">this</span>.<span class="me1">openInfoWindowHtml</span><span class="br0">&#40;</span><span class="st0">&quot;Lat: &quot;</span> <span class="sy0">+</span> <span class="kw1">this</span>.<span class="me1">getPoint</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">lat</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;&lt;br/&gt;Lon: &quot;</span> <span class="sy0">+</span> <span class="kw1">this</span>.<span class="me1">getPoint</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">lng</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  mapa.<span class="me1">addOverlay</span><span class="br0">&#40;</span>nuevoMarcador<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<div class="figure" id="figure_9_8">
    <img src="/img/ajax/f0908.gif" alt="Al pulsar sobre cada marcador de posición en el mapa, se muestra un mensaje informando sobre la longitud y latitud de la posición del marcador" />

    <p class="caption"><strong>Figura 9.8</strong> Al pulsar sobre cada marcador de posición en el mapa, se muestra un mensaje informando sobre la longitud y latitud de la posición del marcador</p>
</div>


<p>A continuación se muestra la explicación detallada del código anterior. En primer lugar se establece un nuevo evento cada vez que se pincha sobre el mapa:</p>

<div class="code javascript">
<pre class="javascript">GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>mapa<span class="sy0">,</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span>marcador<span class="sy0">,</span> punto<span class="br0">&#41;</span> <span class="br0">&#123;</span></pre>
</div>

<p>Cada vez que se pincha, se crea un nuevo marcador con las coordenadas de la posición en la que se ha pinchado:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">var</span> nuevoMarcador <span class="sy0">=</span> <span class="kw1">new</span> GMarker<span class="br0">&#40;</span>punto<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Antes de mostrar el marcador en el mapa, se añade un evento al propio marcador, que se ejecutará cada vez que se pinche sobre el:</p>

<div class="code javascript">
<pre class="javascript">GEvent.<span class="me1">addListener</span><span class="br0">&#40;</span>nuevoMarcador<span class="sy0">,</span> <span class="st0">&quot;click&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></pre>
</div>

<p>El método <code>openInfoWindowHtml()</code> permite mostrar una pequeña ventana con un mensaje que puede contener código HTML. Dentro de la función manejadora del evento, la variable <code>this</code> se resuelve en el propio marcador, por lo que se puede hacer uso de ella para obtener sus coordenadas y para mostrar el mensaje:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">this</span>.<span class="me1">openInfoWindowHtml</span><span class="br0">&#40;</span><span class="st0">&quot;Lat: &quot;</span> <span class="sy0">+</span> <span class="kw1">this</span>.<span class="me1">getPoint</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">lat</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;&lt;br/&gt;Lon: &quot;</span> <span class="sy0">+</span> <span class="kw1">this</span>.<span class="me1">getPoint</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">lng</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Por último, se añade el marcador al mapa:</p>

<div class="code javascript">
<pre class="javascript">mapa.<span class="me1">addOverlay</span><span class="br0">&#40;</span>nuevoMarcador<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p><div class="exercise"><p class="title">Ejercicio 22</p> <p>Partiendo del mapa básico que se acaba de crear, se pide:</p>

<p>1) En la misma página se debe incluir otro mapa que muestre las antípodas del punto geográfico inicial del primer mapa. Este segundo mapa no debe mostrar ningún control de zoom ni de tipo de mapa.</p>

<div class="figure" id="figure_9_9">
    <img src="/img/ajax/f0909.gif" alt="Aspecto del mapa principal y del mapa secundario que muestra el lugar geográfico definido como &quot;antípodas&quot; del lugar mostrado en el mapa principal" />

    <p class="caption"><strong>Figura 9.9</strong> Aspecto del mapa principal y del mapa secundario que muestra el lugar geográfico definido como &quot;antípodas&quot; del lugar mostrado en el mapa principal</p>
</div>


<p>2) Al mover el primer mapa, el segundo mapa debe mostrar en todo momento las antípodas de ese lugar. Además, el zoom y el tipo de mapa también debe estar sincronizado, de forma que el segundo mapa muestre en todo momento el mismo nivel de zoom y el mismo tipo de mapa que el primero.</p>

<p>3) Cuando se pinche en el primer mapa, se muestra un marcador con su longitud y su latitud. Además, automáticamente se crea un marcador en el segundo mapa indicando el lugar exacto que corresponde a su antípoda.</p>

<div class="figure" id="figure_9_10">
    <img src="/img/ajax/f0910.gif" alt="Cuando se crea un marcador en el mapa principal, automáticamente debe crearse otro marcador de posición en el lugar geográfico correspondiente a su antípoda" />

    <p class="caption"><strong>Figura 9.10</strong> Cuando se crea un marcador en el mapa principal, automáticamente debe crearse otro marcador de posición en el lugar geográfico correspondiente a su antípoda</p>
</div>


<p><a href="http://www.librosweb.es/ajax/capitulo14/ejercicio_22.html">Ver solución</a></p></div></p>

<p><div class="exercise"><p class="title">Ejercicio 23</p> <p>La disponibilidad de una API pública, sencilla, gratuita y muy potente permite integrar los mapas de Google con cualquier otra aplicación abierta que genere información geoespacial.</p>

<p>Un ejemplo típico de esta mezcla de aplicaciones es la información metereológica. Con la ayuda de los mapas de Google, es posible mostrar en cada punto del mapa la previsión metereológica en forma de marcador de posición con un icono personalizado, tal y como se muestra en la siguiente imagen:</p>

<div class="figure" id="figure_9_11">
    <img src="/img/ajax/f0911.gif" alt="Mapa de previsión metereológica construido con los mapas de Google y que utiliza iconos personalizados para mostrar cada marcador de posición" />

    <p class="caption"><strong>Figura 9.11</strong> Mapa de previsión metereológica construido con los mapas de Google y que utiliza iconos personalizados para mostrar cada marcador de posición</p>
</div>


<p>1) Mostrar un mapa de Google de tamaño <code>600x600</code> píxel, centrado en <code>[40.41558722527384, -3.6968994140625]</code>, que muestre por defecto el mapa de tipo satélite y que no incluya ningún tipo de control.</p>

<p>2) Cada cierto tiempo se debe mostrar la previsión meteorológica descargada desde el servidor. El script del servidor se denomina <code>previsionMeteorologica.php</code> y no es necesario pasar ningún parámetro. El servidor devuelve un array en formato JSON con la lista de puntos geográficos junto con su previsión meteorológica:</p>

<div class="code javascript">
<pre class="javascript"><span class="br0">&#91;</span> 
<span class="br0">&#123;</span> latlon<span class="sy0">:</span> <span class="br0">&#91;</span><span class="nu0">42.779275360242</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">2.63671875</span><span class="br0">&#93;</span><span class="sy0">,</span> prediccion<span class="sy0">:</span> <span class="st0">&quot;tormentas&quot;</span> <span class="br0">&#125;</span><span class="sy0">,</span> 
<span class="br0">&#123;</span> latlon<span class="sy0">:</span> <span class="br0">&#91;</span><span class="nu0">43.245202722034</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">8.32763671875</span><span class="br0">&#93;</span><span class="sy0">,</span> prediccion<span class="sy0">:</span> <span class="st0">&quot;nieve&quot;</span> <span class="br0">&#125;</span><span class="sy0">,</span> 
<span class="br0">&#123;</span> latlon<span class="sy0">:</span> <span class="br0">&#91;</span><span class="nu0">42.228517356209</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">7.36083984375</span><span class="br0">&#93;</span><span class="sy0">,</span> prediccion<span class="sy0">:</span> <span class="st0">&quot;lluvia&quot;</span> <span class="br0">&#125;</span><span class="sy0">,</span> 
...
<span class="br0">&#123;</span> latlon<span class="sy0">:</span> <span class="br0">&#91;</span><span class="nu0">41.54147766679</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">3.75732421875</span><span class="br0">&#93;</span><span class="sy0">,</span> prediccion<span class="sy0">:</span> <span class="st0">&quot;nublado&quot;</span> <span class="br0">&#125;</span><span class="sy0">,</span>
<span class="br0">&#93;</span></pre>
</div>

<p>3) La información meteorológica de cada punto se muestra mediante un marcador personalizado. Pistas: la clase <code>GMarkerManager</code> permite gestionar conjuntos grandes de marcadores. La clase <code>GMarker</code> permite definir un icono personalizado para el marcador. La clase <code>GIcon</code> permite crear nuevos iconos listos para los marcadores. En la carpeta <code>imagenes</code> se proporcionan iconos para cada una de las condiciones meteorológicas: <code>lluvia.png</code>, <code>nieve.png</code>, <code>nublado.png</code>, etc. Las imágenes utilizadas en este ejemplo, pertenecen al excelente conjunto de <a href="http://tango.freedesktop.org/Tango_Desktop_Project">iconos del proyecto Tango</a>.</p>

<p><a href="/ejercicios/ajax/ejercicio23/ejercicio23.zip">Descargar archivo ZIP con las imágenes y el script previsionMeteorologica.php</a></p>

<p><a href="http://www.librosweb.es/ajax/capitulo14/ejercicio_23.html">Ver solución</a></p></div></p>


            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_9/lector_rss.html">
                        <strong>&larr; Anterior</strong>
                        <small>9.2. Lector RSS</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_10.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>Capítulo 10. Frameworks y librerías</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Introducción a AJAX</a>
            </li>
                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> JavaScript básico</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> JavaScript avanzado</a>
            </li>
                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> DOM (Document Object Model)</a>
            </li>
                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> BOM (Browser Object Model)</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> Eventos</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Primeros pasos con AJAX</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> Técnicas básicas con AJAX</a>
            </li>
                                                                            <li class="level-1 ">
                <a href="../capitulo_9.html">
                    <span>Capítulo 9.</span> Técnicas avanzadas con AJAX
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_9/lector_rss.html">
                    <span>9.2.</span> Lector RSS
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_9/google_maps.html">
                    <span>9.3.</span> Google Maps
                </a>
            </li>
                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Frameworks y librerías</a>
            </li>
                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Otras utilidades</a>
            </li>
                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Recursos útiles</a>
            </li>
                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Bibliografía</a>
            </li>
                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> Ejercicios resueltos</a>
            </li>
                                                                                                                                                                                                                                                                                                                                                                                                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
