<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>13.5. Usuarios (Symfony 2.3, el libro oficial)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                            
        <link rel="canonical" href="/libro/symfony_2_x/capitulo_13/usuarios.html"/>
                                    <link rel="prev" href="../capitulo_13/autorizacion.html" />
                    <link rel="next" href="../capitulo_13/roles.html" />
                <link rel="start" href="/libro/symfony_2_3/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="13.5. Usuarios (Symfony 2.3, el libro oficial)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_2_3"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_2_3/" itemprop="url">
                    <span itemprop="title">Symfony 2.3, el libro oficial</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_2_3/capitulo_13.html" itemprop="url">
                    <span itemprop="title">Capítulo 13. Seguridad</span>
                </a>
            </li>
        
            <li class="active">
                <span>13.5. Usuarios</span>
            </li>
        </ol>
    </div>

    <h1 id="usuarios" class="title">
        <span>13.5.</span> Usuarios
    </h1>

    

<p>En las secciones anteriores, se explicó cómo utilizar los roles para proteger diferentes recursos. En esta sección se va a explorar la otra parte de la autorización: los usuarios.</p>

<h3 id="de_donde_provienen_los_usuarios">13.5.1. ¿De dónde provienen los usuarios?</h3>

<p>Durante la autenticación, el usuario envía un conjunto de credenciales (por lo general un nombre de usuario y contraseña). El trabajo del sistema de autenticación es verificar esas credenciales utilizando la lista completa de usuarios de la aplicación. La pregunta es, ¿de dónde provienen los usuarios de esa lista?</p>

<p>En Symfony2, los usuarios pueden venir de varios sitios diferentes: un archivo de configuración, una tabla de base de datos, un servicio web, o cualquier otra cosa que se te ocurra. Cualquier elemento que proporcione uno o más usuarios al sistema de autenticación se conoce como <em>proveedor de usuarios</em>.</p>

<p>Symfony2 incluye de serie los dos proveedores de usuarios más comunes: uno que carga los usuarios de un archivo de configuración y otro que carga usuarios de una tabla de la base de datos.</p>

<h4 id="definiendo_usuarios_en_un_archivo_de_configuracion">13.5.1.1. Definiendo usuarios en un archivo de configuración</h4>

<p>La forma más fácil para especificar los usuarios de la aplicación consiste en utilizar directamente un archivo de configuración. De hecho, esto es lo que ya has visto en los ejemplos de las secciones anteriores.</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_68827" class="active"><a data-toggle="tab active" href="#select_tab_1_68827" onclick="document.getElementById('select_tab_1_68827').className='active'; document.getElementById('tab_1_68827').className='tab-pane active';document.getElementById('select_tab_2_68827').className='';  document.getElementById('tab_2_68827').className='tab-pane';document.getElementById('select_tab_3_68827').className='';  document.getElementById('tab_3_68827').className='tab-pane';return false;">YAML</a></li><li id="select_tab_2_68827"><a data-toggle="tab" href="#select_tab_2_68827" onclick="document.getElementById('select_tab_1_68827').className='';  document.getElementById('tab_1_68827').className='tab-pane';document.getElementById('select_tab_2_68827').className='active'; document.getElementById('tab_2_68827').className='tab-pane active';document.getElementById('select_tab_3_68827').className='';  document.getElementById('tab_3_68827').className='tab-pane';return false;">XML</a></li><li id="select_tab_3_68827"><a data-toggle="tab" href="#select_tab_3_68827" onclick="document.getElementById('select_tab_1_68827').className='';  document.getElementById('tab_1_68827').className='tab-pane';document.getElementById('select_tab_2_68827').className='';  document.getElementById('tab_2_68827').className='tab-pane';document.getElementById('select_tab_3_68827').className='active'; document.getElementById('tab_3_68827').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_68827">
<div class="code yaml">
<pre class="yaml"><span class="co1"># app/config/security.yml</span><span class="co4">
security</span><span class="sy2">:
</span>    <span class="co1"># ...</span><span class="co4">
    providers</span>:<span class="co4">
        default_provider</span>:<span class="co4">
            memory</span>:<span class="co4">
                users</span>:<span class="co3">
                    ryan</span><span class="sy2">: </span> <span class="br0">&#123;</span> password<span class="sy2">: </span>ryanpass, roles<span class="sy2">: </span>'ROLE_USER' <span class="br0">&#125;</span><span class="co3">
                    admin</span><span class="sy2">: </span><span class="br0">&#123;</span> password<span class="sy2">: </span>kitten, roles<span class="sy2">: </span>'ROLE_ADMIN' <span class="br0">&#125;</span></pre>
</div>
</div>


<div class="tab-pane" id="tab_2_68827">
<div class="code xml">
<pre class="xml"><span class="sc-1">&lt;!-- app/config/security.xml --&gt;</span>
<span class="sc3"><span class="re1">&lt;config<span class="re2">&gt;</span></span></span>
    <span class="sc-1">&lt;!-- ... --&gt;</span>
    <span class="sc3"><span class="re1">&lt;provider</span> <span class="re0">name</span>=<span class="st0">&quot;default_provider&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;memory<span class="re2">&gt;</span></span></span>
            <span class="sc3"><span class="re1">&lt;user</span> <span class="re0">name</span>=<span class="st0">&quot;ryan&quot;</span> <span class="re0">password</span>=<span class="st0">&quot;ryanpass&quot;</span> <span class="re0">roles</span>=<span class="st0">&quot;ROLE_USER&quot;</span> <span class="re2">/&gt;</span></span>
            <span class="sc3"><span class="re1">&lt;user</span> <span class="re0">name</span>=<span class="st0">&quot;admin&quot;</span> <span class="re0">password</span>=<span class="st0">&quot;kitten&quot;</span> <span class="re0">roles</span>=<span class="st0">&quot;ROLE_ADMIN&quot;</span> <span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;/memory<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/config<span class="re2">&gt;</span></span></span></pre>
</div>
</div>


<div class="tab-pane" id="tab_3_68827">
<div class="code php">
<pre class="php"><span class="co1">// app/config/security.php</span>
<span class="re0">$container</span><span class="sy0">-&gt;</span><span class="me1">loadFromExtension</span><span class="br0">&#40;</span><span class="st_h">'security'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="sy0">...,</span>
    <span class="st_h">'providers'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'default_provider'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'memory'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                <span class="st_h">'users'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                    <span class="st_h">'ryan'</span>  <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                        <span class="st_h">'password'</span> <span class="sy0">=&gt;</span> <span class="st_h">'ryanpass'</span><span class="sy0">,</span>
                        <span class="st_h">'roles'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'ROLE_USER'</span>
                    <span class="br0">&#41;</span><span class="sy0">,</span>
                    <span class="st_h">'admin'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                        <span class="st_h">'password'</span> <span class="sy0">=&gt;</span> <span class="st_h">'kitten'</span><span class="sy0">,</span>
                        <span class="st_h">'roles'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'ROLE_ADMIN'</span>
                    <span class="br0">&#41;</span><span class="sy0">,</span>
                <span class="br0">&#41;</span><span class="sy0">,</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</div>

  </div>
</div>

<p>Este proveedor se denomina <em>roveedor de usuarios en memoria</em>, ya que los usuarios no se almacenan en ninguna base de datos. El objeto que representa realmente al usuario lo proporciona Symfony a través de la clase <code>User</code>.</p>

<div class="admonition tip"><p><strong class="title">Truco</strong> Cualquier proveedor de usuarios puede cargar usuarios directamente desde un archivo simplemente especificando la opción de configuración <code>users</code> y después la lista de usuarios.</p></div>

<div class="admonition caution"><p><strong class="title">Advertencia</strong> Si el nombre de algún usuario está formado exclusivamente por números (por ejemplo, <code>77</code>) o contiene un guión medio (por ejemplo, <code>user-name</code>), debes utilizar la sintaxis alternativa al especificar los usuarios en el archivo YAML:</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">users</span>:<span class="co3">
    - { name</span><span class="sy2">: </span><span class="nu0">77</span>, password<span class="sy2">: </span>pass, roles<span class="sy2">: </span>'ROLE_USER' <span class="br0">&#125;</span><span class="co3">
    - { name</span><span class="sy2">: </span>user-name, password<span class="sy2">: </span>pass, roles<span class="sy2">: </span>'ROLE_USER' <span class="br0">&#125;</span></pre>
</div>

<p></p></div>

<p>Para sitios pequeños, este método es rápido y fácil de configurar. Para aplicaciones más complejas, será mejor que cargues los usuarios desde la base de datos.</p>

<h4 id="cargando_usuarios_desde_la_base_de_datos">13.5.1.2. Cargando usuarios desde la base de datos</h4>

<p>Si quieres cargar tus usuarios a través del ORM de Doctrine, lo puedes hacer creando una clase <code>User</code> y configurando el proveedor <code>entity</code>.</p>

<div class="admonition tip"><p><strong class="title">Truco</strong> <a href="http://www.symfony.es/bundles/friendsofsymfony/fosuserbundle/">FOSUserBundle</a> es un <em>bundle</em> de alta calidad y publicado como software libre que te permite almacenar tus usuarios utilizando el ORM o el ODM de Doctrine.</p></div>

<p>Así que primero tienes que crear tu propia clase de tipo <code>User</code>, para después almacenar sus datos en la base de datos.</p>

<div class="code php">
<pre class="php"><span class="co1">// src/Acme/UserBundle/Entity/User.php</span>
<span class="kw2">namespace</span> Acme\UserBundle\Entity<span class="sy0">;</span>
&nbsp;
<span class="kw2">use</span> Symfony\Component\Security\Core\User\UserInterface<span class="sy0">;</span>
<span class="kw2">use</span> Doctrine\ORM\Mapping <span class="kw1">as</span> ORM<span class="sy0">;</span>
&nbsp;
<span class="co4">/**
 * @ORM\Entity
 */</span>
<span class="kw2">class</span> User implements UserInterface
<span class="br0">&#123;</span>
    <span class="co4">/**
     * @ORM\Column(type=&quot;string&quot;, length=255)
     */</span>
    <span class="kw2">protected</span> <span class="re0">$username</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// ...</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Por lo que respecta al sistema de seguridad, el único requisito que debe cumplir la clase es que implemente la interfaz <code>UserInterface</code>. Esto significa que el concepto que tu tengas de lo que es un usuario puede ser cualquier cosa, siempre y cuando implemente esta interfaz.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> El objeto que representa al usuario se serializa y se guarda en la sesión de una petición a otra. Así que es recomendable que tu clase implemente la interfaz <code>Serializable</code>. Esto es sobre todo necesario cuando la clase de usuario extiende de otra clase que tiene propiedades privadas.</p></div>

<p>A continuación, configura un proveedor de usuarios de tipo <code>entity</code> y haz que apunte a la clase <code>User</code> que acabas de definir:</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_689b6" class="active"><a data-toggle="tab active" href="#select_tab_1_689b6" onclick="document.getElementById('select_tab_1_689b6').className='active'; document.getElementById('tab_1_689b6').className='tab-pane active';document.getElementById('select_tab_2_689b6').className='';  document.getElementById('tab_2_689b6').className='tab-pane';document.getElementById('select_tab_3_689b6').className='';  document.getElementById('tab_3_689b6').className='tab-pane';return false;">YAML</a></li><li id="select_tab_2_689b6"><a data-toggle="tab" href="#select_tab_2_689b6" onclick="document.getElementById('select_tab_1_689b6').className='';  document.getElementById('tab_1_689b6').className='tab-pane';document.getElementById('select_tab_2_689b6').className='active'; document.getElementById('tab_2_689b6').className='tab-pane active';document.getElementById('select_tab_3_689b6').className='';  document.getElementById('tab_3_689b6').className='tab-pane';return false;">XML</a></li><li id="select_tab_3_689b6"><a data-toggle="tab" href="#select_tab_3_689b6" onclick="document.getElementById('select_tab_1_689b6').className='';  document.getElementById('tab_1_689b6').className='tab-pane';document.getElementById('select_tab_2_689b6').className='';  document.getElementById('tab_2_689b6').className='tab-pane';document.getElementById('select_tab_3_689b6').className='active'; document.getElementById('tab_3_689b6').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_689b6">
<div class="code yaml">
<pre class="yaml"><span class="co1"># app/config/security.yml</span><span class="co4">
security</span>:<span class="co4">
    providers</span>:<span class="co4">
        main</span>:<span class="co3">
            entity</span><span class="sy2">: </span><span class="br0">&#123;</span> class<span class="sy2">: </span>Acme\UserBundle\Entity\User, property<span class="sy2">: </span>username <span class="br0">&#125;</span></pre>
</div>
</div>


<div class="tab-pane" id="tab_2_689b6">
<div class="code xml">
<pre class="xml"><span class="sc-1">&lt;!-- app/config/security.xml --&gt;</span>
<span class="sc3"><span class="re1">&lt;config<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;provider</span> <span class="re0">name</span>=<span class="st0">&quot;main&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;entity</span> <span class="re0">class</span>=<span class="st0">&quot;Acme\UserBundle\Entity\User&quot;</span> <span class="re0">property</span>=<span class="st0">&quot;username&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/config<span class="re2">&gt;</span></span></span></pre>
</div>
</div>


<div class="tab-pane" id="tab_3_689b6">
<div class="code php">
<pre class="php"><span class="co1">// app/config/security.php</span>
<span class="re0">$container</span><span class="sy0">-&gt;</span><span class="me1">loadFromExtension</span><span class="br0">&#40;</span><span class="st_h">'security'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'providers'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'main'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'entity'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                <span class="st_h">'class'</span> <span class="sy0">=&gt;</span> <span class="st_h">'Acme\UserBundle\Entity\User'</span><span class="sy0">,</span>
                <span class="st_h">'property'</span> <span class="sy0">=&gt;</span> <span class="st_h">'username'</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</div>

  </div>
</div>

<p>Este nuevo proveedor hace que el sistema de autenticación intente cargar los objetos de tipo <code>User</code> desde la base de datos utilizando el campo <code>username</code> de esa clase.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Este ejemplo sólo muestra las opciones más básicas del proveedor <code>entity</code>. Para ver un ejemplo completo, consulta el artículo <a href="http://symfony.com/doc/2.0/cookbook/security/entity_provider.html">How to load Security Users from the Database (the Entity Provider)</a>.</p></div>

<p>Para más información sobre cómo crear tu propio proveedor de usuarios (por si quieres cargar por ejemplo tus usuarios a través de un servicio web) consulta el artículo <a href="http://symfony.com/doc/2.0/cookbook/security/custom_provider.html">How to create a custom User Provider</a>.</p>

<h3 id="codificando_la_contrasena_del_usuario">13.5.2. Codificando la contraseña del usuario</h3>

<p>Hasta ahora, y por simplicidad, todos los ejemplos almacenan las contraseñas de los usuarios en claro (tanto si se guardan en un archivo de configuración como si se guardan en la base de datos). Obviamente, en una aplicación real tendrás que codificar las contraseñas por motivos de seguridad. Para ello, debes asociar tu clase <code>User</code> con alguno de los <code>encoders</code> o codificadores de contraseñas definidos por Symfony. El siguiente ejemplo muestra cómo almacenar los usuarios en memoria y codificar sus contraseñas con el algoritmo <code>bcrypt</code>:</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_68b65" class="active"><a data-toggle="tab active" href="#select_tab_1_68b65" onclick="document.getElementById('select_tab_1_68b65').className='active'; document.getElementById('tab_1_68b65').className='tab-pane active';document.getElementById('select_tab_2_68b65').className='';  document.getElementById('tab_2_68b65').className='tab-pane';document.getElementById('select_tab_3_68b65').className='';  document.getElementById('tab_3_68b65').className='tab-pane';return false;">YAML</a></li><li id="select_tab_2_68b65"><a data-toggle="tab" href="#select_tab_2_68b65" onclick="document.getElementById('select_tab_1_68b65').className='';  document.getElementById('tab_1_68b65').className='tab-pane';document.getElementById('select_tab_2_68b65').className='active'; document.getElementById('tab_2_68b65').className='tab-pane active';document.getElementById('select_tab_3_68b65').className='';  document.getElementById('tab_3_68b65').className='tab-pane';return false;">XML</a></li><li id="select_tab_3_68b65"><a data-toggle="tab" href="#select_tab_3_68b65" onclick="document.getElementById('select_tab_1_68b65').className='';  document.getElementById('tab_1_68b65').className='tab-pane';document.getElementById('select_tab_2_68b65').className='';  document.getElementById('tab_2_68b65').className='tab-pane';document.getElementById('select_tab_3_68b65').className='active'; document.getElementById('tab_3_68b65').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_68b65">
<div class="code yaml">
<pre class="yaml"><span class="co1"># app/config/security.yml</span><span class="co4">
security</span><span class="sy2">:
</span>    <span class="co1"># ...</span><span class="co4">
    providers</span>:<span class="co4">
        in_memory</span>:<span class="co4">
            memory</span>:<span class="co4">
                users</span>:<span class="co4">
                    ryan</span>:<span class="co3">
                        password</span><span class="sy2">: </span>$2a$12$w/aHvnC/XNeDVrrl65b3dept8QcKqpADxUlbraVXXsC03Jam5hvoO<span class="co3">
                        roles</span><span class="sy2">: </span>'ROLE_USER'<span class="co4">
                    admin</span>:<span class="co3">
                        password</span><span class="sy2">: </span>$2a$12$HmOsqRDJK0HuMDQ5Fb2.AOLMQHyNHGD0seyjU3lEVusjT72QQEIpW<span class="co3">
                        roles</span><span class="sy2">: </span>'ROLE_ADMIN'
<span class="co4">
    encoders</span>:<span class="co4">
        Symfony\Component\Security\Core\User\User</span>:<span class="co3">
            algorithm</span><span class="sy2">: </span>bcrypt<span class="co3">
            cost</span><span class="sy2">: </span>     <span class="nu0">12</span></pre>
</div>
</div>


<div class="tab-pane" id="tab_2_68b65">
<div class="code xml">
<pre class="xml"><span class="sc-1">&lt;!-- app/config/security.xml --&gt;</span>
<span class="sc3"><span class="re1">&lt;config<span class="re2">&gt;</span></span></span>
    <span class="sc-1">&lt;!-- ... --&gt;</span>
    <span class="sc3"><span class="re1">&lt;provider</span> <span class="re0">name</span>=<span class="st0">&quot;in_memory&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;memory<span class="re2">&gt;</span></span></span>
            <span class="sc3"><span class="re1">&lt;user</span> <span class="re0">name</span>=<span class="st0">&quot;ryan&quot;</span></span>
<span class="sc3">                <span class="re0">password</span>=<span class="st0">&quot;$2a$12$w/aHvnC/XNeDVrrl65b3dept8QcKqpADxUlbraVXXsC03Jam5hvoO&quot;</span></span>
<span class="sc3">                <span class="re0">roles</span>=<span class="st0">&quot;ROLE_USER&quot;</span> <span class="re2">/&gt;</span></span>
            <span class="sc3"><span class="re1">&lt;user</span> <span class="re0">name</span>=<span class="st0">&quot;admin&quot;</span></span>
<span class="sc3">                <span class="re0">password</span>=<span class="st0">&quot;$2a$12$HmOsqRDJK0HuMDQ5Fb2.AOLMQHyNHGD0seyjU3lEVusjT72QQEIpW&quot;</span></span>
<span class="sc3">                <span class="re0">roles</span>=<span class="st0">&quot;ROLE_ADMIN&quot;</span> <span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;/memory<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;encoder</span> <span class="re0">class</span>=<span class="st0">&quot;Symfony\Component\Security\Core\User\User&quot;</span></span>
<span class="sc3">        <span class="re0">algorithm</span>=<span class="st0">&quot;bcrypt&quot;</span></span>
<span class="sc3">        <span class="re0">cost</span>=<span class="st0">&quot;12&quot;</span></span>
<span class="sc3">    <span class="re2">/&gt;</span></span>
<span class="sc3"><span class="re1">&lt;/config<span class="re2">&gt;</span></span></span></pre>
</div>
</div>


<div class="tab-pane" id="tab_3_68b65">
<div class="code php">
<pre class="php"><span class="co1">// app/config/security.php</span>
<span class="re0">$container</span><span class="sy0">-&gt;</span><span class="me1">loadFromExtension</span><span class="br0">&#40;</span><span class="st_h">'security'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="co1">// ...</span>
    <span class="st_h">'providers'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'in_memory'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'memory'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                <span class="st_h">'users'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                    <span class="st_h">'ryan'</span>  <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                        <span class="st_h">'password'</span> <span class="sy0">=&gt;</span> <span class="st_h">'$2a$12$w/aHvnC/XNeDVrrl65b3dept8QcKqpADxUlbraVXXsC03Jam5hvoO'</span><span class="sy0">,</span>
                        <span class="st_h">'roles'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'ROLE_USER'</span>
                    <span class="br0">&#41;</span><span class="sy0">,</span>
                    <span class="st_h">'admin'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                        <span class="st_h">'password'</span> <span class="sy0">=&gt;</span> <span class="st_h">'$2a$12$HmOsqRDJK0HuMDQ5Fb2.AOLMQHyNHGD0seyjU3lEVusjT72QQEIpW'</span><span class="sy0">,</span>
                        <span class="st_h">'roles'</span>    <span class="sy0">=&gt;</span> <span class="st_h">'ROLE_ADMIN'</span>
                    <span class="br0">&#41;</span><span class="sy0">,</span>
                <span class="br0">&#41;</span><span class="sy0">,</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'encoders'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'Symfony\Component\Security\Core\User\User'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'algorithm'</span> <span class="sy0">=&gt;</span> <span class="st_h">'bcrypt'</span><span class="sy0">,</span>
            <span class="st_h">'cost'</span>      <span class="sy0">=&gt;</span> <span class="nu0">12</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</div>

  </div>
</div>

<p>El codificador <code>bcrypt</code> se añadió en la versión 2.2 de Symfony. Ahora ya puedes codificar la contraseña mediante la función <code>password_hash('ryanpass', PASSWORD_BCRYPT, array('cost' =&gt; 12));</code> de PHP.</p>

<div class="admonition caution"><p><strong class="title">Advertencia</strong> Si tu versión de PHP es 5.4 o anterior, para utilizar el codificador <code>bcrypt</code> tendrás que instalar la librería <code>ircmaxell/password-compat</code> mediante Composer. Para ello, añade la siguiente dependencia en tu archivo <code>composer.json</code>:</p>

<div class="code javascript">
<pre class="javascript"><span class="br0">&#123;</span>
    <span class="st0">&quot;require&quot;</span><span class="sy0">:</span> <span class="br0">&#123;</span>
        ...
        <span class="st0">&quot;ircmaxell/password-compat&quot;</span><span class="sy0">:</span> <span class="st0">&quot;~1.0.3&quot;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p></p></div>

<p>Los algoritmos de codificación que puedes utilizar en el componente de seguridad de Symfony dependen de tu versión de PHP. Para obtener la lista completa de algoritmos disponibles, ejecuta la función <code>hash_algos()</code> de PHP.</p>

<p>A partir de la versión 2.2 de Symfony, también puedes utilizar <a href="http://symfony.com/doc/2.3/reference/configuration/security.html#reference-security-pbkdf2">PBKDF2</a> para codificar las contraseñas.</p>

<h4 id="determinando_las_contrasenas_codificadas">13.5.2.1. Determinando las contraseñas codificadas</h4>

<p>Si utilizas un formulario de registro para los usuarios, necesitas saber el algoritmo de codificación utilizado en la contraseña, para que lo puedas aplicar a tus usuarios. Independientemente del algoritmo configures para tus usuarios, desde un controlador siempre puedes determinar el algoritmo de codificación de la contraseña de la siguiente manera:</p>

<div class="code php">
<pre class="php"><span class="re0">$factory</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'security.encoder_factory'</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$user</span> <span class="sy0">=</span> <span class="kw2">new</span> Acme\UserBundle\Entity\User<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$encoder</span> <span class="sy0">=</span> <span class="re0">$factory</span><span class="sy0">-&gt;</span><span class="me1">getEncoder</span><span class="br0">&#40;</span><span class="re0">$user</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$password</span> <span class="sy0">=</span> <span class="re0">$encoder</span><span class="sy0">-&gt;</span><span class="me1">encodePassword</span><span class="br0">&#40;</span><span class="st_h">'ryanpass'</span><span class="sy0">,</span> <span class="re0">$user</span><span class="sy0">-&gt;</span><span class="me1">getSalt</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="re0">$user</span><span class="sy0">-&gt;</span><span class="me1">setPassword</span><span class="br0">&#40;</span><span class="re0">$password</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Para que el código anterior funcione correctamente, asegúrate de haber asociado un encoder a la clase de tus usuarios (por ejemplo <code>Acme\UserBundle\Entity\User</code>) en la clave <code>encoders</code> del archivo <code>app/config/security.yml</code>.</p>

<div class="admonition caution"><p><strong class="title">Advertencia</strong> Por motivos de seguridad, Symfony2 limita la longitud máxima de una contraseña en claro a 4096 caracteres. Asegúrate de añadir las restricciones de validación adecuadas para asegurar que la longitud de la contraseña no excede ese límite.</p></div>

<h3 id="recuperando_el_objeto_usuario">13.5.3. Recuperando el objeto usuario</h3>

<p>Después de la autenticación, el objeto <code>User</code> que representa al usuario actual se puede acceder a través del servicio <code>security.context</code>. Utiliza el siguiente código cuando estés dentro de un controlador:</p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> indexAction<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="re0">$user</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'security.context'</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getToken</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getUser</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Si tu controlador extiende del controlador base de Symfony, el código anterior se puede acortar por lo siguiente:</p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> indexAction<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="re0">$user</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getUser</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> Los usuarios anónimos técnicamente también están autenticados, lo que significa que el método <code>isAuthenticated()</code> del objeto que representa al usuario anónimo devuelve <code>true</code>. Para comprobar si el usuario está autenticado realmente, comprueba que tenga el rol <code>IS_AUTHENTICATED_FULLY</code>.</p></div>

<p>En las plantillas Twig puedes acceder a este objeto a través de la variable <code>app.user</code>, que a su vez llama al método <code>GlobalVariables::getUser()</code>:</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_68cae" class="active"><a data-toggle="tab active" href="#select_tab_1_68cae" onclick="document.getElementById('select_tab_1_68cae').className='active'; document.getElementById('tab_1_68cae').className='tab-pane active';document.getElementById('select_tab_2_68cae').className='';  document.getElementById('tab_2_68cae').className='tab-pane';return false;">TWIG</a></li><li id="select_tab_2_68cae"><a data-toggle="tab" href="#select_tab_2_68cae" onclick="document.getElementById('select_tab_1_68cae').className='';  document.getElementById('tab_1_68cae').className='tab-pane';document.getElementById('select_tab_2_68cae').className='active'; document.getElementById('tab_2_68cae').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_68cae">
<div class="code twig">
<pre class="twig">&lt;p&gt;Username: <span class="kw6"><span class="br0">&#123;</span><span class="br0">&#123;</span></span> <span class="re0">app</span><span class="re1">.user</span><span class="re1">.username</span> <span class="kw6"><span class="br0">&#125;</span><span class="br0">&#125;</span></span>&lt;/p&gt;</pre>
</div>
</div>


<div class="tab-pane" id="tab_2_68cae">
<div class="code php">
<pre class="php">&lt;p&gt;Username: <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$app</span><span class="sy0">-&gt;</span><span class="me1">getUser</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getUsername</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&lt;/p&gt;</pre>
</div>
</div>

  </div>
</div>

<h3 id="utilizando_varios_proveedores_de_usuarios">13.5.4. Utilizando varios proveedores de usuarios</h3>

<p>Cada mecanismo de autenticación (la autenticación HTTP, el formulario de acceso, etc.) utiliza exactamente un proveedor de usuarios. Además, por defecto siempre utilizan el primer proveedor de usuarios definido. No obstante, en ocasiones puedes necesitar por ejemplo definir algunos usuarios en el archivo de configuración y el resto en una base de datos. Para conseguirlo debes definir un nuevo proveedor encadenando dos o más proveedores de usuarios con la siguiente configuración:</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_68e15" class="active"><a data-toggle="tab active" href="#select_tab_1_68e15" onclick="document.getElementById('select_tab_1_68e15').className='active'; document.getElementById('tab_1_68e15').className='tab-pane active';document.getElementById('select_tab_2_68e15').className='';  document.getElementById('tab_2_68e15').className='tab-pane';document.getElementById('select_tab_3_68e15').className='';  document.getElementById('tab_3_68e15').className='tab-pane';return false;">YAML</a></li><li id="select_tab_2_68e15"><a data-toggle="tab" href="#select_tab_2_68e15" onclick="document.getElementById('select_tab_1_68e15').className='';  document.getElementById('tab_1_68e15').className='tab-pane';document.getElementById('select_tab_2_68e15').className='active'; document.getElementById('tab_2_68e15').className='tab-pane active';document.getElementById('select_tab_3_68e15').className='';  document.getElementById('tab_3_68e15').className='tab-pane';return false;">XML</a></li><li id="select_tab_3_68e15"><a data-toggle="tab" href="#select_tab_3_68e15" onclick="document.getElementById('select_tab_1_68e15').className='';  document.getElementById('tab_1_68e15').className='tab-pane';document.getElementById('select_tab_2_68e15').className='';  document.getElementById('tab_2_68e15').className='tab-pane';document.getElementById('select_tab_3_68e15').className='active'; document.getElementById('tab_3_68e15').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_68e15">
<div class="code yaml">
<pre class="yaml"><span class="co1"># app/config/security.yml</span><span class="co4">
security</span>:<span class="co4">
    providers</span>:<span class="co4">
        chain_provider</span>:<span class="co4">
            chain</span>:<span class="co3">
                providers</span><span class="sy2">: </span><span class="br0">&#91;</span>in_memory, user_db<span class="br0">&#93;</span><span class="co4">
        in_memory</span>:<span class="co4">
            memory</span>:<span class="co4">
                users</span>:<span class="co3">
                    foo</span><span class="sy2">: </span><span class="br0">&#123;</span> password<span class="sy2">: </span>test <span class="br0">&#125;</span><span class="co4">
        user_db</span>:<span class="co3">
            entity</span><span class="sy2">: </span><span class="br0">&#123;</span> class<span class="sy2">: </span>Acme\UserBundle\Entity\User, property<span class="sy2">: </span>username <span class="br0">&#125;</span></pre>
</div>
</div>


<div class="tab-pane" id="tab_2_68e15">
<div class="code xml">
<pre class="xml"><span class="sc-1">&lt;!-- app/config/security.xml --&gt;</span>
<span class="sc3"><span class="re1">&lt;config<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;provider</span> <span class="re0">name</span>=<span class="st0">&quot;chain_provider&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;chain<span class="re2">&gt;</span></span></span>
            <span class="sc3"><span class="re1">&lt;provider<span class="re2">&gt;</span></span></span>in_memory<span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
            <span class="sc3"><span class="re1">&lt;provider<span class="re2">&gt;</span></span></span>user_db<span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;/chain<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;provider</span> <span class="re0">name</span>=<span class="st0">&quot;in_memory&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;memory<span class="re2">&gt;</span></span></span>
            <span class="sc3"><span class="re1">&lt;user</span> <span class="re0">name</span>=<span class="st0">&quot;foo&quot;</span> <span class="re0">password</span>=<span class="st0">&quot;test&quot;</span> <span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;/memory<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;provider</span> <span class="re0">name</span>=<span class="st0">&quot;user_db&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;entity</span> <span class="re0">class</span>=<span class="st0">&quot;Acme\UserBundle\Entity\User&quot;</span> <span class="re0">property</span>=<span class="st0">&quot;username&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;/provider<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/config<span class="re2">&gt;</span></span></span></pre>
</div>
</div>


<div class="tab-pane" id="tab_3_68e15">
<div class="code php">
<pre class="php"><span class="co1">// app/config/security.php</span>
<span class="re0">$container</span><span class="sy0">-&gt;</span><span class="me1">loadFromExtension</span><span class="br0">&#40;</span><span class="st_h">'security'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'providers'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'chain_provider'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'chain'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                <span class="st_h">'providers'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'in_memory'</span><span class="sy0">,</span> <span class="st_h">'user_db'</span><span class="br0">&#41;</span><span class="sy0">,</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="st_h">'in_memory'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'memory'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
               <span class="st_h">'users'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                   <span class="st_h">'foo'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'password'</span> <span class="sy0">=&gt;</span> <span class="st_h">'test'</span><span class="br0">&#41;</span><span class="sy0">,</span>
               <span class="br0">&#41;</span><span class="sy0">,</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="st_h">'user_db'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="st_h">'entity'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                <span class="st_h">'class'</span> <span class="sy0">=&gt;</span> <span class="st_h">'Acme\UserBundle\Entity\User'</span><span class="sy0">,</span>
                <span class="st_h">'property'</span> <span class="sy0">=&gt;</span> <span class="st_h">'username'</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</div>

  </div>
</div>

<p>Ahora todos los mecanismos de autenticación utilizan el proveedor <code>chain_provider</code> porque es el primero que está definido. A su vez, el <code>chain_provider</code> intenta cargar el usuario primero a través del proveedor <code>in_memory</code> y después a través de <code>user_db</code>.</p>

<p>También puedes configurar cada <em>firewall</em> para que utilice un proveedor de usuarios específico. Esto es importante porque, como ya sabes, a menos que especifiques explícitamente un proveedor, siempre se utiliza el primer proveedor definido:</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_68f87" class="active"><a data-toggle="tab active" href="#select_tab_1_68f87" onclick="document.getElementById('select_tab_1_68f87').className='active'; document.getElementById('tab_1_68f87').className='tab-pane active';document.getElementById('select_tab_2_68f87').className='';  document.getElementById('tab_2_68f87').className='tab-pane';document.getElementById('select_tab_3_68f87').className='';  document.getElementById('tab_3_68f87').className='tab-pane';return false;">YAML</a></li><li id="select_tab_2_68f87"><a data-toggle="tab" href="#select_tab_2_68f87" onclick="document.getElementById('select_tab_1_68f87').className='';  document.getElementById('tab_1_68f87').className='tab-pane';document.getElementById('select_tab_2_68f87').className='active'; document.getElementById('tab_2_68f87').className='tab-pane active';document.getElementById('select_tab_3_68f87').className='';  document.getElementById('tab_3_68f87').className='tab-pane';return false;">XML</a></li><li id="select_tab_3_68f87"><a data-toggle="tab" href="#select_tab_3_68f87" onclick="document.getElementById('select_tab_1_68f87').className='';  document.getElementById('tab_1_68f87').className='tab-pane';document.getElementById('select_tab_2_68f87').className='';  document.getElementById('tab_2_68f87').className='tab-pane';document.getElementById('select_tab_3_68f87').className='active'; document.getElementById('tab_3_68f87').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_68f87">
<div class="code yaml">
<pre class="yaml"><span class="co1"># app/config/security.yml</span><span class="co4">
security</span>:<span class="co4">
    firewalls</span>:<span class="co4">
        secured_area</span><span class="sy2">:
</span>            <span class="co1"># ...</span><span class="co3">
            provider</span><span class="sy2">: </span>user_db<span class="co4">
            http_basic</span>:<span class="co3">
                realm</span><span class="sy2">: </span><span class="st0">&quot;Secured Demo Area&quot;</span><span class="co3">
                provider</span><span class="sy2">: </span>in_memory<span class="co3">
            form_login</span><span class="sy2">: </span>~</pre>
</div>
</div>


<div class="tab-pane" id="tab_2_68f87">
<div class="code xml">
<pre class="xml"><span class="sc-1">&lt;!-- app/config/security.xml --&gt;</span>
<span class="sc3"><span class="re1">&lt;config<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;firewall</span> <span class="re0">name</span>=<span class="st0">&quot;secured_area&quot;</span> <span class="re0">pattern</span>=<span class="st0">&quot;^/&quot;</span> <span class="re0">provider</span>=<span class="st0">&quot;user_db&quot;</span><span class="re2">&gt;</span></span>
        <span class="sc-1">&lt;!-- ... --&gt;</span>
        <span class="sc3"><span class="re1">&lt;http-basic</span> <span class="re0">realm</span>=<span class="st0">&quot;Secured Demo Area&quot;</span> <span class="re0">provider</span>=<span class="st0">&quot;in_memory&quot;</span> <span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;form-login</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;/firewall<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/config<span class="re2">&gt;</span></span></span></pre>
</div>
</div>


<div class="tab-pane" id="tab_3_68f87">
<div class="code php">
<pre class="php"><span class="co1">// app/config/security.php</span>
<span class="re0">$container</span><span class="sy0">-&gt;</span><span class="me1">loadFromExtension</span><span class="br0">&#40;</span><span class="st_h">'security'</span><span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'firewalls'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'secured_area'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="sy0">...,</span>
            <span class="st_h">'provider'</span> <span class="sy0">=&gt;</span> <span class="st_h">'user_db'</span><span class="sy0">,</span>
            <span class="st_h">'http_basic'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
                <span class="sy0">...,</span>
                <span class="st_h">'provider'</span> <span class="sy0">=&gt;</span> <span class="st_h">'in_memory'</span><span class="sy0">,</span>
            <span class="br0">&#41;</span><span class="sy0">,</span>
            <span class="st_h">'form_login'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
        <span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</div>

  </div>
</div>

<p>En este ejemplo, si un usuario intenta acceder a través de la autenticación HTTP, el sistema de autenticación utiliza el proveedor <code>in_memory</code>. Pero si el usuario intenta acceder a través del formulario de acceso, se utiliza el proveedor <code>user_db</code> (ya que es el valor por defecto de todo el <em>firewall</em>).</p>

<p>Para más información acerca de los proveedores de usuario y la configuración del firewall, consulta el artículo <a href="http://symfony.com/doc/2.0/reference/configuration/security.html">Security Configuration Reference</a>.</p>



            <div class="module module-ad module-ad-responsive module-ad-bottom">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_13/autorizacion.html">
                        <strong>&larr; Anterior</strong>
                        <small>13.4. Autorización</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_13/roles.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>13.6. Roles</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Symfony2 y los fundamentos de HTTP</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> De PHP a Symfony2</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Instalando y configurando Symfony2</a>
            </li>
                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Creando páginas en Symfony2</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> El controlador</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El enrutamiento</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>7.</span> <a href="../capitulo_7.html"> Creando y utilizando plantillas</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> La base de datos y Doctrine</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> La base de datos y Propel</a>
            </li>
                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Tests unitarios y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Validación</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Formularios</a>
            </li>
                                                                                                                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_13.html">
                    <span>Capítulo 13.</span> Seguridad
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/ejemplo_basico_autenticacion_http.html">
                    <span>13.1.</span>  Ejemplo básico: Autenticación HTTP
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/como_funciona_la_seguridad_autenticacion_y_autorizacion.html">
                    <span>13.2.</span> Cómo funciona la seguridad: autenticación y autorización 
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/usando_el_tipico_formulario_de_acceso.html">
                    <span>13.3.</span> Usando el típico formulario de acceso
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/autorizacion.html">
                    <span>13.4.</span> Autorización
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_13/usuarios.html">
                    <span>13.5.</span> Usuarios
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/roles.html">
                    <span>13.6.</span> Roles
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/controlando_el_acceso_en_las_plantillas.html">
                    <span>13.7.</span> Controlando el acceso en las plantillas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/controlando_el_acceso.html">
                    <span>13.8.</span> Controlando el acceso
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/cerrando_sesion.html">
                    <span>13.9.</span> Cerrando sesión
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/autenticacion_sin_estado.html">
                    <span>13.10.</span> Autenticación sin estado
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/utilidades.html">
                    <span>13.11.</span> Utilidades
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_13/consideraciones_finales.html">
                    <span>13.12.</span> Consideraciones finales
                </a>
            </li>
                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> La caché de HTTP</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> El contenedor de servicios</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Mejorando el rendimiento</a>
            </li>
                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> El interior de Symfony2</a>
            </li>
                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> La API estable de Symfony2</a>
            </li>
                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
