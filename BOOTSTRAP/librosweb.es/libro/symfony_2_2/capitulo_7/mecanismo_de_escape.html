<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>7.10. Mecanismo de escape (Symfony 2.2, el libro oficial)</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                            
        <link rel="canonical" href="/libro/symfony_2_x/capitulo_7/mecanismo_de_escape.html"/>
                                    <link rel="prev" href="../capitulo_7/herencia_de_tres_niveles.html" />
                    <link rel="next" href="../capitulo_7/depurando.html" />
                <link rel="start" href="/libro/symfony_2_2/" />
                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="7.10. Mecanismo de escape (Symfony 2.2, el libro oficial)">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-1-2" class="books book_page symfony_2_2"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                        
            <div class="module module-ad module-ad-responsive module-ad-top">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>

    
    <div id="book-toc-anchor" class="well visible-xs">
        <a href="#indice">
            <i class="fa fa-book"></i> Ver índice de contenidos del libro
        </a>
    </div>

    <div id="breadcrumb" class="hidden-xs">
        <ol>
            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libros/" itemprop="url">
                    <span itemprop="title">Libros</span>
                </a>
            </li>

            <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_2_2/" itemprop="url">
                    <span itemprop="title">Symfony 2.2, el libro oficial</span>
                </a>
            </li>

                    <li itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                <a href="/libro/symfony_2_2/capitulo_7.html" itemprop="url">
                    <span itemprop="title">Capítulo 7. Creando y utilizando plantillas</span>
                </a>
            </li>
        
            <li class="active">
                <span>7.10. Mecanismo de escape</span>
            </li>
        </ol>
    </div>

    <h1 id="mecanismo_de_escape" class="title">
        <span>7.10.</span> Mecanismo de escape
    </h1>

    

<p>Cuando generas código HTML a partir de una plantilla, siempre existe el riesgo de que alguna variable de la plantilla contenga código HTML erróneo o incluso <em>peligroso</em>. En el primer caso, el resultado es que el diseño de la página se puede <em>romper</em>. En el segundo caso, un usuario malicioso podría realizar un ataque de tipo XSS o <em>Cross Site Scripting</em>. Observa este clásico ejemplo de ataque XSS:</p>

<div class="tabbable">
  <ul class="nav nav-tabs"><li id="select_tab_1_26669" class="active"><a data-toggle="tab active" href="#select_tab_1_26669" onclick="document.getElementById('select_tab_1_26669').className='active'; document.getElementById('tab_1_26669').className='tab-pane active';document.getElementById('select_tab_2_26669').className='';  document.getElementById('tab_2_26669').className='tab-pane';return false;">TWIG</a></li><li id="select_tab_2_26669"><a data-toggle="tab" href="#select_tab_2_26669" onclick="document.getElementById('select_tab_1_26669').className='';  document.getElementById('tab_1_26669').className='tab-pane';document.getElementById('select_tab_2_26669').className='active'; document.getElementById('tab_2_26669').className='tab-pane active';return false;">PHP</a></li></ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab_1_26669">
<div class="code twig">
<pre class="twig">Hello <span class="kw6"><span class="br0">&#123;</span><span class="br0">&#123;</span></span> <span class="re0">name</span> <span class="kw6"><span class="br0">&#125;</span><span class="br0">&#125;</span></span></pre>
</div>
</div>


<div class="tab-pane" id="tab_2_26669">
<div class="code php">
<pre class="php">Hello <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$name</span> <span class="sy1">?&gt;</span></pre>
</div>
</div>

  </div>
</div>

<p>Imagina que el usuario utiliza el siguiente contenido como su nombre:</p>

<div class="code html5">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">script</span>&gt;</span>alert('hello!')<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span></pre>
</div>

<p>Si no aplicas ningún mecanismo de escape, la plantilla resultante mostraría un cuadro de alerta de JavaSript:</p>

<div class="code html5">
<pre class="html5">Hello <span class="sc2">&lt;<span class="kw2">script</span>&gt;</span>alert('hello!')<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span></pre>
</div>

<p>Aunque este ejemplo parece inofensivo, si un usuario malicioso puede llegar hasta aquí, también podrá escribir código JavaScript más avanzado que realice operaciones no deseadas en nombre de cualquier otro usuario.</p>

<p>La respuesta a este problema es el mecanismo de escape, que hace que puedas renderizar cualquier plantilla sin problemas. El siguiente ejemplo muestra el resultado de mostrar la misma plantilla anterior pero con el mecanismo de escape activado:</p>

<div class="code html5">
<pre class="html5">Hello <span class="sc1">&amp;lt;</span>script<span class="sc1">&amp;gt;</span>alert(<span class="sc1">&amp;#39;</span>helloe<span class="sc1">&amp;#39;</span>)<span class="sc1">&amp;lt;</span>/script<span class="sc1">&amp;gt;</span></pre>
</div>

<p>Twig y PHP abordan este problema de formas diferentes. Si utilizas Twig, el mecanismo de escape ya está activado y tu aplicación está protegida. En PHP el mecanismo de escape no es automático, por lo que tendrás que proteger los contenidos uno a uno.</p>

<h3 id="mecanismo_de_escape_en_twig">7.10.1. Mecanismo de escape en Twig</h3>

<p>Si utilizas Twig para crear tus plantillas, el mecanismo de escape está activado por defecto. Esto significa que ya estás protegido frente a cualquier información que te llegue desde tus usuarios. Por defecto el mecanismo de escape protege los contenidos para mostrarlos en una página HTML, pero existen otras estrategias para proteger contenidos que se muestren dentro de código JavaScript, etc.</p>

<p>En ocasiones, tendrás que desactivar el mecanismo de escape para mostrar el contenido HTML de alguna variable fiable. Imagina que los usuarios de tipo administrador pueden escribir artículos que contienen código HTML. Por defecto Twig protegerá esos contenidos.</p>

<p>Para mostrar los contenidos originales, utiliza el filtro <code>raw</code>:</p>

<div class="code twig">
<pre class="twig"><span class="kw6"><span class="br0">&#123;</span><span class="br0">&#123;</span></span> <span class="re0">articulo</span><span class="re1">.contenido</span><span class="sy0">|</span><span class="kw1">raw</span> <span class="kw6"><span class="br0">&#125;</span><span class="br0">&#125;</span></span></pre>
</div>

<p>También puedes desactivar el mecanismo de escape dentro de un bloque (<code>{&#37; block &#37;}</code>) o incluso en una plantilla completa.</p>

<h3 id="mecanismo_de_escape_en_php">7.10.2. Mecanismo de escape en PHP</h3>

<p>El mecanismo de escape no es automático cuando utilizas plantillas PHP. Esto significa que no estás protegido a menos que <em>escapes</em> explícitamente todas y cada una de las variables. Para utilizar el mecanismo de escape, usa el método especial de la vista <code>escape()</code>:</p>

<div class="code php">
<pre class="php">Hello <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$view</span><span class="sy0">-&gt;</span><span class="me1">escape</span><span class="br0">&#40;</span><span class="re0">$name</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span></pre>
</div>

<p>Por defecto el método <code>escape()</code> supone que la variable se está renderizando en una página HTML (y por tanto, la variable se escapa para que sea segura desde el punto de vista de HTML). Un segundo argumento opcional del método te permite cambiar este comportamiento. Para incluir de forma segura un contenido dentro de una cadena de código JavaScript, utiliza la estrategia <code>js</code>:</p>

<div class="code javascript">
<pre class="javascript"><span class="kw1">var</span> myMsg <span class="sy0">=</span> <span class="st0">'Hello &lt;?php echo $view-&gt;escape($name, '</span>js<span class="st0">') ?&gt;'</span><span class="sy0">;</span></pre>
</div>



    
    <div id="book-pager">
        <ul class="row pager">
            <li class="col-xs-6 previous ">
                                    <a href="../capitulo_7/herencia_de_tres_niveles.html">
                        <strong>&larr; Anterior</strong>
                        <small>7.9. Herencia de tres niveles</small>
                    </a>
                            </li>

            <li class="col-xs-6 next ">
                                    <a href="../capitulo_7/depurando.html">
                        <strong>Siguiente &rarr;</strong>
                        <small>7.11. Depurando</small>
                    </a>
                            </li>
        </ul>
    </div>

                        </div>

                    <div id="sidebar" class="col-sm-3">
                        
            <div class="module module-share">
        <h3>Compartir</h3>
        <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = '{{ item_social_title }}';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

    </div>

    
    <div id="book-toc" class="module">
        <a id="indice"></a>

        <h3>Indice de contenidos</h3>
        <ul class="toc text-links">
                                            <li class="level-1">
                <span>1.</span> <a href="../capitulo_1.html"> Symfony2 y los fundamentos de HTTP</a>
            </li>
                                                                                                                            <li class="level-1">
                <span>2.</span> <a href="../capitulo_2.html"> De PHP a Symfony2</a>
            </li>
                                                                                                            <li class="level-1">
                <span>3.</span> <a href="../capitulo_3.html"> Instalando y configurando Symfony2</a>
            </li>
                                                                                            <li class="level-1">
                <span>4.</span> <a href="../capitulo_4.html"> Creando páginas en Symfony2</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>5.</span> <a href="../capitulo_5.html"> El controlador</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>6.</span> <a href="../capitulo_6.html"> El enrutamiento</a>
            </li>
                                                                                                                                                                                            <li class="level-1 ">
                <a href="../capitulo_7.html">
                    <span>Capítulo 7.</span> Creando y utilizando plantillas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/plantillas.html">
                    <span>7.1.</span> Plantillas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/herencia_de_plantillas_y_layout.html">
                    <span>7.2.</span> Herencia de plantillas y layout
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/nomenclatura_y_localizacion_de_las_plantillas.html">
                    <span>7.3.</span> Nomenclatura y localización de las plantillas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/etiquetas_y_helpers.html">
                    <span>7.4.</span> Etiquetas y helpers
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/incluyendo_hojas_de_estilo_y_javascript_en_twig.html">
                    <span>7.5.</span> Incluyendo hojas de estilo y JavaScript en Twig
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/variables_globales.html">
                    <span>7.6.</span> Variables globales
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/configurando_y_usando_el_servicio_templating.html">
                    <span>7.7.</span> Configurando y usando el servicio <code>templating</code>
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/modificando_las_plantillas_de_los_bundles.html">
                    <span>7.8.</span> Modificando las plantillas de los bundles
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/herencia_de_tres_niveles.html">
                    <span>7.9.</span> Herencia de tres niveles
                </a>
            </li>
                                            <li class="level-2 active">
                <a href="../capitulo_7/mecanismo_de_escape.html">
                    <span>7.10.</span> Mecanismo de escape
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/depurando.html">
                    <span>7.11.</span> Depurando
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/detectando_errores_de_sintaxis.html">
                    <span>7.12.</span> Detectando errores de sintaxis
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/formato_de_plantillas.html">
                    <span>7.13.</span> Formato de plantillas
                </a>
            </li>
                                            <li class="level-2 ">
                <a href="../capitulo_7/consideraciones_finales.html">
                    <span>7.14.</span> Consideraciones finales
                </a>
            </li>
                                            <li class="level-1">
                <span>8.</span> <a href="../capitulo_8.html"> La base de datos y Doctrine</a>
            </li>
                                                                                                                                                                                            <li class="level-1">
                <span>9.</span> <a href="../capitulo_9.html"> La base de datos y Propel</a>
            </li>
                                            <li class="level-1">
                <span>10.</span> <a href="../capitulo_10.html"> Tests unitarios y funcionales</a>
            </li>
                                                                                                                                            <li class="level-1">
                <span>11.</span> <a href="../capitulo_11.html"> Validación</a>
            </li>
                                                                                                                                                                            <li class="level-1">
                <span>12.</span> <a href="../capitulo_12.html"> Formularios</a>
            </li>
                                                                                                                                                                                                                                            <li class="level-1">
                <span>13.</span> <a href="../capitulo_13.html"> Seguridad</a>
            </li>
                                                                                                                                                                                                                                                            <li class="level-1">
                <span>14.</span> <a href="../capitulo_14.html"> La caché de HTTP</a>
            </li>
                                                                                                                                                            <li class="level-1">
                <span>15.</span> <a href="../capitulo_15.html"> Internacionalización</a>
            </li>
                                                                                                                                                                                                                            <li class="level-1">
                <span>16.</span> <a href="../capitulo_16.html"> El contenedor de servicios</a>
            </li>
                                                                                                                                                                                                            <li class="level-1">
                <span>17.</span> <a href="../capitulo_17.html"> Mejorando el rendimiento</a>
            </li>
                                                                                                            <li class="level-1">
                <span>18.</span> <a href="../capitulo_18.html"> El interior de Symfony2</a>
            </li>
                                                                                                            <li class="level-1">
                <span>19.</span> <a href="../capitulo_19.html"> La API estable de Symfony2</a>
            </li>
                        </ul>
    </div>
                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
