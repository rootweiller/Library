<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml" xml:lang="es" lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>La nueva API para codificar contraseñas de PHP 5.5</title>
                                    <link rel="stylesheet" href="/css/app.css" />
                        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-82842-2', 'librosweb.es');
            ga('require', 'displayfeatures');
            ga('send', 'pageview');
        </script>
                        <link rel="apple-touch-icon" type="image/png" href="/apple-touch-icon.png">
        <link rel="apple-touch-icon-precomposed" type="image/png" href="/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="LibrosWeb">
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
        <meta name="site-version" content="a7f65a4">
                <link rel="publisher" href="http://plus.google.com/112008023125011571577">
                                                <meta name="twitter:site" content="@librosweb">
                <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="LibrosWeb">
                <meta property="fb:page_id" content="437758756273955">
                <meta property="fb:app_id" content="437758756273955">
        <meta property="og:type" content="website">
        <meta property="og:title" content="La nueva API para codificar contraseñas de PHP 5.5">
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200">
                <meta name="msapplication-TileColor" content="#CC1414">
        <meta name="application-name" content="LibrosWeb">
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web.">
    </head>

    <body id="p-2-1" class="tutorials"><script type="text/javascript">
//<![CDATA[
try{(function(a){var b="http://",c="librosweb.es",d="/cdn-cgi/cl/",e="img.gif",f=new a;f.src=[b,c,d,e].join("")})(Image)}catch(e){}
//]]>
</script>
        <div class="content-background"></div>

        <div id="header">
            <div class="navbar navbar-default navbar-static-top">
              <div class="container">
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-menu">
                    <span class="sr-only">Desplegar menú</span>
                    <i class="fa fa-menu"></i>
                  </button>
                  <a class="navbar-brand" href="/" title="LibrosWeb.es">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 132 32" preserveAspectRatio="xMinYMin meet">
<g fill="#CC1414" transform="translate(-21.738 -21.148)">
<path d="m24.062 23.486v28h9.64v-5h-4.04v-23h-5.6"/>
<path d="m40.796 23.486h-5.6v28h5.6v-28"/>
<path d="m53.932 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32 1-1 1h-1.32v-6.64h1.32c0.68 0 1 0.32 1 1m-2.32 10.32h1.4c0.68 0 1 0.32 1 1v5.08c0 0.68-0.32 1-1 1h-1.4v-7.08"/>
<path d="m69.284 38.246c1.52-0.56 2.4-1.76 2.4-4.16v-5.4c0-3.48-1.72-5.2-5.2-5.2h-8.36v28h5.6v-10.6h1.4c0.68 0 1 0.32 1 1v9.6h5.6v-9.64c0-2.04-0.72-3.12-2.44-3.6m-3.2-8.88v5.76c0 0.68-0.32 1-1 1h-1.36v-7.76h1.36c0.68 0 1 0.32 1 1"/>
<path d="m87.513 46.526v-18.08c0-3.48-1.72-5.2-5.2-5.2h-3.6c-3.48 0-5.2 1.72-5.2 5.2v18.08c0 3.48 1.72 5.2 5.2 5.2h3.6c3.48 0 5.2-1.72 5.2-5.2m-5.6-17.48v16.88c0 0.68-0.32 1-1 1h-0.8c-0.68 0-1-0.32-1-1v-16.88c0-0.68 0.32-1 1-1h0.8c0.68 0 1 0.32 1 1"/>
<path d="m100.57 36.966-4.8-3.56c-0.68-0.48-0.96-0.92-0.96-1.8v-2.64c0-0.68 0.32-1 1-1h0.44c0.68 0 1 0.32 1 1v4.6h5.48v-5.12c0-3.48-1.72-5.2-5.2-5.2h-3.04c-3.48 0-5.2 1.72-5.2 5.2v4.44c0 2 0.52 3.16 2.24 4.4l4.8 3.56c0.68 0.48 0.96 0.92 0.96 1.8v3.36c0 0.68-0.32 1-1 1h-0.52c-0.68 0-1-0.32-1-1v-5.44h-5.48v5.96c0 3.48 1.72 5.2 5.2 5.2h3.12c3.48 0 5.2-1.72 5.2-5.2v-5.16c0-2.08-0.52001-3.16-2.24-4.4"/>
<path d="m106.98 51.486h6.16l1.44-12.72 1.44 12.72h6.16l3.4-28h-4.96l-1.44 14.88-1.6-14.88h-5.28l-1.6 14.92-1.44-14.92h-5.68l3.4 28"/>
<path d="m126.87 23.486v28h10.48v-5h-4.88v-6.72h4.6v-5h-4.6v-6.28h4.8v-5h-10.4"/>
<path d="m150.26 37.006c1.48-0.56 2.32-1.76 2.32-4.16v-4.16c0-3.48-1.72-5.2-5.2-5.2h-8.24v28h8.32c3.48 0 5.2-1.72 5.2-5.2v-5.68c0-2.04-0.72001-3.12-2.4-3.6m-3.24-7.72v4.64c0 0.68-0.32001 1-1 1h-1.32v-6.64h1.32c0.67999 0 1 0.32 1 1m-2.32 10.32h1.4c0.67999 0 1 0.32 1 1v5.08c0 0.68-0.32001 1-1 1h-1.4v-7.08"/>
</g>
</svg>
                      <span>LibrosWeb</span>
                  </a>
                </div>

                <div class="collapse navbar-collapse navbar-right" id="header-menu">
                  <ul class="nav navbar-nav pull-right">
                    
                                                <li class="">
                            <a href="/">
                                Inicio
                            </a>
                        </li>
                                                <li class="">
                            <a href="/libros/">
                                Libros
                            </a>
                        </li>
                                                <li class="active">
                            <a href="/tutoriales/">
                                Tutoriales
                            </a>
                        </li>
                                                <li class="">
                            <a href="/eventos/">
                                Eventos
                            </a>
                        </li>
                                                <li class="">
                            <a href="/foro/">
                                Foro
                            </a>
                        </li>
                                                <li class="">
                            <a href="/buscar">
                                Buscar
                            </a>
                        </li>
                                          </ul>
                </div>
              </div>
            </div>
        </div>

        <div id="wrapper" class="container">

            <div id="content" class="row">
                                    <div id="main" class="col-sm-9">
                            <h1 class="title">La nueva API para codificar contraseñas de PHP 5.5</h1>

    <p>La novedad más importante de PHP 5.5 relacionada con la seguridad es la creación de una nueva API para codificar y verificar contraseñas. Además de ser muy fácil de utilizar, esta API sigue todas las buenas prácticas de seguridad recomendadas para aplicaciones web modernas.</p>
<p>Internamente la API utiliza la función <code>crypt()</code> y está disponible desde la versión 5.5.0 de PHP. Si utilizas una versión anterior de PHP, siempre que sea igual o superior a 5.3.7, existe una librería con las mismas funcionalidades que la nueva API: <a href="http://github.com/ircmaxell/password_compat">github.com/ircmaxell/password_compat</a>.</p>
<h2>Codificando contraseñas</h2>
<p>La función más importante de la nueva API es <code>password_hash()</code>, que codifica la contraseña que le pases con el algoritmo indicado:</p>
<pre class="php code"><span class="re0">$password</span> <span class="sy0">=</span> password_hash<span class="br0">&#40;</span><span class="st_h">'admin1234'</span><span class="sy0">,</span> PASSWORD_DEFAULT<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// $password = $2y$10$a8ThA3xOuWB6QPeFL/VRZeynSxoT6chW4RS1uh5l0xOBEePFnUNpG</span></pre>
<p>El primer argumento de la función es la contraseña original sin codificar y el segundo argumento debe ser una de las dos siguientes constantes:</p>
<ul>
<li><code>PASSWORD_DEFAULT</code>, codifica la contraseña utilizando el algoritmo <code>bcrypt</code> y el resultado es una cadena de 60 caracteres de longitud, cuyos primeros caracteres son <code>$2y$10$</code>. El algoritmo utilizado y la longitud de la contraseña codificada cambiarán en las próximas versiones de PHP, cuando se añadan algoritmos todavía más seguros. Si guardas las contraseñas en una base de datos, la recomendación es que reserves 255 caracteres para ello y no los 60 que se pueden utilizar actualmente.</li>
<li><code>PASSWORD_BCRYPT</code>, a pesar de su nombre, codifica la contraseña utilizando el algoritmo <code>CRYPT_BLOWFISH</code>. Al igual que en el caso anterior, la contraseña codificada ocupa 60 caracteres en total, siendo los primeros caracteres <code>$2y$</code>.</li>
</ul>
<pre class="php code"><span class="re0">$password</span> <span class="sy0">=</span> password_hash<span class="br0">&#40;</span><span class="st_h">'admin1234'</span><span class="sy0">,</span> PASSWORD_DEFAULT<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// $password = $2y$10$a8ThA3xOuWB6QPeFL/VRZeynSxoT6chW4RS1uh5l0xOBEePFnUNpG</span>
&nbsp;
<span class="re0">$password</span> <span class="sy0">=</span> password_hash<span class="br0">&#40;</span><span class="st_h">'admin1234'</span><span class="sy0">,</span> PASSWORD_BCRYPT<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// $password = $2y$10$1Y2nAYh7gVThKyL2H/FkIuAqU0Z4ZZNUz3rqFNSbq7RiVoyWsXM5a</span></pre>
<p>Aunque te cueste creerlo, estas funciones para codificar contraseñas se han diseñado a propósito para que sean muy lentas y para que siempre tarden el mismo tiempo en obtener el resultado. De esta forma se evitan los ataques de seguridad conocidos como <em><a href="http://en.wikipedia.org/wiki/Timing_attack">timing attack</a></em>.</p>
<p>El tiempo empleado en codificar una contraseña se denomina <em>"coste"</em> y se puede configurar mediante el tercer argumento opcional de la función <code>password_hash()</code>. El coste por defecto es <code>10</code> (por eso el prefijo de las contraseñas anteriores es <code>$2y$10$</code>) y su valor debe estar comprendido entre <code>04</code> y <code>31</code>. Si tu servidor es muy potente, puedes subir el coste de la siguiente manera:</p>
<pre class="php code"><span class="re0">$password</span> <span class="sy0">=</span> password_hash<span class="br0">&#40;</span><span class="st_h">'admin1234'</span><span class="sy0">,</span> PASSWORD_DEFAULT<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// $password = $2y$10$a8ThA3xOuWB6QPeFL/VRZeynSxoT6chW4RS1uh5l0xOBEePFnUNpG</span>
&nbsp;
<span class="re0">$password</span> <span class="sy0">=</span> password_hash<span class="br0">&#40;</span><span class="st_h">'admin1234'</span><span class="sy0">,</span> PASSWORD_DEFAULT<span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'cost'</span> <span class="sy0">=&gt;</span> <span class="nu0">12</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// $password = $2y$12$hrxMLCk3ZfKNEcY1lpTpMOD09TnHO5vlJp5CR4xYud7a4RACWoRFm</span>
&nbsp;
<span class="re0">$password</span> <span class="sy0">=</span> password_hash<span class="br0">&#40;</span><span class="st_h">'admin1234'</span><span class="sy0">,</span> PASSWORD_DEFAULT<span class="sy0">,</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'cost'</span> <span class="sy0">=&gt;</span> <span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// $password = $2y$20$UX1pRArPfTNsUn8czY8AE.8OakctlMk6.or6OmQNQ.mpzyHvm29ki</span></pre>
<p>La recomendación oficial para elegir el coste más adecuado para tu servidor es que el tiempo empleado en codificar una contraseña sea entre <code>0.1</code>y <code>0.5</code> segundos.</p>
<p>Además del coste, la función <code>password_hash()</code> también permite configurar la opción <code>salt</code>, que es el valor inicial que se utiliza para codificar la contraseña. Se recomienda no establecer este valor a mano y dejar que sea PHP quien lo calcule automáticamente. Si quieres saber cómo establecer este valor a mano, consulta la <a href="http://php.net/manual/en/function.password-hash.php">documentación de password_hash()</a>.</p>
<p>Si hasta ahora guardabas en la base de datos las contraseñas originales porque no sabías cómo codificarlas, ya no tienes excusa. Gracias a la nueva API para codificar las contraseñas, hacer las cosas bien desde el punto de vista de la seguridad cuesta todavía menos tiempo y esfuerzo que hacerlas mal.</p>
<h2>Comprobando contraseñas</h2>
<p>Codificar las contraseñas antes de guardarlas en la base de datos es sólo la primera parte del problema. Después, cada vez que un usuario quiera conectarse a tu aplicación, hay que comprobar que la contraseña proporcionada es efectivamente la misma que se guardó codificada.</p>
<p>La nueva función <code>password_verify()</code> simplifica este trabajo al máximo, ya que solamente hay que pasarle como primer argumento la contraseña del usuario y como segundo argumento la contraseña codificada:</p>
<pre class="php code"><span class="re0">$original</span> <span class="sy0">=</span> <span class="st_h">'admin1234'</span><span class="sy0">;</span>
<span class="re0">$codificado</span> <span class="sy0">=</span> <span class="st_h">'$2y$10$a8ThA3xOuWB6QPeFL/VRZeynSxoT6chW4RS1uh5l0xOBEePFnUNpG'</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$iguales</span> <span class="sy0">=</span> password_verify<span class="br0">&#40;</span><span class="re0">$original</span><span class="sy0">,</span> <span class="re0">$codificado</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$iguales</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">echo</span> <span class="st_h">'Puedes pasar a la zona privada'</span><span class="sy0">;</span>
<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
    <span class="kw1">echo</span> <span class="st_h">'La contraseña indicada no es correcta'</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
<p>Como las contraseñas codificadas por <code>password_hash()</code> ya contienen en su interior el coste y el <code>salt</code> utilizados para codificar la contraseña original, no hay que indicar ningún parámetro más a la función <code>password_verify()</code>.</p>
<h2>Otras utilidades</h2>
<p>La nueva API para codificar contraseñas incluye otras dos funciones menos importantes. La primera es <code>password_get_info()</code>, que devuelve un array con información de la contraseña codificada que se le pasa como argumento:</p>
<pre class="php code"><span class="re0">$info</span> <span class="sy0">=</span> password_get_info<span class="br0">&#40;</span><span class="st_h">'$2y$20$UX1pRArPfTNsUn8czY8AE.8OakctlMk6.or6OmQNQ.mpzyHvm29ki'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$info</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'algo'</span>     <span class="sy0">=&gt;</span> <span class="nu0">1</span><span class="sy0">,</span>        <span class="co1">// identificador del algoritmo utilizado</span>
    <span class="st_h">'algoName'</span> <span class="sy0">=&gt;</span> <span class="st_h">'bcrypt'</span><span class="sy0">,</span> <span class="co1">// nombre del algoritmo utilizado</span>
    <span class="st_h">'options'</span>  <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span>
        <span class="st_h">'cost'</span> <span class="sy0">=&gt;</span> <span class="nu0">20</span>        <span class="co1">// coste utilizado en la codificación</span>
    <span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
<p>Si en tu aplicación modificas con el tiempo el algoritmo o las opciones para codificar las contraseñas, necesitarás comprobar si una determinada contraseña debe ser recodificada o si cumple las nuevas opciones. Para ello puedes utilizar la función <code>password_needs_rehash()</code>, pasando la contraseña codificada como primer argumento, el algoritmo que se debe utilizar como segundo argumento y opcionalmente, las opciones del algoritmo como tercer argumento.</p>
<p>En el siguiente ejemplo, se pasa una contraseña codificada con el algoritmo por defecto y un coste de <code>10</code>. Como las características deseadas son el algoritmo por defecto y un coste de <code>20</code>, el resultado de la función <code>password_needs_rehash()</code> será <code>true</code>:</p>
<pre class="php code"><span class="re0">$hayQueRecodificar</span> <span class="sy0">=</span> password_needs_rehash<span class="br0">&#40;</span>
    <span class="st_h">'$2y$10$a8ThA3xOuWB6QPeFL/VRZeynSxoT6chW4RS1uh5l0xOBEePFnUNpG'</span><span class="sy0">,</span>
    PASSWORD_DEFAULT<span class="sy0">,</span>
    <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'cost'</span> <span class="sy0">=&gt;</span> <span class="nu0">20</span><span class="br0">&#41;</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// $hayQueRecodificar = true</span></pre>

                    </div>

                    <div id="sidebar" class="col-sm-3">
                            <div class="module module-ad module-ad-responsive module-ad-sidebar">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1491000300253750"
         data-ad-slot="3770792827"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>


    <div class="module module-share">
    <h3>Compartir</h3>
    <ul>
    <li><a id="share_twitter" href="#" title="Compartir en Twitter">Twitter</a></li>
    <li><a id="share_facebook" href="#" title="Compartir en Facebook">Facebook</a></li>
    <li><a id="share_google" href="#" title="Compartir en Google+">Google+</a></li>
</ul>

<script type="text/javascript">
var title    = 'La nueva API para codificar contraseñas de PHP 5.5';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) {
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;

            ga('send', 'social', {
                'socialNetwork' : a.id.substr(6),
                'socialAction'  : 'share',
                'socialTarget'  : window.location
            });

            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

</div>


    
<div class="module module-tags">
    <h3>Etiquetas populares</h3>
    <ul class="tags-list">
                    <li class="">
                <a href="/tutoriales/composer/">composer</a>
            </li>
                    <li class="">
                <a href="/tutoriales/css/">css</a>
            </li>
                    <li class="">
                <a href="/tutoriales/dise%C3%B1o/">diseño</a>
            </li>
                    <li class="">
                <a href="/tutoriales/html/">html</a>
            </li>
                    <li class="">
                <a href="/tutoriales/javascript/">javascript</a>
            </li>
                    <li class="">
                <a href="/tutoriales/php/">php</a>
            </li>
                    <li class="">
                <a href="/tutoriales/programaci%C3%B3n/">programación</a>
            </li>
                    <li class="">
                <a href="/tutoriales/sistemas/">sistemas</a>
            </li>
                    <li class="">
                <a href="/tutoriales/symfony/">symfony</a>
            </li>
            </ul>
</div>


    <div class="module module-rss">
    <h3>Suscríbete gratis</h3>
    <ul class="list-unstyled text-links module-rss-feeds">
        <li>
            <i class="icon">RSS</i>
            <a href="/rss/tutoriales/todos.xml">
                <strong>Todos</strong> los tutoriales
            </a>
        </li>
        <li>
            <i class="icon">RSS</i>
            <a href="/rss/tutoriales/diseno.xml">
                Tutoriales de <strong>diseño</strong>
            </a>
        </li>
        <li>
            <i class="icon">RSS</i>
            <a href="/rss/tutoriales/programacion.xml">
                Tutoriales de <strong>programación</strong>
            </a>
        </li>
    </ul>
</div>

                    </div>
                            </div>

            <div id="footer">
                <div class="row">
                    <div class="col-xs-12 col-sm-9">
                        &copy; 2015 LibrosWeb.es
                        <a href="/sitio/contacto">Contacto</a>
                        <a href="https://plus.google.com/+librosweb">Novedades</a>
                        <a href="/sitio/condiciones">Condiciones</a>
                        <a href="/sitio/privacidad">Privacidad</a>
                    </div>
                    <div class="col-xs-12 col-sm-3 uptime">
                        3.111 días online
                    </div>
                </div>
            </div>

        </div>

                                    <script src="/js/app.js"></script>
            
            <script type="text/javascript">
                console.log($(window).width());
            </script>
            </body>
</html>
